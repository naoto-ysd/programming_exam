{"posts"=>[{"number"=>611, "name"=>"旧SC 10時実行CRON", "full_name"=>"システム本部/運用保守/旧SC 10時実行CRON", "wip"=>false, "body_md"=>"## import_user_from_motherメソッド\r\nざっくりいうとmotherと紐づくSCの情報がなければ、SCのアカウントを作る処理。\r\n\r\n対象　活動中、休会、PC休会、開始前\r\n\r\n処理対象の会員情報(mother.members)を取ってくる。\r\nカラムはid, pc_mail, mobile_mail, status_id, student, teacher, name, studio_id\r\n\r\n活動中クラスを持つ会員を取ってくる。(member_ids_with_lesson)\r\n\r\n処理対象の会員と SCのログイン用に設定するメールアドレスをhashで紐付ける。\r\nSCのログイン用アドレスは、mother.pc_mail > mother.mobile_mailが優先。\r\n\r\n\r\n\r\n## send_welcome_mail_to_initial_usersメソッド\r\n以下のメールを送っているだけ\r\n```ruby\r\n━━━━━━━━━━━━━━━━━━━━━━━\r\n<%if @resource.sign_in_count == 0%>\r\n【EYS】SecondCommunityアカウント作成のお知らせ\r\n<%else%>\r\n【EYS】SecondCommunityアカウント更新のお知らせ\r\n<%end%>\r\n━━━━━━━━━━━━━━━━━━━━━━━\r\nこんにちは、<%= @resource.member.alt_name %>様\r\n\r\nレッスンをさせていただき、ありがとうございます。\r\n\r\nEYS音楽教室ではレッスンの予約から\r\nご自宅での予習・復習まで、会員様の効率的な学習をサポートするため、\r\nSecondCommunityサイトを運営しております。\r\n<%if @resource.sign_in_count == 0%>\r\n今回、当サイトのアカウントを作成しましたので、お知らせします。\r\n※以前アカウント作成連絡のメールを送付した方にも\r\nEメールアドレスの変更が有った場合、再度このメールが送付される事がございます。\r\nその場合はご容赦ください。\r\n<%else%>\r\n今回、当サイトで使用するアカウントIDを更新しましたので、お知らせします。\r\nID: <%= @resource.email %>\r\n以前設定していただいたパスワードは、そのまま使用出来ます。\r\n<%end%>\r\n\r\n当サイトでは\r\n・来月末までのレッスン予定\r\n・今までに作成されたレッスンカルテ・フォロー\r\nの表示を行う事ができます。\r\nまた、\r\n・フリーレッスンの予約、キャンセル\r\n・固定レッスンの欠席登録、補講予約\r\nも新たに機能追加され使用可能になりました。\r\n\r\nまた、\r\nこちらのアカウントを利用してアレンジ工房サイトよりレッスンで使用する\r\n楽譜、音源のダウンロードが可能となっております。\r\n今後、様々な機能を追加させて頂く予定ですので、\r\nよろしくお願いします。\r\n\r\nSecondCommunityへのログイン手順\r\n<%if @resource.sign_in_count == 0%>\r\n・下記のリンクよりパスワード初期設定を行なってください。\r\n<%= url_for edit_password_url(@resource, :reset_password_token => @resource.reset_password_token.html_safe, :initial => 'true'.html_safe).html_safe%>\r\n<%end%>\r\n・以下のURLへアクセスし、IDと設定したパスワードを使用してログインをしてください。\r\n■SecondCommunityサイトログインページ\r\n<%= ScConstants::SC_URL %>\r\nID: <%= @resource.email %>\r\n\r\n楽譜、音源ダウンロード手順\r\n・以下のURLへアクセスし、必要な楽曲を選択してください。\r\n・IDと設定したパスワードを入力していただくことでダウンロードが可能です。\r\n■アレンジ工房サイトログインページ\r\n<%= ScConstants::SC_URL_ARRANGE_KOUBOU %>\r\nID: <%= @resource.email %>\r\n\r\n※フィーチャーフォンから当サイトのご利用はできません。\r\nフィーチャーフォンでこのメールを受信された方は\r\nこのメールをお使いのパソコンへ転送し、\r\nパソコンからのアクセスをお願い致します。\r\n\r\n<%=render 'devise/mailer/support_info'%>\r\n```", "body_html"=>"<h2 data-sourcepos=\"1:1-1:38\" id=\"0-1-0\" name=\"0-1-0\"><a class=\"anchor\" id=\"import_user_from_motherメソッド\" name=\"import_user_from_motherメソッド\" href=\"#import_user_from_motherメソッド\" data-position=\"0-1-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"import_user_from_motherメソッド\"> &gt; import_user_from_motherメソッド</span></a>import_user_from_motherメソッド</h2>\n<p data-sourcepos=\"2:1-2:106\">ざっくりいうとmotherと紐づくSCの情報がなければ、SCのアカウントを作る処理。</p>\n<p data-sourcepos=\"4:1-4:50\">対象　活動中、休会、PC休会、開始前</p>\n<p data-sourcepos=\"6:1-7:82\">処理対象の会員情報(mother.members)を取ってくる。<br>\nカラムはid, pc_mail, mobile_mail, status_id, student, teacher, name, studio_id</p>\n<p data-sourcepos=\"9:1-9:78\">活動中クラスを持つ会員を取ってくる。(member_ids_with_lesson)</p>\n<p data-sourcepos=\"11:1-12:85\">処理対象の会員と SCのログイン用に設定するメールアドレスをhashで紐付ける。<br>\nSCのログイン用アドレスは、mother.pc_mail &gt; mother.mobile_mailが優先。</p>\n<h2 data-sourcepos=\"16:1-16:49\" id=\"0-2-0\" name=\"0-2-0\"><a class=\"anchor\" id=\"send_welcome_mail_to_initial_usersメソッド\" name=\"send_welcome_mail_to_initial_usersメソッド\" href=\"#send_welcome_mail_to_initial_usersメソッド\" data-position=\"0-2-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"send_welcome_mail_to_initial_usersメソッド\"> &gt; send_welcome_mail_to_initial_usersメソッド</span></a>send_welcome_mail_to_initial_usersメソッド</h2>\n<p data-sourcepos=\"17:1-17:42\">以下のメールを送っているだけ</p>\n<div class=\"code-block\" data-sourcepos=\"18:1-82:3\"><div class=\"code-filename\"><i class=\"fa fa-file-code-o\"></i>ruby</div><div class=\"highlight\"><pre class=\"highlight ruby\"><code><span class=\"err\">━━━━━━━━━━━━━━━━━━━━━━━</span>\n<span class=\"o\">&lt;%</span><span class=\"k\">if</span> <span class=\"vi\">@resource</span><span class=\"p\">.</span><span class=\"nf\">sign_in_count</span> <span class=\"o\">==</span> <span class=\"mi\">0</span><span class=\"o\">%&gt;</span>\n<span class=\"err\">【</span><span class=\"no\">EYS</span><span class=\"err\">】</span><span class=\"no\">SecondCommunity</span><span class=\"err\">アカウント作成のお知らせ</span>\n<span class=\"o\">&lt;%</span><span class=\"k\">else</span><span class=\"sx\">%&gt;\n【EYS】SecondCommunityアカウント更新のお知らせ\n&lt;%end%&gt;</span>\n<span class=\"err\">━━━━━━━━━━━━━━━━━━━━━━━</span>\n<span class=\"err\">こんにちは、</span><span class=\"o\">&lt;</span><span class=\"sx\">%= @resource.member.alt_name %&gt;様\n\nレッスンをさせていただき、ありがとうございます。\n\nEYS音楽教室ではレッスンの予約から\nご自宅での予習・復習まで、会員様の効率的な学習をサポートするため、\nSecondCommunityサイトを運営しております。\n&lt;%if @resource.sign_in_count =</span><span class=\"o\">=</span> <span class=\"mi\">0</span><span class=\"o\">%&gt;</span>\n<span class=\"err\">今回、当サイトのアカウントを作成しましたので、お知らせします。</span>\n<span class=\"err\">※以前アカウント作成連絡のメールを送付した方にも</span>\n<span class=\"no\">E</span><span class=\"err\">メールアドレスの変更が有った場合、再度このメールが送付される事がございます。</span>\n<span class=\"err\">その場合はご容赦ください。</span>\n<span class=\"o\">&lt;%</span><span class=\"k\">else</span><span class=\"sx\">%&gt;\n今回、当サイトで使用するアカウントIDを更新しましたので、お知らせします。\nID: &lt;%= @resource.email %&gt;</span>\n<span class=\"err\">以前設定していただいたパスワードは、そのまま使用出来ます。</span>\n<span class=\"o\">&lt;%</span><span class=\"k\">end</span><span class=\"sx\">%&gt;\n\n当サイトでは\n・来月末までのレッスン予定\n・今までに作成されたレッスンカルテ・フォロー\nの表示を行う事ができます。\nまた、\n・フリーレッスンの予約、キャンセル\n・固定レッスンの欠席登録、補講予約\nも新たに機能追加され使用可能になりました。\n\nまた、\nこちらのアカウントを利用してアレンジ工房サイトよりレッスンで使用する\n楽譜、音源のダウンロードが可能となっております。\n今後、様々な機能を追加させて頂く予定ですので、\nよろしくお願いします。\n\nSecondCommunityへのログイン手順\n&lt;%if @resource.sign_in_count == 0%&gt;</span>\n<span class=\"err\">・下記のリンクよりパスワード初期設定を行なってください。</span>\n<span class=\"o\">&lt;</span><span class=\"sx\">%= url_for edit_password_url(@resource, :reset_password_token =</span><span class=\"o\">&gt;</span> <span class=\"vi\">@resource</span><span class=\"p\">.</span><span class=\"nf\">reset_password_token</span><span class=\"p\">.</span><span class=\"nf\">html_safe</span><span class=\"p\">,</span> <span class=\"ss\">:initial</span> <span class=\"o\">=&gt;</span> <span class=\"s1\">'true'</span><span class=\"p\">.</span><span class=\"nf\">html_safe</span><span class=\"p\">).</span><span class=\"nf\">html_safe</span><span class=\"o\">%&gt;</span>\n<span class=\"o\">&lt;%</span><span class=\"k\">end</span><span class=\"sx\">%&gt;\n・以下のURLへアクセスし、IDと設定したパスワードを使用してログインをしてください。\n■SecondCommunityサイトログインページ\n&lt;%= ScConstants::SC_URL %&gt;</span>\n<span class=\"no\">ID</span><span class=\"p\">:</span> <span class=\"o\">&lt;</span><span class=\"sx\">%= @resource.email %&gt;\n\n楽譜、音源ダウンロード手順\n・以下のURLへアクセスし、必要な楽曲を選択してください。\n・IDと設定したパスワードを入力していただくことでダウンロードが可能です。\n■アレンジ工房サイトログインページ\n&lt;%=</span> <span class=\"no\">ScConstants</span><span class=\"o\">::</span><span class=\"no\">SC_URL_ARRANGE_KOUBOU</span> <span class=\"sx\">%&gt;\nID: &lt;%= @resource.email %&gt;</span>\n\n<span class=\"err\">※フィーチャーフォンから当サイトのご利用はできません。</span>\n<span class=\"err\">フィーチャーフォンでこのメールを受信された方は</span>\n<span class=\"err\">このメールをお使いのパソコンへ転送し、</span>\n<span class=\"err\">パソコンからのアクセスをお願い致します。</span>\n\n<span class=\"o\">&lt;</span><span class=\"sx\">%=render 'devise/mailer/support_info'%&gt;\n</span></code></pre></div></div>\n", "created_at"=>"2022-09-15T16:41:54+09:00", "message"=>"Update post.", "kind"=>"stock", "comments_count"=>0, "tasks_count"=>0, "done_tasks_count"=>0, "url"=>"https://2nd-community.esa.io/posts/611", "updated_at"=>"2023-01-25T21:35:13+09:00", "tags"=>[], "category"=>"システム本部/運用保守", "revision_number"=>3, "created_by"=>{"myself"=>true, "name"=>"吉田直人", "screen_name"=>"naoto_yoshida", "icon"=>"https://img.esa.io/uploads/production/users/105730/icon/thumb_m_7ed6de39594feb35d005206783298fdb.png"}, "updated_by"=>{"myself"=>true, "name"=>"吉田直人", "screen_name"=>"naoto_yoshida", "icon"=>"https://img.esa.io/uploads/production/users/105730/icon/thumb_m_7ed6de39594feb35d005206783298fdb.png"}, "stargazers_count"=>0, "watchers_count"=>1, "star"=>false, "watch"=>true, "sharing_urls"=>nil}, {"number"=>656, "name"=>"テレマ・サポートチーム＆システム保守チーム連携 週次Meeting（１月２５日）", "full_name"=>"システム本部/チーム/テレマ・サポートチーム＆システム保守チーム連携 週次Meeting（１月２５日）", "wip"=>false, "body_md"=>"開催日時： 2023/01/25 16:30-17:00\r\n進行：石田、議事：吉田さん\r\n\r\n# １．情報共有\r\n\r\n## テレマ・サポートチーム\r\n\r\n## システム保守チーム\r\n\r\n# ２．前回の見直しと対応結果\r\n前回議事：[テレマ・サポートチーム＆システム保守チーム定例会議](https://app.asana.com/0/1196247230098161/1203769874956748/f)\r\n#### チケットについて\r\n　・対象 700件に対して、データ補正、データ削除の対応を進めている → 残り300件\r\n　・対象一覧についてテレマさんに連携は必要ないか？\r\n　・チケットの使用履歴の照会画面 → データ修正後の実装を予定\r\n#### SC紐付け\r\n・優先度を上げる。吉田が現在対応しているタスクが終わったら着手する(石田さん)\r\n\r\n# ３．要望ヒアリング＆対応優先度相談\r\n## テレマ・サポートチーム\r\n・チケット問題について\r\n現状一番まずいのがチケット問題。現状どうなっているのか？(北川さん)\r\n→不具合が起きている原因が不明なデータが多い。今存在しているレコードが正しい状態なのか分からず、対応が難しい。(高田さん)\r\n→レッスンのキャンセルをした後、戻ったチケットでレッスンが予約できないケースがある(北川さん)\r\n→要調査。同様のケースのタスクを後から共有してほしい(大澤さん)\r\n→オールフリークラスで複数のクラスを持っていることが問題？(大澤さん、北川さん)\r\n→チケット関連の作業で北川さんの作業が圧迫している状態(北川さん)\r\n→問題解決のため、下垣さんを投入する？要検討。(下垣さん)\r\n\r\n## システム保守チーム\r\n　SMS（ショートメッセージ）の手動送信について、本文の短縮またはEmailへの代替えが可能であるか？\r\n　- SQSQから送っているのか？\r\n　- 本文の文字数制限を検討（現状の制限を下垣さんにて確認）\r\n　→SMSで長文を送ると、自動で複数件SMSが送信される。(石田さん)\r\n 　→motherからSMSを送る場合は文字列制限がかかっている(下垣さん)\r\n→SMSを送る際にシステムで制御をかけたりワーニングを出すようにした方がいい(大澤さん)\r\n→SMSが高価であることをメンバーが知らない可能性もある。周知する(北川さん)\r\n\r\n# ４．[トピック] 不具合対応の優先度\r\n\r\n# ５．各種質問\r\n作業ベースの対応依頼がシステム部の方にいっていないか(北川さん)\r\n→そのような依頼は無い(石田さん、吉田)\r\n\r\nテレマ→開発部へのAsanaタスク切り替わりのタイミング確認\r\n\r\n# その他、宿題整理・次回開催確認\r\n\r\n\r\n\r\n---\r\n\r\n ", "body_html"=>"<p data-sourcepos=\"1:1-2:39\">開催日時： 2023/01/25 16:30-17:00<br>\n進行：石田、議事：吉田さん</p>\n<h1 data-sourcepos=\"4:1-4:20\" id=\"1-0-0\" name=\"1-0-0\"><a class=\"anchor\" id=\"１．情報共有\" name=\"１．情報共有\" href=\"#１．情報共有\" data-position=\"1-0-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"１．情報共有\"> &gt; １．情報共有</span></a>１．情報共有</h1>\n<h2 data-sourcepos=\"6:1-6:36\" id=\"1-1-0\" name=\"1-1-0\"><a class=\"anchor\" id=\"テレマ・サポートチーム\" name=\"テレマ・サポートチーム\" href=\"#テレマ・サポートチーム\" data-position=\"1-1-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"テレマ・サポートチーム\"> &gt; テレマ・サポートチーム</span></a>テレマ・サポートチーム</h2>\n<h2 data-sourcepos=\"8:1-8:30\" id=\"1-2-0\" name=\"1-2-0\"><a class=\"anchor\" id=\"システム保守チーム\" name=\"システム保守チーム\" href=\"#システム保守チーム\" data-position=\"1-2-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"システム保守チーム\"> &gt; システム保守チーム</span></a>システム保守チーム</h2>\n<h1 data-sourcepos=\"10:1-10:41\" id=\"2-0-0\" name=\"2-0-0\"><a class=\"anchor\" id=\"２．前回の見直しと対応結果\" name=\"２．前回の見直しと対応結果\" href=\"#２．前回の見直しと対応結果\" data-position=\"2-0-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"２．前回の見直しと対応結果\"> &gt; ２．前回の見直しと対応結果</span></a>２．前回の見直しと対応結果</h1>\n<p data-sourcepos=\"11:1-11:153\">前回議事：<a href=\"https://app.asana.com/0/1196247230098161/1203769874956748/f\" target=\"_blank\" rel=\"noopener noreferrer\">テレマ・サポートチーム＆システム保守チーム定例会議</a></p>\n<h4 data-sourcepos=\"12:1-12:29\">チケットについて</h4>\n<p data-sourcepos=\"13:1-15:89\">　・対象 700件に対して、データ補正、データ削除の対応を進めている → 残り300件<br>\n　・対象一覧についてテレマさんに連携は必要ないか？<br>\n　・チケットの使用履歴の照会画面 → データ修正後の実装を予定</p>\n<h4 data-sourcepos=\"16:1-16:16\">SC紐付け</h4>\n<p data-sourcepos=\"17:1-17:113\">・優先度を上げる。吉田が現在対応しているタスクが終わったら着手する(石田さん)</p>\n<h1 data-sourcepos=\"19:1-19:53\" id=\"3-0-0\" name=\"3-0-0\"><a class=\"anchor\" id=\"３．要望ヒアリング＆対応優先度相談\" name=\"３．要望ヒアリング＆対応優先度相談\" href=\"#３．要望ヒアリング＆対応優先度相談\" data-position=\"3-0-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"３．要望ヒアリング＆対応優先度相談\"> &gt; ３．要望ヒアリング＆対応優先度相談</span></a>３．要望ヒアリング＆対応優先度相談</h1>\n<h2 data-sourcepos=\"20:1-20:36\" id=\"3-1-0\" name=\"3-1-0\"><a class=\"anchor\" id=\"テレマ・サポートチーム-1\" name=\"テレマ・サポートチーム-1\" href=\"#テレマ・サポートチーム-1\" data-position=\"3-1-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"テレマ・サポートチーム\"> &gt; テレマ・サポートチーム</span></a>テレマ・サポートチーム</h2>\n<p data-sourcepos=\"21:1-28:83\">・チケット問題について<br>\n現状一番まずいのがチケット問題。現状どうなっているのか？(北川さん)<br>\n→不具合が起きている原因が不明なデータが多い。今存在しているレコードが正しい状態なのか分からず、対応が難しい。(高田さん)<br>\n→レッスンのキャンセルをした後、戻ったチケットでレッスンが予約できないケースがある(北川さん)<br>\n→要調査。同様のケースのタスクを後から共有してほしい(大澤さん)<br>\n→オールフリークラスで複数のクラスを持っていることが問題？(大澤さん、北川さん)<br>\n→チケット関連の作業で北川さんの作業が圧迫している状態(北川さん)<br>\n→問題解決のため、下垣さんを投入する？要検討。(下垣さん)</p>\n<h2 data-sourcepos=\"30:1-30:30\" id=\"3-2-0\" name=\"3-2-0\"><a class=\"anchor\" id=\"システム保守チーム-1\" name=\"システム保守チーム-1\" href=\"#システム保守チーム-1\" data-position=\"3-2-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"システム保守チーム\"> &gt; システム保守チーム</span></a>システム保守チーム</h2>\n<p data-sourcepos=\"31:1-37:107\">　SMS（ショートメッセージ）の手動送信について、本文の短縮またはEmailへの代替えが可能であるか？<br>\n　- SQSQから送っているのか？<br>\n　- 本文の文字数制限を検討（現状の制限を下垣さんにて確認）<br>\n　→SMSで長文を送ると、自動で複数件SMSが送信される。(石田さん)<br>\n　→motherからSMSを送る場合は文字列制限がかかっている(下垣さん)<br>\n→SMSを送る際にシステムで制御をかけたりワーニングを出すようにした方がいい(大澤さん)<br>\n→SMSが高価であることをメンバーが知らない可能性もある。周知する(北川さん)</p>\n<h1 data-sourcepos=\"39:1-39:50\" id=\"4-0-0\" name=\"4-0-0\"><a class=\"anchor\" id=\"４．[トピック] 不具合対応の優先度\" name=\"４．[トピック] 不具合対応の優先度\" href=\"#４．[トピック] 不具合対応の優先度\" data-position=\"4-0-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"４．[トピック] 不具合対応の優先度\"> &gt; ４．[トピック] 不具合対応の優先度</span></a>４．[トピック] 不具合対応の優先度</h1>\n<h1 data-sourcepos=\"41:1-41:20\" id=\"5-0-0\" name=\"5-0-0\"><a class=\"anchor\" id=\"５．各種質問\" name=\"５．各種質問\" href=\"#５．各種質問\" data-position=\"5-0-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"５．各種質問\"> &gt; ５．各種質問</span></a>５．各種質問</h1>\n<p data-sourcepos=\"42:1-43:56\">作業ベースの対応依頼がシステム部の方にいっていないか(北川さん)<br>\n→そのような依頼は無い(石田さん、吉田)</p>\n<p data-sourcepos=\"45:1-45:80\">テレマ→開発部へのAsanaタスク切り替わりのタイミング確認</p>\n<h1 data-sourcepos=\"47:1-47:47\" id=\"6-0-0\" name=\"6-0-0\"><a class=\"anchor\" id=\"その他、宿題整理・次回開催確認\" name=\"その他、宿題整理・次回開催確認\" href=\"#その他、宿題整理・次回開催確認\" data-position=\"6-0-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"その他、宿題整理・次回開催確認\"> &gt; その他、宿題整理・次回開催確認</span></a>その他、宿題整理・次回開催確認</h1>\n<hr data-sourcepos=\"51:1-53:1\">\n", "created_at"=>"2023-01-24T18:05:33+09:00", "message"=>"Update post.", "kind"=>"stock", "comments_count"=>0, "tasks_count"=>0, "done_tasks_count"=>0, "url"=>"https://2nd-community.esa.io/posts/656", "updated_at"=>"2023-01-25T06:51:25+09:00", "tags"=>[], "category"=>"システム本部/チーム", "revision_number"=>13, "created_by"=>{"myself"=>false, "name"=>"石田裕三", "screen_name"=>"yuzo_ishida", "icon"=>"https://img.esa.io/uploads/production/users/128235/icon/thumb_m_666eede25b43a9ff04d9783c9ada7b11.png"}, "updated_by"=>{"myself"=>true, "name"=>"吉田直人", "screen_name"=>"naoto_yoshida", "icon"=>"https://img.esa.io/uploads/production/users/105730/icon/thumb_m_7ed6de39594feb35d005206783298fdb.png"}, "stargazers_count"=>0, "watchers_count"=>2, "star"=>false, "watch"=>true, "sharing_urls"=>nil}, {"number"=>622, "name"=>"サイト監視", "full_name"=>"システム本部/インフラ/サイト監視", "wip"=>false, "body_md"=>"Copied from: [システム本部/インフラ/サーバー監視](/posts/609)\r\n\r\n# 前提\r\nWEB開発課で運用のサイト監視について記載する\r\n- サイト監視は、外形監視にて実装する\r\n\r\n# 外形監視\r\nユーザーと同様の方法でWEBアクセスして正常性を監視する方法を外形監視（Synthetic Monitoring）と呼ぶ\r\n\r\n## 実装方法\r\n- AWS CloudWatch の **[Synthetics Canary](https://ap-northeast-1.console.aws.amazon.com/cloudwatch/home?region=ap-northeast-1#synthetics:canary/list)** の機能で監視\r\n- エンドユーザーが実際に操作する手順にて自動監視を行い、異常があった場合は通報を行います。\r\n※フォームページに必要項目を入力して登録の正常性を確認する事も可能ではあるが（DB連携処理の確認）、2022年11月現在未実装\r\n\r\n- チェック時のエビデンスがS3に保存されるため、過去に遡ってページの状況確認が可能\r\n<img width=\"977\" alt=\"image.png (124.7 kB)\" src=\"https://img.esa.io/uploads/production/attachments/14521/2022/10/26/128235/1ff5e274-28f0-4faa-9eab-7a756910e2d3.png\">\r\n\r\n\r\n## 監視ネットワーク構成\r\nGA4にて監視アクセスを除外するため、Canaryに静的IPアドレスを持たせる必要が生じた。\r\nそのため、以下の構成とする事で対応した。\r\n\r\n- 監視用のVPC「monitoring-vpc」を新設して、その中のプライベートサブネット（Internetに閉ざされた空間）で 「Synthetics Canaries」を稼働\r\n- CanaryにElastic IPアドレス（EIP：**3.115.167.69**）を持たせることで監視アクセスを静的なIPアドレスとする\r\n- NATゲートウェイを経由する Internetの外に出る通信は課金されてしまうため、S3と直結できる GWとエンドイントを設け、NATゲートウェイを経由しない通信方式とした\r\n\r\n<img width=\"1264\" alt=\"image.png (79.4 kB)\" src=\"https://img.esa.io/uploads/production/attachments/14521/2022/11/04/128235/703da0ac-9aee-4345-b676-3984721ce187.png\">\r\n\r\n\r\n\r\n## 監視内容\r\n\r\n### 監視パラメータ\r\n\r\n| 監視対象  | Canary名 | チェック間隔(分) |チェック方法 |エビデンス保存期間|アラート条件|\r\n| -------- | -------- | -------- |-------- |-------- |-------- |\r\n| https://mother.2nd-community.com/users/sign_in      | corp-2nd-community2 | 30min     |   ハートビート   |成功30日、失敗30日      |  2回連続失敗   |\r\n| https://cleangent.2nd-community.com/      | cleangent2  | 30min     |   ハートビート   |成功30日、失敗30日      |  2回連続失敗   |\r\n| https://www.eys-musicschool.com/experience/     | eys-musicschool-com2  | 30min     |   ハートビート   |成功30日、失敗30日      |  2回連続失敗   |\r\n| https://eys-kids.com/art-college/music/trial/    | eys-kids-com2  | 30min     |   ハートビート   |成功30日、失敗30日      |  2回連続失敗   |\r\n| https://junior-musicschool.com/experience/form/    | junior-musicschool2  | 30min     |   ハートビート   |成功30日、失敗30日      |  2回連続失敗   |\r\n| https://www.on-girl.jp/contact/   | on-girl-jp2  | 30min     |   ハートビート   |成功30日、失敗30日      |  2回連続失敗   |\r\n| https://otona-club.net/experience/   | otona-club-net2  | 30min     |   ハートビート   |成功30日、失敗30日      |  2回連続失敗   |\r\n| https://www.recruit-musicschool.com/form/  | recruit-musicschool2 | 30min     |   ハートビート   |成功30日、失敗30日      |  2回連続失敗   |\r\n| https://art-lesson.2nd-community.com/api/web_form/view?token=XfysTzD5p5k9NXt//CmySGoEsshzUPTjg1uQipDmJyx=  | api_web_form | 30min     |   ハートビート   |成功30日、失敗30日      |  2回連続失敗   |\r\n\r\n※Canary名の指定は、使用文字列、文字数制限があったため省略形の名称で設定\r\n※Canary名末尾に数字はリビジョンを表す\r\n※api_web_form のtokenの値 mother.users.id = 1474（EYS音楽教室）のauthentication_tokenカラムの値を指定\r\n\r\n- 監視設定情報ソース：\r\n[**監視対象一覧：申し込みフォーム一覧表**](https://docs.google.com/spreadsheets/d/1zCZwIq7koTLpxyzfnscjOQFk6knsbAy6aSLn9N5T5jU/edit#gid=185959370)　※監視対象 列が「○」のもの （※酒井さん提供資料）\r\n\r\n\r\n### 監視結果のログ\r\nいずれも監視チェック時のエビデンスをS3に自動保存して、指定期間保管する。\r\n初期値として「31日（〜1か月）」を指定したが、監視対象毎にカスタム値を指定する事も可能。\r\n<img width=\"336\" alt=\"image.png (79.4 kB)\" src=\"https://img.esa.io/uploads/production/attachments/14521/2022/10/26/128235/0764468a-51cf-4bbb-9cf1-8811e9c194a7.png\">\r\n\r\n\r\n### アラート通知条件\r\nチェックが２回連続でNGだった場合にエラー通知する。\r\n従って、チェック間隔が３０分の監視は最大６０分ほど エラー検知からアラート通知まで時間を要することになる。\r\n\r\n設定箇所：Cloudwatch アラーム\r\n<img width=\"778\" alt=\"image.png (79.7 kB)\" src=\"https://img.esa.io/uploads/production/attachments/14521/2022/09/20/128235/5b55404a-33df-43a6-862e-9b49882e3b0c.png\">\r\n\r\n\r\n\r\n## 通報内容とアクション\r\n- 通報先はSlackのチャネル「**＃ website_health**」とする\r\n- アラート検知時に自動復旧コマンドなどの指定はしていないため、対象のサービスが正常に稼働しているかどうか目視確認を行うこととします。\r\n\r\n- 通知サンプル\r\n下記のようにSlackにアラートが飛びます。\r\n\r\n<img width=\"251\" alt=\"image.png (3.1 kB)\" src=\"https://img.esa.io/uploads/production/attachments/14521/2022/10/26/128235/08c11c9a-4a01-4bf0-8702-f7febb00b4eb.png\">\r\n<br>\r\n\r\n本文が無駄に長いですが（AWS Canaryの仕様）、件名のcanary名とDescriptionの下にある記述に着目してください。\r\n<img width=\"638\" alt=\"image.png (107.5 kB)\" src=\"https://img.esa.io/uploads/production/attachments/14521/2022/10/26/128235/d4fbc3ca-6035-42fd-b624-93ebe672bf79.png\">\r\n\r\n\r\n## Synthetics Canaries の設定手順\r\n\r\n### サイト監視追加手順\r\n##### 最も簡単な方法は、既存の監視設定をクローンして作成する方法です。\r\n\r\n<img width=\"935\" alt=\"image.png (67.7 kB)\" src=\"https://img.esa.io/uploads/production/attachments/14521/2022/11/04/128235/15466994-6539-4b03-9e52-1659d1453a6e.png\">\r\n\r\n##### 1. 名前を任意で入力\r\n※文字数制限、使用文字列制限（大文字禁止、記号は一部のみ利用可）があるので注意\r\n<img width=\"605\" alt=\"image.png (25.0 kB)\" src=\"https://img.esa.io/uploads/production/attachments/14521/2022/11/04/128235/f6b910c5-41a0-4907-acf9-1d2590682e98.png\">\r\n\r\n##### 2. 監視対象ページのURLを指定のものに変更\r\nScript editor内の記述は基本的にはここの編集だけでOK\r\n<img width=\"540\" alt=\"image.png (89.7 kB)\" src=\"https://img.esa.io/uploads/production/attachments/14521/2022/11/04/128235/97e64b52-389f-493d-91cd-cc57f960b63f.png\">\r\n\r\n#### スケジュールの設定をする場合（1/24追記）\r\n\r\n詳細監視設定など、監視頻度の低いタスクの実行時間設定には、CRONの記述を使うことができる。下記は2時間おきに実行する場合\r\n\r\n<img width=\"790\" alt=\"image.png (151.4 kB)\" src=\"https://img.esa.io/uploads/production/attachments/14521/2023/01/24/128235/6260ae79-e7ef-43de-ab73-f9332e52fed8.png\">\r\n\r\n\r\n##### 3. アラーム設定\r\n以下の通り設定\r\n<img width=\"813\" alt=\"image.png (37.2 kB)\" src=\"https://img.esa.io/uploads/production/attachments/14521/2022/11/04/128235/6ae25c6e-7025-4371-97aa-9fc7187d9312.png\">\r\n\r\n\r\n##### 基本的に上記1,2,3以外の設定の変更は必要ない\r\n下記の設定項目も「Create a new role」（デフォルト値）でOK\r\n<img width=\"819\" alt=\"image.png (31.4 kB)\" src=\"https://img.esa.io/uploads/production/attachments/14521/2022/11/04/128235/720e5937-1117-4bb4-b837-a42e7e673534.png\">\r\n\r\n\r\n\r\n#### VPC設定が下記のとおりとなっている事を確認\r\n\r\n<img width=\"737\" alt=\"image.png (104.0 kB)\" src=\"https://img.esa.io/uploads/production/attachments/14521/2022/11/04/128235/dc1321c5-37c3-4bf2-a009-7c1bfff594d4.png\">\r\n\r\n\r\n#### 「Create  canary」を押して設定を保存する\r\n<img width=\"283\" alt=\"image.png (4.5 kB)\" src=\"https://img.esa.io/uploads/production/attachments/14521/2022/11/04/128235/0ce397ea-4ddd-42ba-b32b-53cf9f751080.png\">\r\n\r\n\r\n#### Canariesの設定画面に追加した監視項目が追加されるのを確認\r\n<img width=\"1162\" alt=\"image.png (139.4 kB)\" src=\"https://img.esa.io/uploads/production/attachments/14521/2022/11/04/128235/70e8fb49-3527-4572-a080-2f2386437000.png\">\r\n\r\n\r\n### アラート通知設定手順\r\n対象の監視設定画面で「Configuration」タブ内にあるAlarm name の箇所のリンクを開く\r\n<img width=\"837\" alt=\"image.png (69.3 kB)\" src=\"https://img.esa.io/uploads/production/attachments/14521/2022/11/04/128235/c877c238-b645-4dd1-9a79-dd98d55bab31.png\">\r\n\r\nCloudwatchアラームのページに遷移するので「Actions」の「Edit」をクリック\r\n<img width=\"226\" alt=\"image.png (12.7 kB)\" src=\"https://img.esa.io/uploads/production/attachments/14521/2022/11/04/128235/2d50e5db-3807-4800-8559-acf9c6c6d635.png\">\r\n\r\n以下、変更点のみ記載（記載無き箇所はデフォルト値とする）\r\n<img width=\"759\" alt=\"image.png (29.4 kB)\" src=\"https://img.esa.io/uploads/production/attachments/14521/2022/11/04/128235/29e91dcc-d9dc-4350-81f7-00820a7c7421.png\">\r\n次へ（next）\r\n\r\nAdd notification（通知の追加）を押して、次の通り指定\r\n<img width=\"421\" alt=\"image.png (12.4 kB)\" src=\"https://img.esa.io/uploads/production/attachments/14521/2022/11/16/128235/42b39eaa-1423-4316-956d-8c86485be57c.png\">\r\n\r\n<img width=\"761\" alt=\"image.png (92.2 kB)\" src=\"https://img.esa.io/uploads/production/attachments/14521/2022/11/04/128235/7045fd50-e5bd-41f3-9f48-8b72aabba285.png\">\r\n次へ（next）\r\n\r\nSlackにアラート通知された場合にわかりやすいように本文をカスタマイズする\r\n※以下例\r\n<img width=\"778\" alt=\"image.png (57.4 kB)\" src=\"https://img.esa.io/uploads/production/attachments/14521/2022/11/04/128235/886d2c5f-db20-449b-8657-f9aff54f9efe.png\">\r\n次へ（next）\r\n設定内容を確認して問題なければ、「Update Alarm」\r\n<img width=\"142\" alt=\"image.png (2.6 kB)\" src=\"https://img.esa.io/uploads/production/attachments/14521/2022/11/04/128235/da64ce10-5c7a-4a79-b260-77937b9ed683.png\">\r\n\r\n\r\n### 監視設定削除手順\r\n不要となった監視項目を削除する場合は下記の操作を行います\r\n\r\nActionからDeleteを選択\r\n<img width=\"1149\" alt=\"image.png (39.8 kB)\" src=\"https://img.esa.io/uploads/production/attachments/14521/2022/11/04/128235/e0d8ea30-1122-408a-9529-11f70d016001.png\">\r\n\r\n全てにチェックを入れて「削除」をクリック\r\n<img width=\"1316\" alt=\"image.png (92.8 kB)\" src=\"https://img.esa.io/uploads/production/attachments/14521/2022/11/04/128235/6ab55b0a-1637-42e1-8169-e8b212c5ae09.png\">\r\n\r\n「Delete」を入力して「確認」をクリック\r\n<img width=\"615\" alt=\"image.png (25.5 kB)\" src=\"https://img.esa.io/uploads/production/attachments/14521/2022/11/04/128235/63249313-1ae1-46bb-8d25-5cbf4d642842.png\">\r\n\r\n\r\n### 複数の監視をひとまとめにする手順（費用削減効果あり）\r\n**注意点！ 複数監視をまとめる事ができるのは、heartbeat監視のみとなる。**\r\n（HTML要素取得、ID・PW入力を行なう詳細監視では対応不可）\r\n<img width=\"792\" alt=\"image.png (264.4 kB)\" src=\"https://img.esa.io/uploads/production/attachments/14521/2023/01/24/128235/04534b3d-e091-475b-a7f7-8a52d46204c2.png\">\r\n\r\n複数をまとめた場合のアラート設定は、本文を工夫する必要あり。（以下例）\r\n<img width=\"577\" alt=\"image.png (130.3 kB)\" src=\"https://img.esa.io/uploads/production/attachments/14521/2023/01/24/128235/bb7830ea-5504-400e-8b1d-b727130cadbf.png\">\r\n\r\n\r\n\r\n### 監視グループの設定 （1/24追記）\r\n監視項目が増えてくると一覧が多くなり、見通しが悪くなる。\r\nグループごとにまとめる事により、把握しやすくなる。\r\n\r\n※グループ分け案\r\n| グループ名 |  用途 | \r\n| -------- | -------- | \r\n| sysDevGr     | 主にシステム開発課で管理のサーバー、サイト     | \r\n| webDevGr-1 | 主にWEB開発課で管理のサーバー、サイトその１ |\r\n| webDevGr-2    | 主にWEB開発課で管理のサーバー、サイトその２  | \r\n\r\n\r\n\r\n---\r\n\r\n### トラブルシュート編\r\n- Canary管理画面が表示されない　→　AWSの言語設定を英語に変更すると改善する場合がある\r\n\r\n\r\n---\r\n\r\n\r\n", "body_html"=>"<p data-sourcepos=\"1:1-1:77\">Copied from: <a href=\"/posts/609\">システム本部/インフラ/サーバー監視</a></p>\n<h1 data-sourcepos=\"3:1-3:8\" id=\"1-0-0\" name=\"1-0-0\"><a class=\"anchor\" id=\"前提\" name=\"前提\" href=\"#前提\" data-position=\"1-0-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"前提\"> &gt; 前提</span></a>前提</h1>\n<p data-sourcepos=\"4:1-4:63\">WEB開発課で運用のサイト監視について記載する</p>\n<ul data-sourcepos=\"5:1-6:0\">\n<li data-sourcepos=\"5:1-6:0\">サイト監視は、外形監視にて実装する</li>\n</ul>\n<h1 data-sourcepos=\"7:1-7:14\" id=\"2-0-0\" name=\"2-0-0\"><a class=\"anchor\" id=\"外形監視\" name=\"外形監視\" href=\"#外形監視\" data-position=\"2-0-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"外形監視\"> &gt; 外形監視</span></a>外形監視</h1>\n<p data-sourcepos=\"8:1-8:134\">ユーザーと同様の方法でWEBアクセスして正常性を監視する方法を外形監視（Synthetic Monitoring）と呼ぶ</p>\n<h2 data-sourcepos=\"10:1-10:15\" id=\"2-1-0\" name=\"2-1-0\"><a class=\"anchor\" id=\"実装方法\" name=\"実装方法\" href=\"#実装方法\" data-position=\"2-1-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"実装方法\"> &gt; 実装方法</span></a>実装方法</h2>\n<ul data-sourcepos=\"11:1-15:118\">\n<li data-sourcepos=\"11:1-11:171\"><p data-sourcepos=\"11:3-11:171\">AWS CloudWatch の <strong><a href=\"https://ap-northeast-1.console.aws.amazon.com/cloudwatch/home?region=ap-northeast-1#synthetics:canary/list\" target=\"_blank\" rel=\"noopener noreferrer\">Synthetics Canary</a></strong> の機能で監視</p></li>\n<li data-sourcepos=\"12:1-14:0\"><p data-sourcepos=\"12:3-13:173\">エンドユーザーが実際に操作する手順にて自動監視を行い、異常があった場合は通報を行います。<br>\n※フォームページに必要項目を入力して登録の正常性を確認する事も可能ではあるが（DB連携処理の確認）、2022年11月現在未実装</p></li>\n<li data-sourcepos=\"15:1-15:118\"><p data-sourcepos=\"15:3-15:118\">チェック時のエビデンスがS3に保存されるため、過去に遡ってページの状況確認が可能</p></li>\n</ul>\n<a href=\"https://img.esa.io/uploads/production/attachments/14521/2022/10/26/128235/1ff5e274-28f0-4faa-9eab-7a756910e2d3.png\" target=\"_blank\" rel=\"noopener noreferrer\"><img width=\"977\" alt=\"image.png (124.7 kB)\" src=\"https://img.esa.io/uploads/production/attachments/14521/2022/10/26/128235/1ff5e274-28f0-4faa-9eab-7a756910e2d3.png\"></a>\n<h2 data-sourcepos=\"19:1-19:33\" id=\"2-2-0\" name=\"2-2-0\"><a class=\"anchor\" id=\"監視ネットワーク構成\" name=\"監視ネットワーク構成\" href=\"#監視ネットワーク構成\" data-position=\"2-2-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"監視ネットワーク構成\"> &gt; 監視ネットワーク構成</span></a>監視ネットワーク構成</h2>\n<p data-sourcepos=\"20:1-21:60\">GA4にて監視アクセスを除外するため、Canaryに静的IPアドレスを持たせる必要が生じた。<br>\nそのため、以下の構成とする事で対応した。</p>\n<ul data-sourcepos=\"23:1-26:0\">\n<li data-sourcepos=\"23:1-23:176\">監視用のVPC「monitoring-vpc」を新設して、その中のプライベートサブネット（Internetに閉ざされた空間）で 「Synthetics Canaries」を稼働</li>\n<li data-sourcepos=\"24:1-24:138\">CanaryにElastic IPアドレス（EIP：<strong>3.115.167.69</strong>）を持たせることで監視アクセスを静的なIPアドレスとする</li>\n<li data-sourcepos=\"25:1-26:0\">NATゲートウェイを経由する Internetの外に出る通信は課金されてしまうため、S3と直結できる GWとエンドイントを設け、NATゲートウェイを経由しない通信方式とした</li>\n</ul>\n<a href=\"https://img.esa.io/uploads/production/attachments/14521/2022/11/04/128235/703da0ac-9aee-4345-b676-3984721ce187.png\" target=\"_blank\" rel=\"noopener noreferrer\"><img width=\"1264\" alt=\"image.png (79.4 kB)\" src=\"https://img.esa.io/uploads/production/attachments/14521/2022/11/04/128235/703da0ac-9aee-4345-b676-3984721ce187.png\"></a>\n<h2 data-sourcepos=\"31:1-31:15\" id=\"2-3-0\" name=\"2-3-0\"><a class=\"anchor\" id=\"監視内容\" name=\"監視内容\" href=\"#監視内容\" data-position=\"2-3-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"監視内容\"> &gt; 監視内容</span></a>監視内容</h2>\n<h3 data-sourcepos=\"33:1-33:25\" id=\"2-3-1\" name=\"2-3-1\"><a class=\"anchor\" id=\"監視パラメータ\" name=\"監視パラメータ\" href=\"#監視パラメータ\" data-position=\"2-3-1\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"監視パラメータ\"> &gt; 監視パラメータ</span></a>監視パラメータ</h3>\n<table data-sourcepos=\"35:1-45:216\">\n<thead>\n<tr data-sourcepos=\"35:1-35:122\">\n<th data-sourcepos=\"35:2-35:16\">監視対象</th>\n<th data-sourcepos=\"35:18-35:28\">Canary名</th>\n<th data-sourcepos=\"35:30-35:54\">チェック間隔(分)</th>\n<th data-sourcepos=\"35:56-35:74\">チェック方法</th>\n<th data-sourcepos=\"35:76-35:102\">エビデンス保存期間</th>\n<th data-sourcepos=\"35:104-35:121\">アラート条件</th>\n</tr>\n</thead>\n<tbody>\n<tr data-sourcepos=\"37:1-37:168\">\n<td data-sourcepos=\"37:2-37:54\"><a href=\"https://mother.2nd-community.com/users/sign_in\" target=\"_blank\" rel=\"noopener noreferrer\">https://mother.2nd-community.com/users/sign_in</a></td>\n<td data-sourcepos=\"37:56-37:76\">corp-2nd-community2</td>\n<td data-sourcepos=\"37:78-37:88\">30min</td>\n<td data-sourcepos=\"37:90-37:113\">ハートビート</td>\n<td data-sourcepos=\"37:115-37:145\">成功30日、失敗30日</td>\n<td data-sourcepos=\"37:147-37:167\">2回連続失敗</td>\n</tr>\n<tr data-sourcepos=\"38:1-38:150\">\n<td data-sourcepos=\"38:2-38:44\"><a href=\"https://cleangent.2nd-community.com/\" target=\"_blank\" rel=\"noopener noreferrer\">https://cleangent.2nd-community.com/</a></td>\n<td data-sourcepos=\"38:46-38:58\">cleangent2</td>\n<td data-sourcepos=\"38:60-38:70\">30min</td>\n<td data-sourcepos=\"38:72-38:95\">ハートビート</td>\n<td data-sourcepos=\"38:97-38:127\">成功30日、失敗30日</td>\n<td data-sourcepos=\"38:129-38:149\">2回連続失敗</td>\n</tr>\n<tr data-sourcepos=\"39:1-39:166\">\n<td data-sourcepos=\"39:2-39:50\"><a href=\"https://www.eys-musicschool.com/experience/\" target=\"_blank\" rel=\"noopener noreferrer\">https://www.eys-musicschool.com/experience/</a></td>\n<td data-sourcepos=\"39:52-39:74\">eys-musicschool-com2</td>\n<td data-sourcepos=\"39:76-39:86\">30min</td>\n<td data-sourcepos=\"39:88-39:111\">ハートビート</td>\n<td data-sourcepos=\"39:113-39:143\">成功30日、失敗30日</td>\n<td data-sourcepos=\"39:145-39:165\">2回連続失敗</td>\n</tr>\n<tr data-sourcepos=\"40:1-40:160\">\n<td data-sourcepos=\"40:2-40:51\"><a href=\"https://eys-kids.com/art-college/music/trial/\" target=\"_blank\" rel=\"noopener noreferrer\">https://eys-kids.com/art-college/music/trial/</a></td>\n<td data-sourcepos=\"40:53-40:68\">eys-kids-com2</td>\n<td data-sourcepos=\"40:70-40:80\">30min</td>\n<td data-sourcepos=\"40:82-40:105\">ハートビート</td>\n<td data-sourcepos=\"40:107-40:137\">成功30日、失敗30日</td>\n<td data-sourcepos=\"40:139-40:159\">2回連続失敗</td>\n</tr>\n<tr data-sourcepos=\"41:1-41:168\">\n<td data-sourcepos=\"41:2-41:53\"><a href=\"https://junior-musicschool.com/experience/form/\" target=\"_blank\" rel=\"noopener noreferrer\">https://junior-musicschool.com/experience/form/</a></td>\n<td data-sourcepos=\"41:55-41:76\">junior-musicschool2</td>\n<td data-sourcepos=\"41:78-41:88\">30min</td>\n<td data-sourcepos=\"41:90-41:113\">ハートビート</td>\n<td data-sourcepos=\"41:115-41:145\">成功30日、失敗30日</td>\n<td data-sourcepos=\"41:147-41:167\">2回連続失敗</td>\n</tr>\n<tr data-sourcepos=\"42:1-42:143\">\n<td data-sourcepos=\"42:2-42:36\"><a href=\"https://www.on-girl.jp/contact/\" target=\"_blank\" rel=\"noopener noreferrer\">https://www.on-girl.jp/contact/</a></td>\n<td data-sourcepos=\"42:38-42:51\">on-girl-jp2</td>\n<td data-sourcepos=\"42:53-42:63\">30min</td>\n<td data-sourcepos=\"42:65-42:88\">ハートビート</td>\n<td data-sourcepos=\"42:90-42:120\">成功30日、失敗30日</td>\n<td data-sourcepos=\"42:122-42:142\">2回連続失敗</td>\n</tr>\n<tr data-sourcepos=\"43:1-43:150\">\n<td data-sourcepos=\"43:2-43:39\"><a href=\"https://otona-club.net/experience/\" target=\"_blank\" rel=\"noopener noreferrer\">https://otona-club.net/experience/</a></td>\n<td data-sourcepos=\"43:41-43:58\">otona-club-net2</td>\n<td data-sourcepos=\"43:60-43:70\">30min</td>\n<td data-sourcepos=\"43:72-43:95\">ハートビート</td>\n<td data-sourcepos=\"43:97-43:127\">成功30日、失敗30日</td>\n<td data-sourcepos=\"43:129-43:149\">2回連続失敗</td>\n</tr>\n<tr data-sourcepos=\"44:1-44:160\">\n<td data-sourcepos=\"44:2-44:45\"><a href=\"https://www.recruit-musicschool.com/form/\" target=\"_blank\" rel=\"noopener noreferrer\">https://www.recruit-musicschool.com/form/</a></td>\n<td data-sourcepos=\"44:47-44:68\">recruit-musicschool2</td>\n<td data-sourcepos=\"44:70-44:80\">30min</td>\n<td data-sourcepos=\"44:82-44:105\">ハートビート</td>\n<td data-sourcepos=\"44:107-44:137\">成功30日、失敗30日</td>\n<td data-sourcepos=\"44:139-44:159\">2回連続失敗</td>\n</tr>\n<tr data-sourcepos=\"45:1-45:216\">\n<td data-sourcepos=\"45:2-45:109\"><a href=\"https://art-lesson.2nd-community.com/api/web_form/view?token=XfysTzD5p5k9NXt//CmySGoEsshzUPTjg1uQipDmJyx=\" target=\"_blank\" rel=\"noopener noreferrer\">https://art-lesson.2nd-community.com/api/web_form/view?token=XfysTzD5p5k9NXt//CmySGoEsshzUPTjg1uQipDmJyx=</a></td>\n<td data-sourcepos=\"45:111-45:124\">api_web_form</td>\n<td data-sourcepos=\"45:126-45:136\">30min</td>\n<td data-sourcepos=\"45:138-45:161\">ハートビート</td>\n<td data-sourcepos=\"45:163-45:193\">成功30日、失敗30日</td>\n<td data-sourcepos=\"45:195-45:215\">2回連続失敗</td>\n</tr>\n</tbody>\n</table>\n<p data-sourcepos=\"47:1-49:121\">※Canary名の指定は、使用文字列、文字数制限があったため省略形の名称で設定<br>\n※Canary名末尾に数字はリビジョンを表す<br>\n※api_web_form のtokenの値 mother.users.id = 1474（EYS音楽教室）のauthentication_tokenカラムの値を指定</p>\n<ul data-sourcepos=\"51:1-54:0\">\n<li data-sourcepos=\"51:1-54:0\">監視設定情報ソース：<br><a href=\"https://docs.google.com/spreadsheets/d/1zCZwIq7koTLpxyzfnscjOQFk6knsbAy6aSLn9N5T5jU/edit#gid=185959370\" target=\"_blank\" rel=\"noopener noreferrer\"><strong>監視対象一覧：申し込みフォーム一覧表</strong></a>　※監視対象 列が「○」のもの （※酒井さん提供資料）</li>\n</ul>\n<h3 data-sourcepos=\"55:1-55:25\" id=\"2-3-2\" name=\"2-3-2\"><a class=\"anchor\" id=\"監視結果のログ\" name=\"監視結果のログ\" href=\"#監視結果のログ\" data-position=\"2-3-2\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"監視結果のログ\"> &gt; 監視結果のログ</span></a>監視結果のログ</h3>\n<p data-sourcepos=\"56:1-58:164\">いずれも監視チェック時のエビデンスをS3に自動保存して、指定期間保管する。<br>\n初期値として「31日（〜1か月）」を指定したが、監視対象毎にカスタム値を指定する事も可能。<br>\n<a href=\"https://img.esa.io/uploads/production/attachments/14521/2022/10/26/128235/0764468a-51cf-4bbb-9cf1-8811e9c194a7.png\" target=\"_blank\" rel=\"noopener noreferrer\"><img width=\"336\" alt=\"image.png (79.4 kB)\" src=\"https://img.esa.io/uploads/production/attachments/14521/2022/10/26/128235/0764468a-51cf-4bbb-9cf1-8811e9c194a7.png\"></a></p>\n<h3 data-sourcepos=\"61:1-61:28\" id=\"2-3-3\" name=\"2-3-3\"><a class=\"anchor\" id=\"アラート通知条件\" name=\"アラート通知条件\" href=\"#アラート通知条件\" data-position=\"2-3-3\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"アラート通知条件\"> &gt; アラート通知条件</span></a>アラート通知条件</h3>\n<p data-sourcepos=\"62:1-63:157\">チェックが２回連続でNGだった場合にエラー通知する。<br>\n従って、チェック間隔が３０分の監視は最大６０分ほど エラー検知からアラート通知まで時間を要することになる。</p>\n<p data-sourcepos=\"65:1-66:164\">設定箇所：Cloudwatch アラーム<br>\n<a href=\"https://img.esa.io/uploads/production/attachments/14521/2022/09/20/128235/5b55404a-33df-43a6-862e-9b49882e3b0c.png\" target=\"_blank\" rel=\"noopener noreferrer\"><img width=\"778\" alt=\"image.png (79.7 kB)\" src=\"https://img.esa.io/uploads/production/attachments/14521/2022/09/20/128235/5b55404a-33df-43a6-862e-9b49882e3b0c.png\"></a></p>\n<h2 data-sourcepos=\"70:1-70:33\" id=\"2-4-0\" name=\"2-4-0\"><a class=\"anchor\" id=\"通報内容とアクション\" name=\"通報内容とアクション\" href=\"#通報内容とアクション\" data-position=\"2-4-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"通報内容とアクション\"> &gt; 通報内容とアクション</span></a>通報内容とアクション</h2>\n<ul data-sourcepos=\"71:1-76:0\">\n<li data-sourcepos=\"71:1-71:71\"><p data-sourcepos=\"71:3-71:71\">通報先はSlackのチャネル「<strong>＃ website_health</strong>」とする</p></li>\n<li data-sourcepos=\"72:1-73:0\"><p data-sourcepos=\"72:3-72:197\">アラート検知時に自動復旧コマンドなどの指定はしていないため、対象のサービスが正常に稼働しているかどうか目視確認を行うこととします。</p></li>\n<li data-sourcepos=\"74:1-76:0\"><p data-sourcepos=\"74:3-75:56\">通知サンプル<br>\n下記のようにSlackにアラートが飛びます。</p></li>\n</ul>\n<a href=\"https://img.esa.io/uploads/production/attachments/14521/2022/10/26/128235/08c11c9a-4a01-4bf0-8702-f7febb00b4eb.png\" target=\"_blank\" rel=\"noopener noreferrer\"><img width=\"251\" alt=\"image.png (3.1 kB)\" src=\"https://img.esa.io/uploads/production/attachments/14521/2022/10/26/128235/08c11c9a-4a01-4bf0-8702-f7febb00b4eb.png\"></a>\n<br>\n<p data-sourcepos=\"80:1-81:165\">本文が無駄に長いですが（AWS Canaryの仕様）、件名のcanary名とDescriptionの下にある記述に着目してください。<br>\n<a href=\"https://img.esa.io/uploads/production/attachments/14521/2022/10/26/128235/d4fbc3ca-6035-42fd-b624-93ebe672bf79.png\" target=\"_blank\" rel=\"noopener noreferrer\"><img width=\"638\" alt=\"image.png (107.5 kB)\" src=\"https://img.esa.io/uploads/production/attachments/14521/2022/10/26/128235/d4fbc3ca-6035-42fd-b624-93ebe672bf79.png\"></a></p>\n<h2 data-sourcepos=\"84:1-84:38\" id=\"2-5-0\" name=\"2-5-0\"><a class=\"anchor\" id=\"Synthetics Canaries の設定手順\" name=\"Synthetics Canaries の設定手順\" href=\"#Synthetics Canaries の設定手順\" data-position=\"2-5-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"Synthetics Canaries の設定手順\"> &gt; Synthetics Canaries の設定手順</span></a>Synthetics Canaries の設定手順</h2>\n<h3 data-sourcepos=\"86:1-86:31\" id=\"2-5-1\" name=\"2-5-1\"><a class=\"anchor\" id=\"サイト監視追加手順\" name=\"サイト監視追加手順\" href=\"#サイト監視追加手順\" data-position=\"2-5-1\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"サイト監視追加手順\"> &gt; サイト監視追加手順</span></a>サイト監視追加手順</h3>\n<h5 data-sourcepos=\"87:1-87:102\">最も簡単な方法は、既存の監視設定をクローンして作成する方法です。</h5>\n<a href=\"https://img.esa.io/uploads/production/attachments/14521/2022/11/04/128235/15466994-6539-4b03-9e52-1659d1453a6e.png\" target=\"_blank\" rel=\"noopener noreferrer\"><img width=\"935\" alt=\"image.png (67.7 kB)\" src=\"https://img.esa.io/uploads/production/attachments/14521/2022/11/04/128235/15466994-6539-4b03-9e52-1659d1453a6e.png\"></a>\n<h5 data-sourcepos=\"91:1-91:33\">1. 名前を任意で入力</h5>\n<p data-sourcepos=\"92:1-93:164\">※文字数制限、使用文字列制限（大文字禁止、記号は一部のみ利用可）があるので注意<br>\n<a href=\"https://img.esa.io/uploads/production/attachments/14521/2022/11/04/128235/f6b910c5-41a0-4907-acf9-1d2590682e98.png\" target=\"_blank\" rel=\"noopener noreferrer\"><img width=\"605\" alt=\"image.png (25.0 kB)\" src=\"https://img.esa.io/uploads/production/attachments/14521/2022/11/04/128235/f6b910c5-41a0-4907-acf9-1d2590682e98.png\"></a></p>\n<h5 data-sourcepos=\"95:1-95:63\">2. 監視対象ページのURLを指定のものに変更</h5>\n<p data-sourcepos=\"96:1-97:164\">Script editor内の記述は基本的にはここの編集だけでOK<br>\n<a href=\"https://img.esa.io/uploads/production/attachments/14521/2022/11/04/128235/97e64b52-389f-493d-91cd-cc57f960b63f.png\" target=\"_blank\" rel=\"noopener noreferrer\"><img width=\"540\" alt=\"image.png (89.7 kB)\" src=\"https://img.esa.io/uploads/production/attachments/14521/2022/11/04/128235/97e64b52-389f-493d-91cd-cc57f960b63f.png\"></a></p>\n<h4 data-sourcepos=\"99:1-99:63\">スケジュールの設定をする場合（1/24追記）</h4>\n<p data-sourcepos=\"101:1-101:173\">詳細監視設定など、監視頻度の低いタスクの実行時間設定には、CRONの記述を使うことができる。下記は2時間おきに実行する場合</p>\n<a href=\"https://img.esa.io/uploads/production/attachments/14521/2023/01/24/128235/6260ae79-e7ef-43de-ab73-f9332e52fed8.png\" target=\"_blank\" rel=\"noopener noreferrer\"><img width=\"790\" alt=\"image.png (151.4 kB)\" src=\"https://img.esa.io/uploads/production/attachments/14521/2023/01/24/128235/6260ae79-e7ef-43de-ab73-f9332e52fed8.png\"></a>\n<h5 data-sourcepos=\"106:1-106:27\">3. アラーム設定</h5>\n<p data-sourcepos=\"107:1-108:164\">以下の通り設定<br>\n<a href=\"https://img.esa.io/uploads/production/attachments/14521/2022/11/04/128235/6ae25c6e-7025-4371-97aa-9fc7187d9312.png\" target=\"_blank\" rel=\"noopener noreferrer\"><img width=\"813\" alt=\"image.png (37.2 kB)\" src=\"https://img.esa.io/uploads/production/attachments/14521/2022/11/04/128235/6ae25c6e-7025-4371-97aa-9fc7187d9312.png\"></a></p>\n<h5 data-sourcepos=\"111:1-111:68\">基本的に上記1,2,3以外の設定の変更は必要ない</h5>\n<p data-sourcepos=\"112:1-113:164\">下記の設定項目も「Create a new role」（デフォルト値）でOK<br>\n<a href=\"https://img.esa.io/uploads/production/attachments/14521/2022/11/04/128235/720e5937-1117-4bb4-b837-a42e7e673534.png\" target=\"_blank\" rel=\"noopener noreferrer\"><img width=\"819\" alt=\"image.png (31.4 kB)\" src=\"https://img.esa.io/uploads/production/attachments/14521/2022/11/04/128235/720e5937-1117-4bb4-b837-a42e7e673534.png\"></a></p>\n<h4 data-sourcepos=\"117:1-117:65\">VPC設定が下記のとおりとなっている事を確認</h4>\n<a href=\"https://img.esa.io/uploads/production/attachments/14521/2022/11/04/128235/dc1321c5-37c3-4bf2-a009-7c1bfff594d4.png\" target=\"_blank\" rel=\"noopener noreferrer\"><img width=\"737\" alt=\"image.png (104.0 kB)\" src=\"https://img.esa.io/uploads/production/attachments/14521/2022/11/04/128235/dc1321c5-37c3-4bf2-a009-7c1bfff594d4.png\"></a>\n<h4 data-sourcepos=\"122:1-122:58\">「Create  canary」を押して設定を保存する</h4>\n<a href=\"https://img.esa.io/uploads/production/attachments/14521/2022/11/04/128235/0ce397ea-4ddd-42ba-b32b-53cf9f751080.png\" target=\"_blank\" rel=\"noopener noreferrer\"><img width=\"283\" alt=\"image.png (4.5 kB)\" src=\"https://img.esa.io/uploads/production/attachments/14521/2022/11/04/128235/0ce397ea-4ddd-42ba-b32b-53cf9f751080.png\"></a>\n<h4 data-sourcepos=\"126:1-126:85\">Canariesの設定画面に追加した監視項目が追加されるのを確認</h4>\n<a href=\"https://img.esa.io/uploads/production/attachments/14521/2022/11/04/128235/70e8fb49-3527-4572-a080-2f2386437000.png\" target=\"_blank\" rel=\"noopener noreferrer\"><img width=\"1162\" alt=\"image.png (139.4 kB)\" src=\"https://img.esa.io/uploads/production/attachments/14521/2022/11/04/128235/70e8fb49-3527-4572-a080-2f2386437000.png\"></a>\n<h3 data-sourcepos=\"130:1-130:34\" id=\"2-5-2\" name=\"2-5-2\"><a class=\"anchor\" id=\"アラート通知設定手順\" name=\"アラート通知設定手順\" href=\"#アラート通知設定手順\" data-position=\"2-5-2\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"アラート通知設定手順\"> &gt; アラート通知設定手順</span></a>アラート通知設定手順</h3>\n<p data-sourcepos=\"131:1-132:164\">対象の監視設定画面で「Configuration」タブ内にあるAlarm name の箇所のリンクを開く<br>\n<a href=\"https://img.esa.io/uploads/production/attachments/14521/2022/11/04/128235/c877c238-b645-4dd1-9a79-dd98d55bab31.png\" target=\"_blank\" rel=\"noopener noreferrer\"><img width=\"837\" alt=\"image.png (69.3 kB)\" src=\"https://img.esa.io/uploads/production/attachments/14521/2022/11/04/128235/c877c238-b645-4dd1-9a79-dd98d55bab31.png\"></a></p>\n<p data-sourcepos=\"134:1-135:164\">Cloudwatchアラームのページに遷移するので「Actions」の「Edit」をクリック<br>\n<a href=\"https://img.esa.io/uploads/production/attachments/14521/2022/11/04/128235/2d50e5db-3807-4800-8559-acf9c6c6d635.png\" target=\"_blank\" rel=\"noopener noreferrer\"><img width=\"226\" alt=\"image.png (12.7 kB)\" src=\"https://img.esa.io/uploads/production/attachments/14521/2022/11/04/128235/2d50e5db-3807-4800-8559-acf9c6c6d635.png\"></a></p>\n<p data-sourcepos=\"137:1-139:16\">以下、変更点のみ記載（記載無き箇所はデフォルト値とする）<br>\n<a href=\"https://img.esa.io/uploads/production/attachments/14521/2022/11/04/128235/29e91dcc-d9dc-4350-81f7-00820a7c7421.png\" target=\"_blank\" rel=\"noopener noreferrer\"><img width=\"759\" alt=\"image.png (29.4 kB)\" src=\"https://img.esa.io/uploads/production/attachments/14521/2022/11/04/128235/29e91dcc-d9dc-4350-81f7-00820a7c7421.png\"></a><br>\n次へ（next）</p>\n<p data-sourcepos=\"141:1-142:164\">Add notification（通知の追加）を押して、次の通り指定<br>\n<a href=\"https://img.esa.io/uploads/production/attachments/14521/2022/11/16/128235/42b39eaa-1423-4316-956d-8c86485be57c.png\" target=\"_blank\" rel=\"noopener noreferrer\"><img width=\"421\" alt=\"image.png (12.4 kB)\" src=\"https://img.esa.io/uploads/production/attachments/14521/2022/11/16/128235/42b39eaa-1423-4316-956d-8c86485be57c.png\"></a></p>\n<a href=\"https://img.esa.io/uploads/production/attachments/14521/2022/11/04/128235/7045fd50-e5bd-41f3-9f48-8b72aabba285.png\" target=\"_blank\" rel=\"noopener noreferrer\"><img width=\"761\" alt=\"image.png (92.2 kB)\" src=\"https://img.esa.io/uploads/production/attachments/14521/2022/11/04/128235/7045fd50-e5bd-41f3-9f48-8b72aabba285.png\"></a>\n次へ（next）\n<p data-sourcepos=\"147:1-152:163\">Slackにアラート通知された場合にわかりやすいように本文をカスタマイズする<br>\n※以下例<br>\n<a href=\"https://img.esa.io/uploads/production/attachments/14521/2022/11/04/128235/886d2c5f-db20-449b-8657-f9aff54f9efe.png\" target=\"_blank\" rel=\"noopener noreferrer\"><img width=\"778\" alt=\"image.png (57.4 kB)\" src=\"https://img.esa.io/uploads/production/attachments/14521/2022/11/04/128235/886d2c5f-db20-449b-8657-f9aff54f9efe.png\"></a><br>\n次へ（next）<br>\n設定内容を確認して問題なければ、「Update Alarm」<br>\n<a href=\"https://img.esa.io/uploads/production/attachments/14521/2022/11/04/128235/da64ce10-5c7a-4a79-b260-77937b9ed683.png\" target=\"_blank\" rel=\"noopener noreferrer\"><img width=\"142\" alt=\"image.png (2.6 kB)\" src=\"https://img.esa.io/uploads/production/attachments/14521/2022/11/04/128235/da64ce10-5c7a-4a79-b260-77937b9ed683.png\"></a></p>\n<h3 data-sourcepos=\"155:1-155:28\" id=\"2-5-3\" name=\"2-5-3\"><a class=\"anchor\" id=\"監視設定削除手順\" name=\"監視設定削除手順\" href=\"#監視設定削除手順\" data-position=\"2-5-3\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"監視設定削除手順\"> &gt; 監視設定削除手順</span></a>監視設定削除手順</h3>\n<p data-sourcepos=\"156:1-156:84\">不要となった監視項目を削除する場合は下記の操作を行います</p>\n<p data-sourcepos=\"158:1-159:165\">ActionからDeleteを選択<br>\n<a href=\"https://img.esa.io/uploads/production/attachments/14521/2022/11/04/128235/e0d8ea30-1122-408a-9529-11f70d016001.png\" target=\"_blank\" rel=\"noopener noreferrer\"><img width=\"1149\" alt=\"image.png (39.8 kB)\" src=\"https://img.esa.io/uploads/production/attachments/14521/2022/11/04/128235/e0d8ea30-1122-408a-9529-11f70d016001.png\"></a></p>\n<p data-sourcepos=\"161:1-162:165\">全てにチェックを入れて「削除」をクリック<br>\n<a href=\"https://img.esa.io/uploads/production/attachments/14521/2022/11/04/128235/6ab55b0a-1637-42e1-8169-e8b212c5ae09.png\" target=\"_blank\" rel=\"noopener noreferrer\"><img width=\"1316\" alt=\"image.png (92.8 kB)\" src=\"https://img.esa.io/uploads/production/attachments/14521/2022/11/04/128235/6ab55b0a-1637-42e1-8169-e8b212c5ae09.png\"></a></p>\n<p data-sourcepos=\"164:1-165:164\">「Delete」を入力して「確認」をクリック<br>\n<a href=\"https://img.esa.io/uploads/production/attachments/14521/2022/11/04/128235/63249313-1ae1-46bb-8d25-5cbf4d642842.png\" target=\"_blank\" rel=\"noopener noreferrer\"><img width=\"615\" alt=\"image.png (25.5 kB)\" src=\"https://img.esa.io/uploads/production/attachments/14521/2022/11/04/128235/63249313-1ae1-46bb-8d25-5cbf4d642842.png\"></a></p>\n<h3 data-sourcepos=\"168:1-168:82\" id=\"2-5-4\" name=\"2-5-4\"><a class=\"anchor\" id=\"複数の監視をひとまとめにする手順（費用削減効果あり）\" name=\"複数の監視をひとまとめにする手順（費用削減効果あり）\" href=\"#複数の監視をひとまとめにする手順（費用削減効果あり）\" data-position=\"2-5-4\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"複数の監視をひとまとめにする手順（費用削減効果あり）\"> &gt; 複数の監視をひとまとめにする手順（費用削減効果あり）</span></a>複数の監視をひとまとめにする手順（費用削減効果あり）</h3>\n<p data-sourcepos=\"169:1-171:165\"><strong>注意点！ 複数監視をまとめる事ができるのは、heartbeat監視のみとなる。</strong><br>\n（HTML要素取得、ID・PW入力を行なう詳細監視では対応不可）<br>\n<a href=\"https://img.esa.io/uploads/production/attachments/14521/2023/01/24/128235/04534b3d-e091-475b-a7f7-8a52d46204c2.png\" target=\"_blank\" rel=\"noopener noreferrer\"><img width=\"792\" alt=\"image.png (264.4 kB)\" src=\"https://img.esa.io/uploads/production/attachments/14521/2023/01/24/128235/04534b3d-e091-475b-a7f7-8a52d46204c2.png\"></a></p>\n<p data-sourcepos=\"173:1-174:165\">複数をまとめた場合のアラート設定は、本文を工夫する必要あり。（以下例）<br>\n<a href=\"https://img.esa.io/uploads/production/attachments/14521/2023/01/24/128235/bb7830ea-5504-400e-8b1d-b727130cadbf.png\" target=\"_blank\" rel=\"noopener noreferrer\"><img width=\"577\" alt=\"image.png (130.3 kB)\" src=\"https://img.esa.io/uploads/production/attachments/14521/2023/01/24/128235/bb7830ea-5504-400e-8b1d-b727130cadbf.png\"></a></p>\n<h3 data-sourcepos=\"178:1-178:48\" id=\"2-5-5\" name=\"2-5-5\"><a class=\"anchor\" id=\"監視グループの設定 （1/24追記）\" name=\"監視グループの設定 （1/24追記）\" href=\"#監視グループの設定 （1/24追記）\" data-position=\"2-5-5\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"監視グループの設定 （1/24追記）\"> &gt; 監視グループの設定 （1/24追記）</span></a>監視グループの設定 （1/24追記）</h3>\n<p data-sourcepos=\"179:1-180:75\">監視項目が増えてくると一覧が多くなり、見通しが悪くなる。<br>\nグループごとにまとめる事により、把握しやすくなる。</p>\n<p data-sourcepos=\"0:0-0:0\">※グループ分け案</p>\n<table data-sourcepos=\"182:1-187:85\">\n<thead>\n<tr data-sourcepos=\"182:1-182:55\">\n<th data-sourcepos=\"182:27-182:43\">グループ名</th>\n<th data-sourcepos=\"182:45-182:53\">用途</th>\n</tr>\n</thead>\n<tbody>\n<tr data-sourcepos=\"185:1-185:87\">\n<td data-sourcepos=\"185:2-185:15\">sysDevGr</td>\n<td data-sourcepos=\"185:17-185:85\">主にシステム開発課で管理のサーバー、サイト</td>\n</tr>\n<tr data-sourcepos=\"186:1-186:80\">\n<td data-sourcepos=\"186:2-186:13\">webDevGr-1</td>\n<td data-sourcepos=\"186:15-186:79\">主にWEB開発課で管理のサーバー、サイトその１</td>\n</tr>\n<tr data-sourcepos=\"187:1-187:85\">\n<td data-sourcepos=\"187:2-187:16\">webDevGr-2</td>\n<td data-sourcepos=\"187:18-187:83\">主にWEB開発課で管理のサーバー、サイトその２</td>\n</tr>\n</tbody>\n</table>\n<hr data-sourcepos=\"191:1-192:0\">\n<h3 data-sourcepos=\"193:1-193:31\" id=\"2-5-6\" name=\"2-5-6\"><a class=\"anchor\" id=\"トラブルシュート編\" name=\"トラブルシュート編\" href=\"#トラブルシュート編\" data-position=\"2-5-6\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"トラブルシュート編\"> &gt; トラブルシュート編</span></a>トラブルシュート編</h3>\n<ul data-sourcepos=\"194:1-196:0\">\n<li data-sourcepos=\"194:1-196:0\">Canary管理画面が表示されない　→　AWSの言語設定を英語に変更すると改善する場合がある</li>\n</ul>\n<hr data-sourcepos=\"197:1-199:0\">\n", "created_at"=>"2022-10-26T11:43:13+09:00", "message"=>"Update post.", "kind"=>"stock", "comments_count"=>0, "tasks_count"=>0, "done_tasks_count"=>0, "url"=>"https://2nd-community.esa.io/posts/622", "updated_at"=>"2023-01-25T00:12:55+09:00", "tags"=>[], "category"=>"システム本部/インフラ", "revision_number"=>50, "created_by"=>{"myself"=>false, "name"=>"石田裕三", "screen_name"=>"yuzo_ishida", "icon"=>"https://img.esa.io/uploads/production/users/128235/icon/thumb_m_666eede25b43a9ff04d9783c9ada7b11.png"}, "updated_by"=>{"myself"=>false, "name"=>"石田裕三", "screen_name"=>"yuzo_ishida", "icon"=>"https://img.esa.io/uploads/production/users/128235/icon/thumb_m_666eede25b43a9ff04d9783c9ada7b11.png"}, "stargazers_count"=>0, "watchers_count"=>1, "star"=>false, "watch"=>false, "sharing_urls"=>nil}, {"number"=>655, "name"=>"週次反省会 1月24日", "full_name"=>"システム本部/チーム/スクラム/週次反省会 1月24日", "wip"=>false, "body_md"=>"## CRONサーバーのキューイング化について\r\nhttps://app.asana.com/0/1196247230098161/1203797942638221/f\r\n\r\n問題点：\r\n１．実行結果が残せない\r\n２．処理が重い、Timeout発生あり\r\n\r\n　ー＞実行結果は、cloudwatch に出力するのが良さそう\r\n\r\n実装：\r\nSidekiq Rails、Rubyのバージョン（３．１．１２）が古くて実装できない。\r\nAWS SQSなどで動作できるか？ ＋ lambda（stepfunction）（要調査）\r\n→ 数カ月後の着手で調整予定（高田さん主担当にアサイン）\r\n\r\n　案：art-lesson 内で処理をやる方法もある\r\n\r\n## テレマ＆サポート＆保守チームMTGのネクストアクション\r\n■ネクストアクション(カッコ内は担当者)\r\n・チケットについて\r\nチケットについて、現在どのような状況で何が起きているのかビジネスサイドに共有する(高田さん)\r\n　データ補正、データ削除の対応を進めている全体で 700件 対象あり、残り300件の状況\r\nチケット関連の不具合が直り次第、チケットの使用履歴を会員側で照会画面を作るべき。(高田さん中心に保守チーム全体で協力)　→ データ修正後の実装を予定\r\n\r\n・長期間放置されている不具合(SC紐付け、チケット等)\r\nいつまでに直すかスケジュールを立てる。(下垣さん、石田さん、高田さん、吉田)\r\n　→ SC紐付けについては、吉田さんのネクストタスクとして設定（Asanaタスクhttps://app.asana.com/0/1196247230098161/1202853149526087/f）\r\n\r\n・1/24の議題（新規）\r\n　SMS（ショートメッセージ）の手動送信について、本文の短縮またはEmailへの代替えが可能であるかを確認\r\n　- SQSQから送っているのか？\r\n　- 本文の文字数制限を検討（現状の制限を下垣さんにて確認）\r\n \r\n## Asanaタスク分担の確認\r\n[リンク](https://docs.google.com/spreadsheets/d/1-zyqTI2UpNLprVOx7TFXbE--xd7ls1X22M8x6G-kzl0/edit#gid=3895998&range=A1)\r\n\r\n## Keep (スプリントでうまくいったので、今後も続けたいことは何か？)\r\n- (下垣)\r\n- (吉田)\r\n- (石田)\r\n- (高田)\r\n\r\n## Problem (スプリントでうまくいかなかったので、今後は中止したいことは何か？)\r\n- (下垣)\r\n- (吉田)\r\n- (石田)\r\n期日せまっているタスクについてアラートを上げるのが遅れて迷惑をかけた[反省]\r\n- (高田)\r\n\r\n## Try ( これからやったほうがよいこと、改善したほうがよいことは何か？)\r\n- (下垣)\r\n- (吉田)\r\n- (石田)\r\n木曜14時〜 進捗確認Meeting（全員参加）\r\n- クラス変更の修正(高田)　\r\n\r\n## その他(何かあれば)\r\nRedashの対応について\r\n", "body_html"=>"<h2 data-sourcepos=\"1:1-1:55\" id=\"0-1-0\" name=\"0-1-0\"><a class=\"anchor\" id=\"CRONサーバーのキューイング化について\" name=\"CRONサーバーのキューイング化について\" href=\"#CRONサーバーのキューイング化について\" data-position=\"0-1-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"CRONサーバーのキューイング化について\"> &gt; CRONサーバーのキューイング化について</span></a>CRONサーバーのキューイング化について</h2>\n<p data-sourcepos=\"2:1-2:59\"><a href=\"https://app.asana.com/0/1196247230098161/1203797942638221/f\" target=\"_blank\" rel=\"noopener noreferrer\">https://app.asana.com/0/1196247230098161/1203797942638221/f</a></p>\n<p data-sourcepos=\"4:1-6:43\">問題点：<br>\n１．実行結果が残せない<br>\n２．処理が重い、Timeout発生あり</p>\n<p data-sourcepos=\"8:1-8:71\">　ー＞実行結果は、cloudwatch に出力するのが良さそう</p>\n<p data-sourcepos=\"10:1-13:82\">実装：<br>\nSidekiq Rails、Rubyのバージョン（３．１．１２）が古くて実装できない。<br>\nAWS SQSなどで動作できるか？ ＋ lambda（stepfunction）（要調査）<br>\n→ 数カ月後の着手で調整予定（高田さん主担当にアサイン）</p>\n<p data-sourcepos=\"15:1-15:56\">　案：art-lesson 内で処理をやる方法もある</p>\n<h2 data-sourcepos=\"17:1-17:78\" id=\"0-2-0\" name=\"0-2-0\"><a class=\"anchor\" id=\"テレマ＆サポート＆保守チームMTGのネクストアクション\" name=\"テレマ＆サポート＆保守チームMTGのネクストアクション\" href=\"#テレマ＆サポート＆保守チームMTGのネクストアクション\" data-position=\"0-2-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"テレマ＆サポート＆保守チームMTGのネクストアクション\"> &gt; テレマ＆サポート＆保守チームMTGのネクストアクション</span></a>テレマ＆サポート＆保守チームMTGのネクストアクション</h2>\n<p data-sourcepos=\"18:1-22:216\">■ネクストアクション(カッコ内は担当者)<br>\n・チケットについて<br>\nチケットについて、現在どのような状況で何が起きているのかビジネスサイドに共有する(高田さん)<br>\n　データ補正、データ削除の対応を進めている全体で 700件 対象あり、残り300件の状況<br>\nチケット関連の不具合が直り次第、チケットの使用履歴を会員側で照会画面を作るべき。(高田さん中心に保守チーム全体で協力)　→ データ修正後の実装を予定</p>\n<p data-sourcepos=\"24:1-26:166\">・長期間放置されている不具合(SC紐付け、チケット等)<br>\nいつまでに直すかスケジュールを立てる。(下垣さん、石田さん、高田さん、吉田)<br>\n　→ SC紐付けについては、吉田さんのネクストタスクとして設定（Asanaタスク<a href=\"https://app.asana.com/0/1196247230098161/1202853149526087/f%EF%BC%89\" target=\"_blank\" rel=\"noopener noreferrer\">https://app.asana.com/0/1196247230098161/1202853149526087/f）</a></p>\n<p data-sourcepos=\"28:1-31:86\">・1/24の議題（新規）<br>\n　SMS（ショートメッセージ）の手動送信について、本文の短縮またはEmailへの代替えが可能であるかを確認<br>\n　- SQSQから送っているのか？<br>\n　- 本文の文字数制限を検討（現状の制限を下垣さんにて確認）</p>\n<h2 data-sourcepos=\"33:1-33:32\" id=\"0-3-0\" name=\"0-3-0\"><a class=\"anchor\" id=\"Asanaタスク分担の確認\" name=\"Asanaタスク分担の確認\" href=\"#Asanaタスク分担の確認\" data-position=\"0-3-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"Asanaタスク分担の確認\"> &gt; Asanaタスク分担の確認</span></a>Asanaタスク分担の確認</h2>\n<p data-sourcepos=\"34:1-34:122\"><a href=\"https://docs.google.com/spreadsheets/d/1-zyqTI2UpNLprVOx7TFXbE--xd7ls1X22M8x6G-kzl0/edit#gid=3895998&amp;range=A1\" target=\"_blank\" rel=\"noopener noreferrer\">リンク</a></p>\n<h2 data-sourcepos=\"36:1-36:94\" id=\"0-4-0\" name=\"0-4-0\"><a class=\"anchor\" id=\"Keep (スプリントでうまくいったので、今後も続けたいことは何か？)\" name=\"Keep (スプリントでうまくいったので、今後も続けたいことは何か？)\" href=\"#Keep (スプリントでうまくいったので、今後も続けたいことは何か？)\" data-position=\"0-4-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"Keep (スプリントでうまくいったので、今後も続けたいことは何か？)\"> &gt; Keep (スプリントでうまくいったので、今後も続けたいことは何か？)</span></a>Keep (スプリントでうまくいったので、今後も続けたいことは何か？)</h2>\n<ul data-sourcepos=\"37:1-41:0\">\n<li data-sourcepos=\"37:1-37:10\">(下垣)</li>\n<li data-sourcepos=\"38:1-38:10\">(吉田)</li>\n<li data-sourcepos=\"39:1-39:10\">(石田)</li>\n<li data-sourcepos=\"40:1-41:0\">(高田)</li>\n</ul>\n<h2 data-sourcepos=\"42:1-42:109\" id=\"0-5-0\" name=\"0-5-0\"><a class=\"anchor\" id=\"Problem (スプリントでうまくいかなかったので、今後は中止したいことは何か？)\" name=\"Problem (スプリントでうまくいかなかったので、今後は中止したいことは何か？)\" href=\"#Problem (スプリントでうまくいかなかったので、今後は中止したいことは何か？)\" data-position=\"0-5-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"Problem (スプリントでうまくいかなかったので、今後は中止したいことは何か？)\"> &gt; Problem (スプリントでうまくいかなかったので、今後は中止したいことは何か？)</span></a>Problem (スプリントでうまくいかなかったので、今後は中止したいことは何か？)</h2>\n<ul data-sourcepos=\"43:1-48:0\">\n<li data-sourcepos=\"43:1-43:10\">(下垣)</li>\n<li data-sourcepos=\"44:1-44:10\">(吉田)</li>\n<li data-sourcepos=\"45:1-46:110\">(石田)<br>\n期日せまっているタスクについてアラートを上げるのが遅れて迷惑をかけた[反省]</li>\n<li data-sourcepos=\"47:1-48:0\">(高田)</li>\n</ul>\n<h2 data-sourcepos=\"49:1-49:100\" id=\"0-6-0\" name=\"0-6-0\"><a class=\"anchor\" id=\"Try ( これからやったほうがよいこと、改善したほうがよいことは何か？)\" name=\"Try ( これからやったほうがよいこと、改善したほうがよいことは何か？)\" href=\"#Try ( これからやったほうがよいこと、改善したほうがよいことは何か？)\" data-position=\"0-6-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"Try ( これからやったほうがよいこと、改善したほうがよいことは何か？)\"> &gt; Try ( これからやったほうがよいこと、改善したほうがよいことは何か？)</span></a>Try ( これからやったほうがよいこと、改善したほうがよいことは何か？)</h2>\n<ul data-sourcepos=\"50:1-55:0\">\n<li data-sourcepos=\"50:1-50:10\">(下垣)</li>\n<li data-sourcepos=\"51:1-51:10\">(吉田)</li>\n<li data-sourcepos=\"52:1-53:52\">(石田)<br>\n木曜14時〜 進捗確認Meeting（全員参加）</li>\n<li data-sourcepos=\"54:1-55:0\">クラス変更の修正(高田)　</li>\n</ul>\n<h2 data-sourcepos=\"56:1-56:29\" id=\"0-7-0\" name=\"0-7-0\"><a class=\"anchor\" id=\"その他(何かあれば)\" name=\"その他(何かあれば)\" href=\"#その他(何かあれば)\" data-position=\"0-7-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"その他(何かあれば)\"> &gt; その他(何かあれば)</span></a>その他(何かあれば)</h2>\n<p data-sourcepos=\"57:1-57:27\">Redashの対応について</p>\n", "created_at"=>"2023-01-24T12:09:00+09:00", "message"=>"Update post.", "kind"=>"stock", "comments_count"=>0, "tasks_count"=>0, "done_tasks_count"=>0, "url"=>"https://2nd-community.esa.io/posts/655", "updated_at"=>"2023-01-24T17:41:58+09:00", "tags"=>[], "category"=>"システム本部/チーム/スクラム", "revision_number"=>29, "created_by"=>{"myself"=>true, "name"=>"吉田直人", "screen_name"=>"naoto_yoshida", "icon"=>"https://img.esa.io/uploads/production/users/105730/icon/thumb_m_7ed6de39594feb35d005206783298fdb.png"}, "updated_by"=>{"myself"=>false, "name"=>"石田裕三", "screen_name"=>"yuzo_ishida", "icon"=>"https://img.esa.io/uploads/production/users/128235/icon/thumb_m_666eede25b43a9ff04d9783c9ada7b11.png"}, "stargazers_count"=>0, "watchers_count"=>3, "star"=>false, "watch"=>true, "sharing_urls"=>nil}, {"number"=>637, "name"=>"未納者への一括メール送信", "full_name"=>"システム本部/運用保守/未納者への一括メール送信", "wip"=>false, "body_md"=>"# ２種類ある\r\n- 入金期限リマインド（毎月20日ころ）\r\n- コンビニ払込未納（毎月27日ころ）\r\n\r\n# 背景\r\n- ビジネスサイドで行える様に機能実装したものの、本番環境ではタイムアウトしてしまう\r\n- エンジニアがローカル環境で本番DBに繋いで行うことになった\r\n\r\n# ローカルのMother環境を変更する\r\n### ソースコードの一部変更をしてスタッシュしておくとよい\r\n- mother > config > environments > development.rb:45\r\n    ```diff\r\n    - Bullet.enable = false\r\n    + Bullet.enable = true\r\n    ```\r\n- mother > config > unicorn.rb:6\r\n    ```diff\r\n    - timeout ENV['UNICORN_TIME_OUT'].to_i > 0 ? ENV['UNICORN_TIME_OUT'].to_i : 300\r\n    + timeout ENV['UNICORN_TIME_OUT'].to_i > 0 ? ENV['UNICORN_TIME_OUT'].to_i : 18000\r\n    ```\r\n- mother > config > unicorn.rb:9\r\n    ```diff\r\n    - timeout ENV['UNICORN_TIME_OUT'].to_i > 0 ? ENV['UNICORN_TIME_OUT'].to_i : 120\r\n    + timeout ENV['UNICORN_TIME_OUT'].to_i > 0 ? ENV['UNICORN_TIME_OUT'].to_i : 18000\r\n    ```\r\n- mother > .env:1\r\n    ```diff\r\n    - RAILS_ENV=development\r\n    + RAILS_ENV=production\r\n    ```\r\n    \r\n# フロー\r\n1. Mother＞請求入金管理 ＞ 未納管理（/accounting/unpaid/tickets）ページから行う\r\n2. 上部の「ルーチン検索」の中に「メール一括送信」があり「入金期限リマインド」か「コンビニ払込未納」リンクをクリックすると、それに適した検索条件が設定され、検索結果も下部に現れる\r\n3. 検索結果の１件ごとにチェックボックスがあるので、メールを送信したい会員様のチェックをいれるのだが、「すべてチェックする」リンクを押すと早い\r\n\r\n<img width=\"962\" alt=\"image.png (62.6 kB)\" src=\"https://img.esa.io/uploads/production/attachments/14521/2022/11/25/128235/9f823346-eab2-43c0-8c64-1650278f4870.png\">\r\n\r\n\r\n4. 経理担当からメール送信除外リストが送られてくるので、それをもとにチェックを外していく（除外していく）\r\n5. 検索結果のすぐ上に「一括メール送信」があり、「入金期限リマインド」か「コンビニ払込未納」をクリックしてメール送信確認ポップアップを出す\r\n<img width=\"564\" alt=\"image.png (8.0 kB)\" src=\"https://img.esa.io/uploads/production/attachments/14521/2022/11/25/128235/ece6ccf6-c59f-4d7a-bf82-6806b0e7e41e.png\">\r\n\r\n6. 本文を書き換える場合はそうしてから「送信する」ボタンを押す\r\n※コツ：DB接続が切れてしまうのを防ぐ意味で、送信ボタン を押す前に何か別のページで検索処理などを行ってDB接続を直前にやっておくのが安全。\r\n\r\n<img width=\"969\" alt=\"image.png (823.8 kB)\" src=\"https://img.esa.io/uploads/production/attachments/14521/2022/11/25/128235/104c97de-e640-4a5d-9197-e46171bc4009.png\">\r\n\r\n\r\n7. 1件4秒ほどかかるので、気長に待つ\r\n<br>\r\n\r\n# メール一括送信完了後\r\n1. 完了画面に飛び、送信数や詳細リストのCSVダウンロードが行えるが、リロードやタブを閉じてしまうと、もう戻れないので気をつける様に\r\n2. ローカルだとDBとの接続問題でエラーページになったりもするので、気をつけること\r\n3. 送信成功リストと、メールアドレスなしで未送信リストの２つのCSVがダウンロードできるので、２つともダウンロードする\r\n<br>\r\n\r\n> 11/21実施時はエラー画面となりダウンロードのページが表示されなかったので、「データリストTSVファイルダウンロード」ボタンからファイルダウンロードして代用した。\r\n<img width=\"1072\" alt=\"image.png (94.4 kB)\" src=\"https://img.esa.io/uploads/production/attachments/14521/2022/11/25/128235/682c308a-20b1-4a9f-b035-ab75aec8061b.png\">\r\n\r\n\r\nStashを戻しておく\r\n\r\n\r\n# ビジネスサイド（経理担当）へ完了報告をする\r\n1.　２つのCSVリストを添付してASANAで報告する\r\n2.　メールアドレス無しで未送信の方リストは特に大事なので、必ず添付するように\r\n\r\n※報告例\r\n<img width=\"540\" alt=\"image.png (44.2 kB)\" src=\"https://img.esa.io/uploads/production/attachments/14521/2022/11/28/128235/0464aa48-5a64-45ef-a505-4ab09bbdb984.png\">\r\n\r\n＜追加が必要な対応＞\r\nメールアドレスが不正で送れなかったものも発生するので、送信できなかったリストに加える（送信失敗のリストはファイルではなく、メール本文での報告のみとする。）\r\n<img width=\"831\" alt=\"image.png (31.3 kB)\" src=\"https://img.esa.io/uploads/production/attachments/14521/2023/01/23/128235/b0fb6f64-e5a3-4cc1-a026-3c1ba1bc528a.png\">\r\n\r\n\r\n[no_payment_collection_transfer_no_address_20230123_171856.csv (206 B)](https://esa-storage-tokyo.s3-ap-northeast-1.amazonaws.com/uploads/production/attachments/14521/2023/01/23/128235/85efa43f-f850-4c59-9379-475a8c33c1d1.csv)\r\n\r\n\r\n\r\n---\r\n## トラブルシュート編\r\nメールが送信されたかどうかは、下記テーブルを参照 \r\nmember_simplified_contacts\r\n\r\nタイムアウト回避方法のひとつとして、CRONサーバーにて実施する方法がある。（2022/12/22実績あり）\r\n\r\n\r\n関連タスク\r\nhttps://app.asana.com/0/1196247230098161/1203268544052532/f", "body_html"=>"<h1 data-sourcepos=\"1:1-1:17\" id=\"1-0-0\" name=\"1-0-0\"><a class=\"anchor\" id=\"２種類ある\" name=\"２種類ある\" href=\"#２種類ある\" data-position=\"1-0-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"２種類ある\"> &gt; ２種類ある</span></a>２種類ある</h1>\n<ul data-sourcepos=\"2:1-4:0\">\n<li data-sourcepos=\"2:1-2:52\">入金期限リマインド（毎月20日ころ）</li>\n<li data-sourcepos=\"3:1-4:0\">コンビニ払込未納（毎月27日ころ）</li>\n</ul>\n<h1 data-sourcepos=\"5:1-5:8\" id=\"2-0-0\" name=\"2-0-0\"><a class=\"anchor\" id=\"背景\" name=\"背景\" href=\"#背景\" data-position=\"2-0-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"背景\"> &gt; 背景</span></a>背景</h1>\n<ul data-sourcepos=\"6:1-8:0\">\n<li data-sourcepos=\"6:1-6:122\">ビジネスサイドで行える様に機能実装したものの、本番環境ではタイムアウトしてしまう</li>\n<li data-sourcepos=\"7:1-8:0\">エンジニアがローカル環境で本番DBに繋いで行うことになった</li>\n</ul>\n<h1 data-sourcepos=\"9:1-9:44\" id=\"3-0-0\" name=\"3-0-0\"><a class=\"anchor\" id=\"ローカルのMother環境を変更する\" name=\"ローカルのMother環境を変更する\" href=\"#ローカルのMother環境を変更する\" data-position=\"3-0-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"ローカルのMother環境を変更する\"> &gt; ローカルのMother環境を変更する</span></a>ローカルのMother環境を変更する</h1>\n<h3 data-sourcepos=\"10:1-10:82\" id=\"3-0-1\" name=\"3-0-1\"><a class=\"anchor\" id=\"ソースコードの一部変更をしてスタッシュしておくとよい\" name=\"ソースコードの一部変更をしてスタッシュしておくとよい\" href=\"#ソースコードの一部変更をしてスタッシュしておくとよい\" data-position=\"3-0-1\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"ソースコードの一部変更をしてスタッシュしておくとよい\"> &gt; ソースコードの一部変更をしてスタッシュしておくとよい</span></a>ソースコードの一部変更をしてスタッシュしておくとよい</h3>\n<ul data-sourcepos=\"11:1-31:4\">\n<li data-sourcepos=\"11:1-15:7\">mother &gt; config &gt; environments &gt; development.rb:45\n<div class=\"code-block\" data-sourcepos=\"12:5-15:7\"><div class=\"code-filename\"><i class=\"fa fa-file-code-o\"></i>diff</div><div class=\"highlight\"><pre class=\"highlight diff\"><code><span class=\"gd\">- Bullet.enable = false\n</span><span class=\"gi\">+ Bullet.enable = true\n</span></code></pre></div></div></li>\n<li data-sourcepos=\"16:1-20:7\">mother &gt; config &gt; unicorn.rb:6\n<div class=\"code-block\" data-sourcepos=\"17:5-20:7\"><div class=\"code-filename\"><i class=\"fa fa-file-code-o\"></i>diff</div><div class=\"highlight\"><pre class=\"highlight diff\"><code><span class=\"gd\">- timeout ENV['UNICORN_TIME_OUT'].to_i &gt; 0 ? ENV['UNICORN_TIME_OUT'].to_i : 300\n</span><span class=\"gi\">+ timeout ENV['UNICORN_TIME_OUT'].to_i &gt; 0 ? ENV['UNICORN_TIME_OUT'].to_i : 18000\n</span></code></pre></div></div></li>\n<li data-sourcepos=\"21:1-25:7\">mother &gt; config &gt; unicorn.rb:9\n<div class=\"code-block\" data-sourcepos=\"22:5-25:7\"><div class=\"code-filename\"><i class=\"fa fa-file-code-o\"></i>diff</div><div class=\"highlight\"><pre class=\"highlight diff\"><code><span class=\"gd\">- timeout ENV['UNICORN_TIME_OUT'].to_i &gt; 0 ? ENV['UNICORN_TIME_OUT'].to_i : 120\n</span><span class=\"gi\">+ timeout ENV['UNICORN_TIME_OUT'].to_i &gt; 0 ? ENV['UNICORN_TIME_OUT'].to_i : 18000\n</span></code></pre></div></div></li>\n<li data-sourcepos=\"26:1-31:4\">mother &gt; .env:1\n<div class=\"code-block\" data-sourcepos=\"27:5-30:7\"><div class=\"code-filename\"><i class=\"fa fa-file-code-o\"></i>diff</div><div class=\"highlight\"><pre class=\"highlight diff\"><code><span class=\"gd\">- RAILS_ENV=development\n</span><span class=\"gi\">+ RAILS_ENV=production\n</span></code></pre></div></div></li>\n</ul>\n<h1 data-sourcepos=\"32:1-32:11\" id=\"4-0-0\" name=\"4-0-0\"><a class=\"anchor\" id=\"フロー\" name=\"フロー\" href=\"#フロー\" data-position=\"4-0-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"フロー\"> &gt; フロー</span></a>フロー</h1>\n<ol data-sourcepos=\"33:1-36:0\">\n<li data-sourcepos=\"33:1-33:100\">Mother＞請求入金管理 ＞ 未納管理（/accounting/unpaid/tickets）ページから行う</li>\n<li data-sourcepos=\"34:1-34:264\">上部の「ルーチン検索」の中に「メール一括送信」があり「入金期限リマインド」か「コンビニ払込未納」リンクをクリックすると、それに適した検索条件が設定され、検索結果も下部に現れる</li>\n<li data-sourcepos=\"35:1-36:0\">検索結果の１件ごとにチェックボックスがあるので、メールを送信したい会員様のチェックをいれるのだが、「すべてチェックする」リンクを押すと早い</li>\n</ol>\n<a href=\"https://img.esa.io/uploads/production/attachments/14521/2022/11/25/128235/9f823346-eab2-43c0-8c64-1650278f4870.png\" target=\"_blank\" rel=\"noopener noreferrer\"><img width=\"962\" alt=\"image.png (62.6 kB)\" src=\"https://img.esa.io/uploads/production/attachments/14521/2022/11/25/128235/9f823346-eab2-43c0-8c64-1650278f4870.png\"></a>\n<ol start=\"4\" data-sourcepos=\"40:1-41:204\">\n<li data-sourcepos=\"40:1-40:153\">経理担当からメール送信除外リストが送られてくるので、それをもとにチェックを外していく（除外していく）</li>\n<li data-sourcepos=\"41:1-41:204\">検索結果のすぐ上に「一括メール送信」があり、「入金期限リマインド」か「コンビニ払込未納」をクリックしてメール送信確認ポップアップを出す</li>\n</ol>\n<a href=\"https://img.esa.io/uploads/production/attachments/14521/2022/11/25/128235/ece6ccf6-c59f-4d7a-bf82-6806b0e7e41e.png\" target=\"_blank\" rel=\"noopener noreferrer\"><img width=\"564\" alt=\"image.png (8.0 kB)\" src=\"https://img.esa.io/uploads/production/attachments/14521/2022/11/25/128235/ece6ccf6-c59f-4d7a-bf82-6806b0e7e41e.png\"></a>\n<ol start=\"6\" data-sourcepos=\"44:1-46:0\">\n<li data-sourcepos=\"44:1-46:0\">本文を書き換える場合はそうしてから「送信する」ボタンを押す<br>\n※コツ：DB接続が切れてしまうのを防ぐ意味で、送信ボタン を押す前に何か別のページで検索処理などを行ってDB接続を直前にやっておくのが安全。</li>\n</ol>\n<a href=\"https://img.esa.io/uploads/production/attachments/14521/2022/11/25/128235/104c97de-e640-4a5d-9197-e46171bc4009.png\" target=\"_blank\" rel=\"noopener noreferrer\"><img width=\"969\" alt=\"image.png (823.8 kB)\" src=\"https://img.esa.io/uploads/production/attachments/14521/2022/11/25/128235/104c97de-e640-4a5d-9197-e46171bc4009.png\"></a>\n<ol start=\"7\" data-sourcepos=\"50:1-50:50\">\n<li data-sourcepos=\"50:1-50:50\">1件4秒ほどかかるので、気長に待つ</li>\n</ol>\n<br>\n<h1 data-sourcepos=\"53:1-53:32\" id=\"5-0-0\" name=\"5-0-0\"><a class=\"anchor\" id=\"メール一括送信完了後\" name=\"メール一括送信完了後\" href=\"#メール一括送信完了後\" data-position=\"5-0-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"メール一括送信完了後\"> &gt; メール一括送信完了後</span></a>メール一括送信完了後</h1>\n<ol data-sourcepos=\"54:1-56:168\">\n<li data-sourcepos=\"54:1-54:189\">完了画面に飛び、送信数や詳細リストのCSVダウンロードが行えるが、リロードやタブを閉じてしまうと、もう戻れないので気をつける様に</li>\n<li data-sourcepos=\"55:1-55:116\">ローカルだとDBとの接続問題でエラーページになったりもするので、気をつけること</li>\n<li data-sourcepos=\"56:1-56:168\">送信成功リストと、メールアドレスなしで未送信リストの２つのCSVがダウンロードできるので、２つともダウンロードする</li>\n</ol>\n<br>\n<blockquote data-sourcepos=\"59:1-59:232\">\n<p data-sourcepos=\"59:3-59:232\">11/21実施時はエラー画面となりダウンロードのページが表示されなかったので、「データリストTSVファイルダウンロード」ボタンからファイルダウンロードして代用した。</p>\n</blockquote>\n<a href=\"https://img.esa.io/uploads/production/attachments/14521/2022/11/25/128235/682c308a-20b1-4a9f-b035-ab75aec8061b.png\" target=\"_blank\" rel=\"noopener noreferrer\"><img width=\"1072\" alt=\"image.png (94.4 kB)\" src=\"https://img.esa.io/uploads/production/attachments/14521/2022/11/25/128235/682c308a-20b1-4a9f-b035-ab75aec8061b.png\"></a>\n<p data-sourcepos=\"63:1-63:23\">Stashを戻しておく</p>\n<h1 data-sourcepos=\"66:1-66:65\" id=\"6-0-0\" name=\"6-0-0\"><a class=\"anchor\" id=\"ビジネスサイド（経理担当）へ完了報告をする\" name=\"ビジネスサイド（経理担当）へ完了報告をする\" href=\"#ビジネスサイド（経理担当）へ完了報告をする\" data-position=\"6-0-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"ビジネスサイド（経理担当）へ完了報告をする\"> &gt; ビジネスサイド（経理担当）へ完了報告をする</span></a>ビジネスサイド（経理担当）へ完了報告をする</h1>\n<p data-sourcepos=\"67:1-68:113\">1.　２つのCSVリストを添付してASANAで報告する<br>\n2.　メールアドレス無しで未送信の方リストは特に大事なので、必ず添付するように</p>\n<p data-sourcepos=\"70:1-71:164\">※報告例<br>\n<a href=\"https://img.esa.io/uploads/production/attachments/14521/2022/11/28/128235/0464aa48-5a64-45ef-a505-4ab09bbdb984.png\" target=\"_blank\" rel=\"noopener noreferrer\"><img width=\"540\" alt=\"image.png (44.2 kB)\" src=\"https://img.esa.io/uploads/production/attachments/14521/2022/11/28/128235/0464aa48-5a64-45ef-a505-4ab09bbdb984.png\"></a></p>\n<p data-sourcepos=\"73:1-75:164\">＜追加が必要な対応＞<br>\nメールアドレスが不正で送れなかったものも発生するので、送信できなかったリストに加える（送信失敗のリストはファイルではなく、メール本文での報告のみとする。）<br>\n<a href=\"https://img.esa.io/uploads/production/attachments/14521/2023/01/23/128235/b0fb6f64-e5a3-4cc1-a026-3c1ba1bc528a.png\" target=\"_blank\" rel=\"noopener noreferrer\"><img width=\"831\" alt=\"image.png (31.3 kB)\" src=\"https://img.esa.io/uploads/production/attachments/14521/2023/01/23/128235/b0fb6f64-e5a3-4cc1-a026-3c1ba1bc528a.png\"></a></p>\n<p data-sourcepos=\"78:1-78:226\"><a href=\"https://esa-storage-tokyo.s3-ap-northeast-1.amazonaws.com/uploads/production/attachments/14521/2023/01/23/128235/85efa43f-f850-4c59-9379-475a8c33c1d1.csv\" target=\"_blank\" rel=\"noopener noreferrer\">no_payment_collection_transfer_no_address_20230123_171856.csv (206 B)</a></p>\n<hr data-sourcepos=\"82:1-82:3\">\n<h2 data-sourcepos=\"83:1-83:30\" id=\"6-1-0\" name=\"6-1-0\"><a class=\"anchor\" id=\"トラブルシュート編\" name=\"トラブルシュート編\" href=\"#トラブルシュート編\" data-position=\"6-1-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"トラブルシュート編\"> &gt; トラブルシュート編</span></a>トラブルシュート編</h2>\n<p data-sourcepos=\"84:1-85:26\">メールが送信されたかどうかは、下記テーブルを参照<br>\nmember_simplified_contacts</p>\n<p data-sourcepos=\"87:1-87:134\">タイムアウト回避方法のひとつとして、CRONサーバーにて実施する方法がある。（2022/12/22実績あり）</p>\n<p data-sourcepos=\"90:1-91:59\">関連タスク<br>\n<a href=\"https://app.asana.com/0/1196247230098161/1203268544052532/f\" target=\"_blank\" rel=\"noopener noreferrer\">https://app.asana.com/0/1196247230098161/1203268544052532/f</a></p>\n", "created_at"=>"2022-11-21T13:44:31+09:00", "message"=>"Update post.", "kind"=>"stock", "comments_count"=>0, "tasks_count"=>0, "done_tasks_count"=>0, "url"=>"https://2nd-community.esa.io/posts/637", "updated_at"=>"2023-01-23T17:43:16+09:00", "tags"=>[], "category"=>"システム本部/運用保守", "revision_number"=>15, "created_by"=>{"myself"=>false, "name"=>"喜屋武元貴", "screen_name"=>"motoki_kyan", "icon"=>"https://img.esa.io/uploads/production/members/117771/icon/thumb_m_1cdc3300acef64d1a845056a5d941ea7.jpg"}, "updated_by"=>{"myself"=>false, "name"=>"石田裕三", "screen_name"=>"yuzo_ishida", "icon"=>"https://img.esa.io/uploads/production/users/128235/icon/thumb_m_666eede25b43a9ff04d9783c9ada7b11.png"}, "stargazers_count"=>0, "watchers_count"=>2, "star"=>false, "watch"=>false, "sharing_urls"=>nil}, {"number"=>126, "name"=>"振替依頼処理_SMBC", "full_name"=>"システム本部/定例業務/会費請求/振替依頼処理_SMBC", "wip"=>false, "body_md"=>"# 振替依頼処理_SMBC\r\n\r\nSMBCへの振替依頼作業を実施します。\r\n\r\n## 手順\r\n\r\n### 1. 対象ファイルの準備\r\n\r\nGoogleドライブに格納されている請求依頼のデータをダウンロードしてください。\r\n\r\n[GoogleDrive](https://drive.google.com/drive/u/0/folders/1K51RAIVKLFk3LIm-Ssazp8Tx-FxYgGwg)\r\n\r\nYYYYMMDD(請求日)/振替依頼/yyyymmdd_hhmmss_smbc.csv\r\n\r\n### 2. 集金代行サービスWEBサイトへログイン\r\n\r\n[集金代行サービスWEBログイン手順_SMBC](https://2nd-community.esa.io/posts/120)の手順に従ってログインしてください。\r\n\r\n### 3. MainMenu\r\n\r\n「CATS Manager」を押下してください。\r\n\r\n### 4. 委託者選択\r\n\r\n委託者コード、振替日のプルダウンメニューを\r\n「xxxxxxx | 株式会社EYS-STYLE | 振替日27日 | 振替結果反映済」\r\nに設定し「OK」ボタンを押下してください。\r\n\r\n### 5. CATS Manager MENU\r\n\r\n「Step4 最終処理」を押下してください。\r\n\r\n### 6. 前回振替請求の最終処理\r\n\r\n振替日が前回依頼分であることを確認したら「実行」ボタンを押下してください。\r\n処理が完了したら画面が切り替わり「【最終処理確認】今回請求分の最終処理が終了しました。」と表示されます。\r\n\r\n「メニューへ」ボタンを押下してください。\r\n\r\n### 7. 再びCATS Manager MENU\r\n\r\n「請求予定データ取込」を押下してください。\r\n\r\n### 8. 請求予定テキストファイル取込\r\n\r\nフォーム入力の内容を更新します。\r\n\r\n取込データフォーマット: CSVが選択されていることを確認\r\n取り込み元: 「ファイルを選択」をクリックしYYYYMMDD_HHMMSS_smbc.csvを選択する\r\n\r\n更新したら「取込」ボタンを押下してください。\r\n\r\n「テキストファイルの取込を開始します。」のダイアログが表示されるので、そのままOKを押下してください。\r\n\r\n処理が完了すると「請求予定テキストファイル取込結果」に画面が切り替わります。\r\n\r\n### 9. エラーチェック\r\n\r\n請求予定テキストファイル取込結果の「エラー件数欄」が\r\n\r\nエラー件数が0でない場合は請求依頼リストを修正する必要があります。\r\n\r\n「請求予定テキストファイル取込エラーリスト.PDF」をクリックしエラーの内容を確認し個別で対応してください。\r\n\r\n※顧客番号「100000000131」、「200000003372」に関するエラーはリストから削除して構いません。\r\n\r\n※全件エラーになった場合は以下のパターンが考えられます。\r\n・パターン1　CSVファイルの文字コードが変わっている\r\n→CSVファイルをEXCELで開いた後に保存したりしていないでしょうか。その場合、ファイルの内部データが破損している可能性があります。再度motherからCSVファイルをダウンロードしましょう。\r\n\r\n・パターン2　システムの対応時間外\r\nSMBCのシステムの対応時間は7〜19時です。(2023年1月17日時点)\r\n19時以降は諦めて翌日に再アップロードしましょう。\r\n\r\nエラーを解決したら再度、手順10から「請求予定データ取込」を行なってください。\r\n\r\n### 10. 請求予定テキストファイル取込結果の成功\r\n\r\nエラー件数が0件であれば取込完了です。\r\n「メニューへ」ボタンを押下してください。\r\n\r\n### 11. CATS Manager MENU\r\n\r\n「Step1 振替請求データ抽出」を押下してください。\r\n\r\n### 12. 振替請求データ抽出\r\n\r\n振替日の日付に問題がなければ「抽出」をクリックしてください。\r\n「振替請求データの抽出を開始します。よろしいですか？」とダイアログが表示されたら、そのまま「OK」を押下してください。\r\n\r\n画面が切り替わり「振替請求データ抽出結果」が表示されます。\r\n\r\n### 13. 振替請求データ締め\r\n\r\n「振替請求データ抽出結果」のページ下部にある「振替請求データ締め処理へ」ボタンを押下してください。\r\n\r\n### 14. 振替請求データ締め処理\r\n\r\n表示内容を確認し問題がなければ\r\n***振替データ明細表\u001C（PDF）の「作成する」にチェックをつけて「締め処理実行」ボタンを押下してください。***\r\n「振替請求データの締め処理を開始します。よろしいですか？」とダイアログが表示されたら、そのまま「OK」を押下してください。\r\n\r\n画面が切り替わり「振替請求データ締め処理結果」が表示されます。\r\n\r\n### 15. 振替データ明細表.PDFをダウンロードして格納\r\n\r\n画面下部にある「振替データ明細表.PDF」のリンクをダウンロードし、ファイル名をSMBC明細.pdfとしてGoogleドライブに保存してください。\r\n\r\n[GoogleDrive](https://drive.google.com/drive/u/0/folders/1EryI1D41yX13DjAguPHh4WVasq5-fRu8)\r\nYYYYMMDD(請求日)/YYYYMMDD_SMBC明細.pdf\r\n", "body_html"=>"<h1 data-sourcepos=\"1:1-1:25\" id=\"1-0-0\" name=\"1-0-0\"><a class=\"anchor\" id=\"振替依頼処理_SMBC\" name=\"振替依頼処理_SMBC\" href=\"#振替依頼処理_SMBC\" data-position=\"1-0-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"振替依頼処理_SMBC\"> &gt; 振替依頼処理_SMBC</span></a>振替依頼処理_SMBC</h1>\n<p data-sourcepos=\"3:1-3:49\">SMBCへの振替依頼作業を実施します。</p>\n<h2 data-sourcepos=\"5:1-5:9\" id=\"1-1-0\" name=\"1-1-0\"><a class=\"anchor\" id=\"手順\" name=\"手順\" href=\"#手順\" data-position=\"1-1-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"手順\"> &gt; 手順</span></a>手順</h2>\n<h3 data-sourcepos=\"7:1-7:34\" id=\"1-1-1\" name=\"1-1-1\"><a class=\"anchor\" id=\"1. 対象ファイルの準備\" name=\"1. 対象ファイルの準備\" href=\"#1. 対象ファイルの準備\" data-position=\"1-1-1\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"1. 対象ファイルの準備\"> &gt; 1. 対象ファイルの準備</span></a>1. 対象ファイルの準備</h3>\n<p data-sourcepos=\"9:1-9:108\">Googleドライブに格納されている請求依頼のデータをダウンロードしてください。</p>\n<p data-sourcepos=\"11:1-11:91\"><a href=\"https://drive.google.com/drive/u/0/folders/1K51RAIVKLFk3LIm-Ssazp8Tx-FxYgGwg\" target=\"_blank\" rel=\"noopener noreferrer\">GoogleDrive</a></p>\n<p data-sourcepos=\"13:1-13:57\">YYYYMMDD(請求日)/振替依頼/yyyymmdd_hhmmss_smbc.csv</p>\n<h3 data-sourcepos=\"15:1-15:58\" id=\"1-1-2\" name=\"1-1-2\"><a class=\"anchor\" id=\"2. 集金代行サービスWEBサイトへログイン\" name=\"2. 集金代行サービスWEBサイトへログイン\" href=\"#2. 集金代行サービスWEBサイトへログイン\" data-position=\"1-1-2\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"2. 集金代行サービスWEBサイトへログイン\"> &gt; 2. 集金代行サービスWEBサイトへログイン</span></a>2. 集金代行サービスWEBサイトへログイン</h3>\n<p data-sourcepos=\"17:1-17:146\"><a href=\"https://2nd-community.esa.io/posts/120\">集金代行サービスWEBログイン手順_SMBC</a>の手順に従ってログインしてください。</p>\n<h3 data-sourcepos=\"19:1-19:15\" id=\"1-1-3\" name=\"1-1-3\"><a class=\"anchor\" id=\"3. MainMenu\" name=\"3. MainMenu\" href=\"#3. MainMenu\" data-position=\"1-1-3\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"3. MainMenu\"> &gt; 3. MainMenu</span></a>3. MainMenu</h3>\n<p data-sourcepos=\"21:1-21:48\">「CATS Manager」を押下してください。</p>\n<h3 data-sourcepos=\"23:1-23:22\" id=\"1-1-4\" name=\"1-1-4\"><a class=\"anchor\" id=\"4. 委託者選択\" name=\"4. 委託者選択\" href=\"#4. 委託者選択\" data-position=\"1-1-4\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"4. 委託者選択\"> &gt; 4. 委託者選択</span></a>4. 委託者選択</h3>\n<p data-sourcepos=\"25:1-27:59\">委託者コード、振替日のプルダウンメニューを<br>\n「xxxxxxx | 株式会社EYS-STYLE | 振替日27日 | 振替結果反映済」<br>\nに設定し「OK」ボタンを押下してください。</p>\n<h3 data-sourcepos=\"29:1-29:24\" id=\"1-1-5\" name=\"1-1-5\"><a class=\"anchor\" id=\"5. CATS Manager MENU\" name=\"5. CATS Manager MENU\" href=\"#5. CATS Manager MENU\" data-position=\"1-1-5\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"5. CATS Manager MENU\"> &gt; 5. CATS Manager MENU</span></a>5. CATS Manager MENU</h3>\n<p data-sourcepos=\"31:1-31:54\">「Step4 最終処理」を押下してください。</p>\n<h3 data-sourcepos=\"33:1-33:40\" id=\"1-1-6\" name=\"1-1-6\"><a class=\"anchor\" id=\"6. 前回振替請求の最終処理\" name=\"6. 前回振替請求の最終処理\" href=\"#6. 前回振替請求の最終処理\" data-position=\"1-1-6\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"6. 前回振替請求の最終処理\"> &gt; 6. 前回振替請求の最終処理</span></a>6. 前回振替請求の最終処理</h3>\n<p data-sourcepos=\"35:1-36:156\">振替日が前回依頼分であることを確認したら「実行」ボタンを押下してください。<br>\n処理が完了したら画面が切り替わり「【最終処理確認】今回請求分の最終処理が終了しました。」と表示されます。</p>\n<p data-sourcepos=\"38:1-38:60\">「メニューへ」ボタンを押下してください。</p>\n<h3 data-sourcepos=\"40:1-40:30\" id=\"1-1-7\" name=\"1-1-7\"><a class=\"anchor\" id=\"7. 再びCATS Manager MENU\" name=\"7. 再びCATS Manager MENU\" href=\"#7. 再びCATS Manager MENU\" data-position=\"1-1-7\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"7. 再びCATS Manager MENU\"> &gt; 7. 再びCATS Manager MENU</span></a>7. 再びCATS Manager MENU</h3>\n<p data-sourcepos=\"42:1-42:63\">「請求予定データ取込」を押下してください。</p>\n<h3 data-sourcepos=\"44:1-44:49\" id=\"1-1-8\" name=\"1-1-8\"><a class=\"anchor\" id=\"8. 請求予定テキストファイル取込\" name=\"8. 請求予定テキストファイル取込\" href=\"#8. 請求予定テキストファイル取込\" data-position=\"1-1-8\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"8. 請求予定テキストファイル取込\"> &gt; 8. 請求予定テキストファイル取込</span></a>8. 請求予定テキストファイル取込</h3>\n<p data-sourcepos=\"46:1-46:48\">フォーム入力の内容を更新します。</p>\n<p data-sourcepos=\"48:1-49:101\">取込データフォーマット: CSVが選択されていることを確認<br>\n取り込み元: 「ファイルを選択」をクリックしYYYYMMDD_HHMMSS_smbc.csvを選択する</p>\n<p data-sourcepos=\"51:1-51:66\">更新したら「取込」ボタンを押下してください。</p>\n<p data-sourcepos=\"53:1-53:149\">「テキストファイルの取込を開始します。」のダイアログが表示されるので、そのままOKを押下してください。</p>\n<p data-sourcepos=\"55:1-55:114\">処理が完了すると「請求予定テキストファイル取込結果」に画面が切り替わります。</p>\n<h3 data-sourcepos=\"57:1-57:28\" id=\"1-1-9\" name=\"1-1-9\"><a class=\"anchor\" id=\"9. エラーチェック\" name=\"9. エラーチェック\" href=\"#9. エラーチェック\" data-position=\"1-1-9\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"9. エラーチェック\"> &gt; 9. エラーチェック</span></a>9. エラーチェック</h3>\n<p data-sourcepos=\"59:1-59:78\">請求予定テキストファイル取込結果の「エラー件数欄」が</p>\n<p data-sourcepos=\"61:1-61:97\">エラー件数が0でない場合は請求依頼リストを修正する必要があります。</p>\n<p data-sourcepos=\"63:1-63:154\">「請求予定テキストファイル取込エラーリスト.PDF」をクリックしエラーの内容を確認し個別で対応してください。</p>\n<p data-sourcepos=\"65:1-65:123\">※顧客番号「100000000131」、「200000003372」に関するエラーはリストから削除して構いません。</p>\n<p data-sourcepos=\"67:1-69:257\">※全件エラーになった場合は以下のパターンが考えられます。<br>\n・パターン1　CSVファイルの文字コードが変わっている<br>\n→CSVファイルをEXCELで開いた後に保存したりしていないでしょうか。その場合、ファイルの内部データが破損している可能性があります。再度motherからCSVファイルをダウンロードしましょう。</p>\n<p data-sourcepos=\"71:1-73:71\">・パターン2　システムの対応時間外<br>\nSMBCのシステムの対応時間は7〜19時です。(2023年1月17日時点)<br>\n19時以降は諦めて翌日に再アップロードしましょう。</p>\n<p data-sourcepos=\"75:1-75:113\">エラーを解決したら再度、手順10から「請求予定データ取込」を行なってください。</p>\n<h3 data-sourcepos=\"77:1-77:65\" id=\"1-1-10\" name=\"1-1-10\"><a class=\"anchor\" id=\"10. 請求予定テキストファイル取込結果の成功\" name=\"10. 請求予定テキストファイル取込結果の成功\" href=\"#10. 請求予定テキストファイル取込結果の成功\" data-position=\"1-1-10\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"10. 請求予定テキストファイル取込結果の成功\"> &gt; 10. 請求予定テキストファイル取込結果の成功</span></a>10. 請求予定テキストファイル取込結果の成功</h3>\n<p data-sourcepos=\"79:1-80:60\">エラー件数が0件であれば取込完了です。<br>\n「メニューへ」ボタンを押下してください。</p>\n<h3 data-sourcepos=\"82:1-82:25\" id=\"1-1-11\" name=\"1-1-11\"><a class=\"anchor\" id=\"11. CATS Manager MENU\" name=\"11. CATS Manager MENU\" href=\"#11. CATS Manager MENU\" data-position=\"1-1-11\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"11. CATS Manager MENU\"> &gt; 11. CATS Manager MENU</span></a>11. CATS Manager MENU</h3>\n<p data-sourcepos=\"84:1-84:69\">「Step1 振替請求データ抽出」を押下してください。</p>\n<h3 data-sourcepos=\"86:1-86:35\" id=\"1-1-12\" name=\"1-1-12\"><a class=\"anchor\" id=\"12. 振替請求データ抽出\" name=\"12. 振替請求データ抽出\" href=\"#12. 振替請求データ抽出\" data-position=\"1-1-12\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"12. 振替請求データ抽出\"> &gt; 12. 振替請求データ抽出</span></a>12. 振替請求データ抽出</h3>\n<p data-sourcepos=\"88:1-89:173\">振替日の日付に問題がなければ「抽出」をクリックしてください。<br>\n「振替請求データの抽出を開始します。よろしいですか？」とダイアログが表示されたら、そのまま「OK」を押下してください。</p>\n<p data-sourcepos=\"91:1-91:87\">画面が切り替わり「振替請求データ抽出結果」が表示されます。</p>\n<h3 data-sourcepos=\"93:1-93:35\" id=\"1-1-13\" name=\"1-1-13\"><a class=\"anchor\" id=\"13. 振替請求データ締め\" name=\"13. 振替請求データ締め\" href=\"#13. 振替請求データ締め\" data-position=\"1-1-13\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"13. 振替請求データ締め\"> &gt; 13. 振替請求データ締め</span></a>13. 振替請求データ締め</h3>\n<p data-sourcepos=\"95:1-95:147\">「振替請求データ抽出結果」のページ下部にある「振替請求データ締め処理へ」ボタンを押下してください。</p>\n<h3 data-sourcepos=\"97:1-97:41\" id=\"1-1-14\" name=\"1-1-14\"><a class=\"anchor\" id=\"14. 振替請求データ締め処理\" name=\"14. 振替請求データ締め処理\" href=\"#14. 振替請求データ締め処理\" data-position=\"1-1-14\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"14. 振替請求データ締め処理\"> &gt; 14. 振替請求データ締め処理</span></a>14. 振替請求データ締め処理</h3>\n<p data-sourcepos=\"99:1-101:179\">表示内容を確認し問題がなければ<br>\n<em><strong>振替データ明細表（PDF）の「作成する」にチェックをつけて「締め処理実行」ボタンを押下してください。</strong></em><br>\n「振替請求データの締め処理を開始します。よろしいですか？」とダイアログが表示されたら、そのまま「OK」を押下してください。</p>\n<p data-sourcepos=\"103:1-103:93\">画面が切り替わり「振替請求データ締め処理結果」が表示されます。</p>\n<h3 data-sourcepos=\"105:1-105:69\" id=\"1-1-15\" name=\"1-1-15\"><a class=\"anchor\" id=\"15. 振替データ明細表.PDFをダウンロードして格納\" name=\"15. 振替データ明細表.PDFをダウンロードして格納\" href=\"#15. 振替データ明細表.PDFをダウンロードして格納\" data-position=\"1-1-15\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"15. 振替データ明細表.PDFをダウンロードして格納\"> &gt; 15. 振替データ明細表.PDFをダウンロードして格納</span></a>15. 振替データ明細表.PDFをダウンロードして格納</h3>\n<p data-sourcepos=\"107:1-107:183\">画面下部にある「振替データ明細表.PDF」のリンクをダウンロードし、ファイル名をSMBC明細.pdfとしてGoogleドライブに保存してください。</p>\n<p data-sourcepos=\"109:1-110:43\"><a href=\"https://drive.google.com/drive/u/0/folders/1EryI1D41yX13DjAguPHh4WVasq5-fRu8\" target=\"_blank\" rel=\"noopener noreferrer\">GoogleDrive</a><br>\nYYYYMMDD(請求日)/YYYYMMDD_SMBC明細.pdf</p>\n", "created_at"=>"2020-03-16T07:28:10+09:00", "message"=>"Update post.", "kind"=>"stock", "comments_count"=>0, "tasks_count"=>0, "done_tasks_count"=>0, "url"=>"https://2nd-community.esa.io/posts/126", "updated_at"=>"2023-01-17T19:47:06+09:00", "tags"=>[], "category"=>"システム本部/定例業務/会費請求", "revision_number"=>8, "created_by"=>{"myself"=>false, "name"=>"keisuke nakama", "screen_name"=>"keisuke_nakama", "icon"=>"https://img.esa.io/uploads/production/members/73528/icon/thumb_m_29a349f0f34eae1e491ad27b13529c97.jpeg"}, "updated_by"=>{"myself"=>true, "name"=>"吉田直人", "screen_name"=>"naoto_yoshida", "icon"=>"https://img.esa.io/uploads/production/users/105730/icon/thumb_m_7ed6de39594feb35d005206783298fdb.png"}, "stargazers_count"=>0, "watchers_count"=>2, "star"=>false, "watch"=>true, "sharing_urls"=>nil}, {"number"=>652, "name"=>"週次反省会 1月17日", "full_name"=>"システム本部/チーム/スクラム/週次反省会 1月17日", "wip"=>false, "body_md"=>"## タスク状況確認（15分）\r\n- (下垣) ビジュアル進化バージョンで実装\r\n- (吉田)\r\n- (石田)\r\n- (高田) JACCSオンライン化\r\n\r\n[◆優先対応タスク link](https://docs.google.com/spreadsheets/d/1-zyqTI2UpNLprVOx7TFXbE--xd7ls1X22M8x6G-kzl0/edit#gid=3895998&range=A1)\r\n\r\nその他 \r\n・自由が丘関連\r\nhttps://app.asana.com/0/0/1203748157187979/f\r\n・お金関連\r\nhttps://app.asana.com/0/1196247230098161/1203765301016275/f\r\n\r\n## チケット勉強会（30分） \r\nhttps://2nd-community.esa.io/posts/653/edit\r\n\r\nkeep,problem,tryは時間があれば。\r\n## Keep (スプリントでうまくいったので、今後も続けたいことは何か？)\r\n- (下垣)\r\n- (吉田)\r\n- (石田)\r\n- クレカフローチャートを書いて理解を深めれた(高田)\r\n\r\n## Problem (スプリントでうまくいかなかったので、今後は中止したいことは何か？)\r\n- (下垣)\r\n- (吉田)\r\n- (石田)\r\n- (高田)\r\n\r\n## Try ( これからやったほうがよいこと、改善したほうがよいことは何か？)\r\n- (下垣)\r\n- (吉田)\r\n- (石田)\r\nチケットのデーター修正を先手を取って、不備対象洗い出し→修正 を行なうことは可能でしょうか？\r\n　→ クラスを跨いでチケット移行処理しているものについて、一括修正する予定です。（https://app.asana.com/0/1196247230098161/1203748337689852/f）（高田）\r\n\r\n- (高田)　\r\n\r\n## その他(何かあれば)\r\n\r\n", "body_html"=>"<h2 data-sourcepos=\"1:1-1:35\" id=\"0-1-0\" name=\"0-1-0\"><a class=\"anchor\" id=\"タスク状況確認（15分）\" name=\"タスク状況確認（15分）\" href=\"#タスク状況確認（15分）\" data-position=\"0-1-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"タスク状況確認（15分）\"> &gt; タスク状況確認（15分）</span></a>タスク状況確認（15分）</h2>\n<ul data-sourcepos=\"2:1-6:0\">\n<li data-sourcepos=\"2:1-2:56\">(下垣) ビジュアル進化バージョンで実装</li>\n<li data-sourcepos=\"3:1-3:10\">(吉田)</li>\n<li data-sourcepos=\"4:1-4:10\">(石田)</li>\n<li data-sourcepos=\"5:1-6:0\">(高田) JACCSオンライン化</li>\n</ul>\n<p data-sourcepos=\"7:1-7:142\"><a href=\"https://docs.google.com/spreadsheets/d/1-zyqTI2UpNLprVOx7TFXbE--xd7ls1X22M8x6G-kzl0/edit#gid=3895998&amp;range=A1\" target=\"_blank\" rel=\"noopener noreferrer\">◆優先対応タスク link</a></p>\n<p data-sourcepos=\"9:1-13:59\">その他<br>\n・自由が丘関連<br>\n<a href=\"https://app.asana.com/0/0/1203748157187979/f\" target=\"_blank\" rel=\"noopener noreferrer\">https://app.asana.com/0/0/1203748157187979/f</a><br>\n・お金関連<br>\n<a href=\"https://app.asana.com/0/1196247230098161/1203765301016275/f\" target=\"_blank\" rel=\"noopener noreferrer\">https://app.asana.com/0/1196247230098161/1203765301016275/f</a></p>\n<h2 data-sourcepos=\"15:1-15:35\" id=\"0-2-0\" name=\"0-2-0\"><a class=\"anchor\" id=\"チケット勉強会（30分）\" name=\"チケット勉強会（30分）\" href=\"#チケット勉強会（30分）\" data-position=\"0-2-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"チケット勉強会（30分）\"> &gt; チケット勉強会（30分）</span></a>チケット勉強会（30分）</h2>\n<p data-sourcepos=\"16:1-16:43\"><a href=\"https://2nd-community.esa.io/posts/653/edit\">https://2nd-community.esa.io/posts/653/edit</a></p>\n<p data-sourcepos=\"18:1-18:40\">keep,problem,tryは時間があれば。</p>\n<h2 data-sourcepos=\"19:1-19:94\" id=\"0-3-0\" name=\"0-3-0\"><a class=\"anchor\" id=\"Keep (スプリントでうまくいったので、今後も続けたいことは何か？)\" name=\"Keep (スプリントでうまくいったので、今後も続けたいことは何か？)\" href=\"#Keep (スプリントでうまくいったので、今後も続けたいことは何か？)\" data-position=\"0-3-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"Keep (スプリントでうまくいったので、今後も続けたいことは何か？)\"> &gt; Keep (スプリントでうまくいったので、今後も続けたいことは何か？)</span></a>Keep (スプリントでうまくいったので、今後も続けたいことは何か？)</h2>\n<ul data-sourcepos=\"20:1-24:0\">\n<li data-sourcepos=\"20:1-20:10\">(下垣)</li>\n<li data-sourcepos=\"21:1-21:10\">(吉田)</li>\n<li data-sourcepos=\"22:1-22:10\">(石田)</li>\n<li data-sourcepos=\"23:1-24:0\">クレカフローチャートを書いて理解を深めれた(高田)</li>\n</ul>\n<h2 data-sourcepos=\"25:1-25:109\" id=\"0-4-0\" name=\"0-4-0\"><a class=\"anchor\" id=\"Problem (スプリントでうまくいかなかったので、今後は中止したいことは何か？)\" name=\"Problem (スプリントでうまくいかなかったので、今後は中止したいことは何か？)\" href=\"#Problem (スプリントでうまくいかなかったので、今後は中止したいことは何か？)\" data-position=\"0-4-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"Problem (スプリントでうまくいかなかったので、今後は中止したいことは何か？)\"> &gt; Problem (スプリントでうまくいかなかったので、今後は中止したいことは何か？)</span></a>Problem (スプリントでうまくいかなかったので、今後は中止したいことは何か？)</h2>\n<ul data-sourcepos=\"26:1-30:0\">\n<li data-sourcepos=\"26:1-26:10\">(下垣)</li>\n<li data-sourcepos=\"27:1-27:10\">(吉田)</li>\n<li data-sourcepos=\"28:1-28:10\">(石田)</li>\n<li data-sourcepos=\"29:1-30:0\">(高田)</li>\n</ul>\n<h2 data-sourcepos=\"31:1-31:100\" id=\"0-5-0\" name=\"0-5-0\"><a class=\"anchor\" id=\"Try ( これからやったほうがよいこと、改善したほうがよいことは何か？)\" name=\"Try ( これからやったほうがよいこと、改善したほうがよいことは何か？)\" href=\"#Try ( これからやったほうがよいこと、改善したほうがよいことは何か？)\" data-position=\"0-5-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"Try ( これからやったほうがよいこと、改善したほうがよいことは何か？)\"> &gt; Try ( これからやったほうがよいこと、改善したほうがよいことは何か？)</span></a>Try ( これからやったほうがよいこと、改善したほうがよいことは何か？)</h2>\n<ul data-sourcepos=\"32:1-39:0\">\n<li data-sourcepos=\"32:1-32:10\"><p data-sourcepos=\"32:3-32:10\">(下垣)</p></li>\n<li data-sourcepos=\"33:1-33:10\"><p data-sourcepos=\"33:3-33:10\">(吉田)</p></li>\n<li data-sourcepos=\"34:1-37:0\"><p data-sourcepos=\"34:3-36:195\">(石田)<br>\nチケットのデーター修正を先手を取って、不備対象洗い出し→修正 を行なうことは可能でしょうか？<br>\n　→ クラスを跨いでチケット移行処理しているものについて、一括修正する予定です。（<a href=\"https://app.asana.com/0/1196247230098161/1203748337689852/f%EF%BC%89%EF%BC%88%E9%AB%98%E7%94%B0%EF%BC%89\" target=\"_blank\" rel=\"noopener noreferrer\">https://app.asana.com/0/1196247230098161/1203748337689852/f）（高田）</a></p></li>\n<li data-sourcepos=\"38:1-39:0\"><p data-sourcepos=\"38:3-38:13\">(高田)　</p></li>\n</ul>\n<h2 data-sourcepos=\"40:1-40:29\" id=\"0-6-0\" name=\"0-6-0\"><a class=\"anchor\" id=\"その他(何かあれば)\" name=\"その他(何かあれば)\" href=\"#その他(何かあれば)\" data-position=\"0-6-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"その他(何かあれば)\"> &gt; その他(何かあれば)</span></a>その他(何かあれば)</h2>\n", "created_at"=>"2023-01-16T10:59:26+09:00", "message"=>"Update post.", "kind"=>"stock", "comments_count"=>0, "tasks_count"=>0, "done_tasks_count"=>0, "url"=>"https://2nd-community.esa.io/posts/652", "updated_at"=>"2023-01-17T17:34:13+09:00", "tags"=>[], "category"=>"システム本部/チーム/スクラム", "revision_number"=>17, "created_by"=>{"myself"=>true, "name"=>"吉田直人", "screen_name"=>"naoto_yoshida", "icon"=>"https://img.esa.io/uploads/production/users/105730/icon/thumb_m_7ed6de39594feb35d005206783298fdb.png"}, "updated_by"=>{"myself"=>true, "name"=>"吉田直人", "screen_name"=>"naoto_yoshida", "icon"=>"https://img.esa.io/uploads/production/users/105730/icon/thumb_m_7ed6de39594feb35d005206783298fdb.png"}, "stargazers_count"=>0, "watchers_count"=>4, "star"=>false, "watch"=>true, "sharing_urls"=>nil}, {"number"=>653, "name"=>"チケット不具合対応", "full_name"=>"システム本部/運用保守/チケット不具合対応", "wip"=>true, "body_md"=>"# 仕様\r\nhttps://2nd-community.esa.io/posts/647\r\n\r\n# 不具合対応方法\r\n## 予約ができない\r\n予約するレッスン実施日時点で、期限切れ回避されていない期限切れレコードがあるか確認。\r\n以下、レコードがあれば予約できる。\r\n\r\n```ruby\r\n            sql = <<-SQL\r\n              SELECT *\r\n              FROM (\r\n                SELECT\r\n                  *,\r\n                  SUM(\#{delta_key}) OVER (PARTITION BY effectuation_date) as expired_delta\r\n                FROM ticket_histories\r\n                WHERE member_id = \#{member_id}\r\n                AND eys_class_id = \#{eys_class_id}\r\n                AND cause_id in (11,12,13)\r\n                AND \#{delta_key} <> 0\r\n                AND effectuation_date > '\#{effectuation_date}'\r\n              ) as tmp\r\n              WHERE cause_id = 11\r\n              AND expired_delta < 0\r\n              ORDER BY effectuation_date\r\n            SQL\r\n```\r\n## キャンセルができない\r\nキャンセルするレッスン実施日以降に、期限切れ回避キャンセル可能な期限切れ回避レコードがあるか確認。\r\n以下、レコードがあればキャンセルできる。\r\n```ruby\r\n        sql = <<-SQL\r\n          SELECT *\r\n          FROM (\r\n            SELECT\r\n              *,\r\n              SUM(\#{delta_key}) OVER (PARTITION BY effectuation_date) as net_avoid\r\n            FROM ticket_histories\r\n            WHERE member_id = \#{member_id}\r\n            AND eys_class_id = \#{eys_class_id}\r\n            AND cause_id in (12,13)\r\n            AND \#{delta_key} <> 0\r\n            AND effectuation_date > '\#{effectuation_date}'\r\n          ) as tmp\r\n          WHERE cause_id = 12\r\n          AND net_avoid > 0\r\n          ORDER BY effectuation_date desc\r\n        SQL\r\n```\r\n\r\n## 枚数を確認してください\r\nmemberが所属する各クラスのチケットを確認する。\r\n\r\n## 履歴を出してください\r\nデータに問題がないか確認し、redashで対応する。\r\nhttps://redash.enjoy-your-sound.com/queries/607\r\n\r\n## チケットが戻らない\r\n元々、チケットの数自体がマイナスになっていた可能性が高い。\r\n→todo 一括修正する。\r\n\r\n# 根本解決へ\r\n ## 予約ができない, キャンセルができない\r\n\r\n以下、memberに対して再度処理実行し一括修正する（700件くらい）\r\nhttps://docs.google.com/spreadsheets/d/1mpPm6sdDSBemXJxPWl7T_fVwWtVuSd4V5eOrub9YkNg/edit#gid=707703049\r\n\r\n→処理できないクラス（マイっsナスになる）は放置すると他のクラスに影響を与えるため、誤差補正で対応？？\r\n\r\n## チケットが戻らない\r\nチケットがマイナスになっているクラスを修正\r\n\r\n## 枚数を確認してください,履歴を出してください\r\nmotherの履歴を見やすく修正、csvだせるよう修正\r\nSCに履歴を作成\r\n\r\n## 問題点、足りない機能など\r\n- チケット削除機能\r\n- 期限延長機能\r\n- チケット選択機能（全て会員に見えないロジックでやるので、問い合わせが多いのでは？？）\r\n- SCの表現がわかりにくい（来月追加分、再来月追加分）\r\n- 複数クラスのチケットを持っている場合は、そのクラスの中で古いチケットから消費されるため、現在のSCの表示の仕方だとわかりにくい\r\n- レッスン回数の変更だけでもクラスが新しく作られる。クラスが多すぎてわかりにくくなりそう。\r\n- motherからのクラス変更は、チケットが残っている場合使えなくなる。誤差補正で対応しているデータも見られるが、新しいクラスのチケットとして扱われ適切でない。\r\n- チケットを持つはずがない？クラスでチケットを持っている可能性。（is_fixed_lesson=trueかつschedule_typeがfree）\r\n- 昔の仕様がわからないので、クラス変更で残っているチケットの扱いをどうするか\r\n\r\n## 関連query\r\n```sql\r\n--クラスを跨いで移行処理したmember\r\nselect distinct member_id \r\nfrom (\r\nselect *,\r\n\tsum(delta) over (partition by effectuation_date, eys_class_id) as sumdelta,\r\n\tmin(cause_id) over (partition by effectuation_date, eys_class_id) as mincause\r\n\tfrom ticket_histories th\r\n\tinner join members m on th.member_id = m.id\r\n\twhere true \r\n\tand cause_id in (11,12,13)\r\n\tand m.status_id in (1,2,4,6,99)\r\n) as tmp\r\nwhere true \r\nand sumdelta > 0 or mincause > 11\r\n```\r\n\r\n```sql\r\n--チケットを持つはずがないクラスでチケットを持っているクラス\r\nselect distinct m.id from eys_classes ec \r\ninner join eys_class_members ecm on ec.id = ecm.eys_class_id\r\ninner join members m on m.id = ecm.member_id \r\ninner join ticket_histories th on ec.id = th.eys_class_id \r\nwhere true \r\nand th.cause_id not in (11,12,13)\r\nand ( false\r\nor ec.additional_lesson_dummy = true \r\nor ec.is_fixed_lesson = true \r\nor ec.all_free_dummy = true\r\n)\r\nand m.status_id in (1,2,4,6,99) --alive以外無視\r\n```", "body_html"=>"<h1 data-sourcepos=\"1:1-1:8\" id=\"1-0-0\" name=\"1-0-0\"><a class=\"anchor\" id=\"仕様\" name=\"仕様\" href=\"#仕様\" data-position=\"1-0-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"仕様\"> &gt; 仕様</span></a>仕様</h1>\n<p data-sourcepos=\"2:1-2:38\"><a href=\"https://2nd-community.esa.io/posts/647\">https://2nd-community.esa.io/posts/647</a></p>\n<h1 data-sourcepos=\"4:1-4:23\" id=\"2-0-0\" name=\"2-0-0\"><a class=\"anchor\" id=\"不具合対応方法\" name=\"不具合対応方法\" href=\"#不具合対応方法\" data-position=\"2-0-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"不具合対応方法\"> &gt; 不具合対応方法</span></a>不具合対応方法</h1>\n<h2 data-sourcepos=\"5:1-5:24\" id=\"2-1-0\" name=\"2-1-0\"><a class=\"anchor\" id=\"予約ができない\" name=\"予約ができない\" href=\"#予約ができない\" data-position=\"2-1-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"予約ができない\"> &gt; 予約ができない</span></a>予約ができない</h2>\n<p data-sourcepos=\"6:1-7:51\">予約するレッスン実施日時点で、期限切れ回避されていない期限切れレコードがあるか確認。<br>\n以下、レコードがあれば予約できる。</p>\n<div class=\"code-block\" data-sourcepos=\"9:1-27:3\"><div class=\"code-filename\"><i class=\"fa fa-file-code-o\"></i>ruby</div><div class=\"highlight\"><pre class=\"highlight ruby\"><code>            <span class=\"n\">sql</span> <span class=\"o\">=</span> <span class=\"o\">&lt;&lt;-</span><span class=\"no\">SQL</span><span class=\"sh\">\n              SELECT *\n              FROM (\n                SELECT\n                  *,\n                  SUM(</span><span class=\"si\">\#{</span><span class=\"n\">delta_key</span><span class=\"si\">}</span><span class=\"sh\">) OVER (PARTITION BY effectuation_date) as expired_delta\n                FROM ticket_histories\n                WHERE member_id = </span><span class=\"si\">\#{</span><span class=\"n\">member_id</span><span class=\"si\">}</span><span class=\"sh\">\n                AND eys_class_id = </span><span class=\"si\">\#{</span><span class=\"n\">eys_class_id</span><span class=\"si\">}</span><span class=\"sh\">\n                AND cause_id in (11,12,13)\n                AND </span><span class=\"si\">\#{</span><span class=\"n\">delta_key</span><span class=\"si\">}</span><span class=\"sh\"> &lt;&gt; 0\n                AND effectuation_date &gt; '</span><span class=\"si\">\#{</span><span class=\"n\">effectuation_date</span><span class=\"si\">}</span><span class=\"sh\">'\n              ) as tmp\n              WHERE cause_id = 11\n              AND expired_delta &lt; 0\n              ORDER BY effectuation_date\n</span><span class=\"no\">            SQL</span>\n</code></pre></div></div>\n<h2 data-sourcepos=\"28:1-28:33\" id=\"2-2-0\" name=\"2-2-0\"><a class=\"anchor\" id=\"キャンセルができない\" name=\"キャンセルができない\" href=\"#キャンセルができない\" data-position=\"2-2-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"キャンセルができない\"> &gt; キャンセルができない</span></a>キャンセルができない</h2>\n<p data-sourcepos=\"29:1-30:60\">キャンセルするレッスン実施日以降に、期限切れ回避キャンセル可能な期限切れ回避レコードがあるか確認。<br>\n以下、レコードがあればキャンセルできる。</p>\n<div class=\"code-block\" data-sourcepos=\"31:1-49:3\"><div class=\"code-filename\"><i class=\"fa fa-file-code-o\"></i>ruby</div><div class=\"highlight\"><pre class=\"highlight ruby\"><code>        <span class=\"n\">sql</span> <span class=\"o\">=</span> <span class=\"o\">&lt;&lt;-</span><span class=\"no\">SQL</span><span class=\"sh\">\n          SELECT *\n          FROM (\n            SELECT\n              *,\n              SUM(</span><span class=\"si\">\#{</span><span class=\"n\">delta_key</span><span class=\"si\">}</span><span class=\"sh\">) OVER (PARTITION BY effectuation_date) as net_avoid\n            FROM ticket_histories\n            WHERE member_id = </span><span class=\"si\">\#{</span><span class=\"n\">member_id</span><span class=\"si\">}</span><span class=\"sh\">\n            AND eys_class_id = </span><span class=\"si\">\#{</span><span class=\"n\">eys_class_id</span><span class=\"si\">}</span><span class=\"sh\">\n            AND cause_id in (12,13)\n            AND </span><span class=\"si\">\#{</span><span class=\"n\">delta_key</span><span class=\"si\">}</span><span class=\"sh\"> &lt;&gt; 0\n            AND effectuation_date &gt; '</span><span class=\"si\">\#{</span><span class=\"n\">effectuation_date</span><span class=\"si\">}</span><span class=\"sh\">'\n          ) as tmp\n          WHERE cause_id = 12\n          AND net_avoid &gt; 0\n          ORDER BY effectuation_date desc\n</span><span class=\"no\">        SQL</span>\n</code></pre></div></div>\n<h2 data-sourcepos=\"51:1-51:36\" id=\"2-3-0\" name=\"2-3-0\"><a class=\"anchor\" id=\"枚数を確認してください\" name=\"枚数を確認してください\" href=\"#枚数を確認してください\" data-position=\"2-3-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"枚数を確認してください\"> &gt; 枚数を確認してください</span></a>枚数を確認してください</h2>\n<p data-sourcepos=\"52:1-52:66\">memberが所属する各クラスのチケットを確認する。</p>\n<h2 data-sourcepos=\"54:1-54:33\" id=\"2-4-0\" name=\"2-4-0\"><a class=\"anchor\" id=\"履歴を出してください\" name=\"履歴を出してください\" href=\"#履歴を出してください\" data-position=\"2-4-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"履歴を出してください\"> &gt; 履歴を出してください</span></a>履歴を出してください</h2>\n<p data-sourcepos=\"55:1-56:47\">データに問題がないか確認し、redashで対応する。<br>\n<a href=\"https://redash.enjoy-your-sound.com/queries/607\" target=\"_blank\" rel=\"noopener noreferrer\">https://redash.enjoy-your-sound.com/queries/607</a></p>\n<h2 data-sourcepos=\"58:1-58:30\" id=\"2-5-0\" name=\"2-5-0\"><a class=\"anchor\" id=\"チケットが戻らない\" name=\"チケットが戻らない\" href=\"#チケットが戻らない\" data-position=\"2-5-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"チケットが戻らない\"> &gt; チケットが戻らない</span></a>チケットが戻らない</h2>\n<p data-sourcepos=\"59:1-60:29\">元々、チケットの数自体がマイナスになっていた可能性が高い。<br>\n→todo 一括修正する。</p>\n<h1 data-sourcepos=\"62:1-62:17\" id=\"3-0-0\" name=\"3-0-0\"><a class=\"anchor\" id=\"根本解決へ\" name=\"根本解決へ\" href=\"#根本解決へ\" data-position=\"3-0-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"根本解決へ\"> &gt; 根本解決へ</span></a>根本解決へ</h1>\n<h2 data-sourcepos=\"63:2-63:57\" id=\"3-1-0\" name=\"3-1-0\"><a class=\"anchor\" id=\"予約ができない, キャンセルができない\" name=\"予約ができない, キャンセルができない\" href=\"#予約ができない, キャンセルができない\" data-position=\"3-1-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"予約ができない, キャンセルができない\"> &gt; 予約ができない, キャンセルができない</span></a>予約ができない, キャンセルができない</h2>\n<p data-sourcepos=\"65:1-66:102\">以下、memberに対して再度処理実行し一括修正する（700件くらい）<br>\n<a href=\"https://docs.google.com/spreadsheets/d/1mpPm6sdDSBemXJxPWl7T_fVwWtVuSd4V5eOrub9YkNg/edit#gid=707703049\" target=\"_blank\" rel=\"noopener noreferrer\">https://docs.google.com/spreadsheets/d/1mpPm6sdDSBemXJxPWl7T_fVwWtVuSd4V5eOrub9YkNg/edit#gid=707703049</a></p>\n<p data-sourcepos=\"68:1-68:151\">→処理できないクラス（マイっsナスになる）は放置すると他のクラスに影響を与えるため、誤差補正で対応？？</p>\n<h2 data-sourcepos=\"70:1-70:30\" id=\"3-2-0\" name=\"3-2-0\"><a class=\"anchor\" id=\"チケットが戻らない-1\" name=\"チケットが戻らない-1\" href=\"#チケットが戻らない-1\" data-position=\"3-2-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"チケットが戻らない\"> &gt; チケットが戻らない</span></a>チケットが戻らない</h2>\n<p data-sourcepos=\"71:1-71:63\">チケットがマイナスになっているクラスを修正</p>\n<h2 data-sourcepos=\"73:1-73:67\" id=\"3-3-0\" name=\"3-3-0\"><a class=\"anchor\" id=\"枚数を確認してください,履歴を出してください\" name=\"枚数を確認してください,履歴を出してください\" href=\"#枚数を確認してください,履歴を出してください\" data-position=\"3-3-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"枚数を確認してください,履歴を出してください\"> &gt; 枚数を確認してください,履歴を出してください</span></a>枚数を確認してください,履歴を出してください</h2>\n<p data-sourcepos=\"74:1-75:20\">motherの履歴を見やすく修正、csvだせるよう修正<br>\nSCに履歴を作成</p>\n<h2 data-sourcepos=\"77:1-77:39\" id=\"3-4-0\" name=\"3-4-0\"><a class=\"anchor\" id=\"問題点、足りない機能など\" name=\"問題点、足りない機能など\" href=\"#問題点、足りない機能など\" data-position=\"3-4-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"問題点、足りない機能など\"> &gt; 問題点、足りない機能など</span></a>問題点、足りない機能など</h2>\n<ul data-sourcepos=\"78:1-87:0\">\n<li data-sourcepos=\"78:1-78:26\">チケット削除機能</li>\n<li data-sourcepos=\"79:1-79:20\">期限延長機能</li>\n<li data-sourcepos=\"80:1-80:128\">チケット選択機能（全て会員に見えないロジックでやるので、問い合わせが多いのでは？？）</li>\n<li data-sourcepos=\"81:1-81:76\">SCの表現がわかりにくい（来月追加分、再来月追加分）</li>\n<li data-sourcepos=\"82:1-82:187\">複数クラスのチケットを持っている場合は、そのクラスの中で古いチケットから消費されるため、現在のSCの表示の仕方だとわかりにくい</li>\n<li data-sourcepos=\"83:1-83:134\">レッスン回数の変更だけでもクラスが新しく作られる。クラスが多すぎてわかりにくくなりそう。</li>\n<li data-sourcepos=\"84:1-84:227\">motherからのクラス変更は、チケットが残っている場合使えなくなる。誤差補正で対応しているデータも見られるが、新しいクラスのチケットとして扱われ適切でない。</li>\n<li data-sourcepos=\"85:1-85:147\">チケットを持つはずがない？クラスでチケットを持っている可能性。（is_fixed_lesson=trueかつschedule_typeがfree）</li>\n<li data-sourcepos=\"86:1-87:0\">昔の仕様がわからないので、クラス変更で残っているチケットの扱いをどうするか</li>\n</ul>\n<h2 data-sourcepos=\"88:1-88:14\" id=\"3-5-0\" name=\"3-5-0\"><a class=\"anchor\" id=\"関連query\" name=\"関連query\" href=\"#関連query\" data-position=\"3-5-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"関連query\"> &gt; 関連query</span></a>関連query</h2>\n<div class=\"code-block\" data-sourcepos=\"89:1-104:3\"><div class=\"code-filename\"><i class=\"fa fa-file-code-o\"></i>sql</div><div class=\"highlight\"><pre class=\"highlight sql\"><code><span class=\"c1\">--クラスを跨いで移行処理したmember</span>\n<span class=\"k\">select</span> <span class=\"k\">distinct</span> <span class=\"n\">member_id</span> \n<span class=\"k\">from</span> <span class=\"p\">(</span>\n<span class=\"k\">select</span> <span class=\"o\">*</span><span class=\"p\">,</span>\n\t<span class=\"k\">sum</span><span class=\"p\">(</span><span class=\"n\">delta</span><span class=\"p\">)</span> <span class=\"n\">over</span> <span class=\"p\">(</span><span class=\"k\">partition</span> <span class=\"k\">by</span> <span class=\"n\">effectuation_date</span><span class=\"p\">,</span> <span class=\"n\">eys_class_id</span><span class=\"p\">)</span> <span class=\"k\">as</span> <span class=\"n\">sumdelta</span><span class=\"p\">,</span>\n\t<span class=\"k\">min</span><span class=\"p\">(</span><span class=\"n\">cause_id</span><span class=\"p\">)</span> <span class=\"n\">over</span> <span class=\"p\">(</span><span class=\"k\">partition</span> <span class=\"k\">by</span> <span class=\"n\">effectuation_date</span><span class=\"p\">,</span> <span class=\"n\">eys_class_id</span><span class=\"p\">)</span> <span class=\"k\">as</span> <span class=\"n\">mincause</span>\n\t<span class=\"k\">from</span> <span class=\"n\">ticket_histories</span> <span class=\"n\">th</span>\n\t<span class=\"k\">inner</span> <span class=\"k\">join</span> <span class=\"n\">members</span> <span class=\"n\">m</span> <span class=\"k\">on</span> <span class=\"n\">th</span><span class=\"p\">.</span><span class=\"n\">member_id</span> <span class=\"o\">=</span> <span class=\"n\">m</span><span class=\"p\">.</span><span class=\"n\">id</span>\n\t<span class=\"k\">where</span> <span class=\"k\">true</span> \n\t<span class=\"k\">and</span> <span class=\"n\">cause_id</span> <span class=\"k\">in</span> <span class=\"p\">(</span><span class=\"mi\">11</span><span class=\"p\">,</span><span class=\"mi\">12</span><span class=\"p\">,</span><span class=\"mi\">13</span><span class=\"p\">)</span>\n\t<span class=\"k\">and</span> <span class=\"n\">m</span><span class=\"p\">.</span><span class=\"n\">status_id</span> <span class=\"k\">in</span> <span class=\"p\">(</span><span class=\"mi\">1</span><span class=\"p\">,</span><span class=\"mi\">2</span><span class=\"p\">,</span><span class=\"mi\">4</span><span class=\"p\">,</span><span class=\"mi\">6</span><span class=\"p\">,</span><span class=\"mi\">99</span><span class=\"p\">)</span>\n<span class=\"p\">)</span> <span class=\"k\">as</span> <span class=\"n\">tmp</span>\n<span class=\"k\">where</span> <span class=\"k\">true</span> \n<span class=\"k\">and</span> <span class=\"n\">sumdelta</span> <span class=\"o\">&gt;</span> <span class=\"mi\">0</span> <span class=\"k\">or</span> <span class=\"n\">mincause</span> <span class=\"o\">&gt;</span> <span class=\"mi\">11</span>\n</code></pre></div></div>\n<div class=\"code-block\" data-sourcepos=\"106:1-120:3\"><div class=\"code-filename\"><i class=\"fa fa-file-code-o\"></i>sql</div><div class=\"highlight\"><pre class=\"highlight sql\"><code><span class=\"c1\">--チケットを持つはずがないクラスでチケットを持っているクラス</span>\n<span class=\"k\">select</span> <span class=\"k\">distinct</span> <span class=\"n\">m</span><span class=\"p\">.</span><span class=\"n\">id</span> <span class=\"k\">from</span> <span class=\"n\">eys_classes</span> <span class=\"n\">ec</span> \n<span class=\"k\">inner</span> <span class=\"k\">join</span> <span class=\"n\">eys_class_members</span> <span class=\"n\">ecm</span> <span class=\"k\">on</span> <span class=\"n\">ec</span><span class=\"p\">.</span><span class=\"n\">id</span> <span class=\"o\">=</span> <span class=\"n\">ecm</span><span class=\"p\">.</span><span class=\"n\">eys_class_id</span>\n<span class=\"k\">inner</span> <span class=\"k\">join</span> <span class=\"n\">members</span> <span class=\"n\">m</span> <span class=\"k\">on</span> <span class=\"n\">m</span><span class=\"p\">.</span><span class=\"n\">id</span> <span class=\"o\">=</span> <span class=\"n\">ecm</span><span class=\"p\">.</span><span class=\"n\">member_id</span> \n<span class=\"k\">inner</span> <span class=\"k\">join</span> <span class=\"n\">ticket_histories</span> <span class=\"n\">th</span> <span class=\"k\">on</span> <span class=\"n\">ec</span><span class=\"p\">.</span><span class=\"n\">id</span> <span class=\"o\">=</span> <span class=\"n\">th</span><span class=\"p\">.</span><span class=\"n\">eys_class_id</span> \n<span class=\"k\">where</span> <span class=\"k\">true</span> \n<span class=\"k\">and</span> <span class=\"n\">th</span><span class=\"p\">.</span><span class=\"n\">cause_id</span> <span class=\"k\">not</span> <span class=\"k\">in</span> <span class=\"p\">(</span><span class=\"mi\">11</span><span class=\"p\">,</span><span class=\"mi\">12</span><span class=\"p\">,</span><span class=\"mi\">13</span><span class=\"p\">)</span>\n<span class=\"k\">and</span> <span class=\"p\">(</span> <span class=\"k\">false</span>\n<span class=\"k\">or</span> <span class=\"n\">ec</span><span class=\"p\">.</span><span class=\"n\">additional_lesson_dummy</span> <span class=\"o\">=</span> <span class=\"k\">true</span> \n<span class=\"k\">or</span> <span class=\"n\">ec</span><span class=\"p\">.</span><span class=\"n\">is_fixed_lesson</span> <span class=\"o\">=</span> <span class=\"k\">true</span> \n<span class=\"k\">or</span> <span class=\"n\">ec</span><span class=\"p\">.</span><span class=\"n\">all_free_dummy</span> <span class=\"o\">=</span> <span class=\"k\">true</span>\n<span class=\"p\">)</span>\n<span class=\"k\">and</span> <span class=\"n\">m</span><span class=\"p\">.</span><span class=\"n\">status_id</span> <span class=\"k\">in</span> <span class=\"p\">(</span><span class=\"mi\">1</span><span class=\"p\">,</span><span class=\"mi\">2</span><span class=\"p\">,</span><span class=\"mi\">4</span><span class=\"p\">,</span><span class=\"mi\">6</span><span class=\"p\">,</span><span class=\"mi\">99</span><span class=\"p\">)</span> <span class=\"c1\">--alive以外無視</span>\n</code></pre></div></div>\n", "created_at"=>"2023-01-16T11:25:13+09:00", "message"=>"Update post.", "kind"=>"stock", "comments_count"=>0, "tasks_count"=>0, "done_tasks_count"=>0, "url"=>"https://2nd-community.esa.io/posts/653", "updated_at"=>"2023-01-17T17:20:23+09:00", "tags"=>[], "category"=>"システム本部/運用保守", "revision_number"=>16, "created_by"=>{"myself"=>false, "name"=>"高田悦成", "screen_name"=>"essei_takada", "icon"=>"https://img.esa.io/uploads/production/users/119434/icon/thumb_m_75c84655889d80b06b27d9c1a43c631b.png"}, "updated_by"=>{"myself"=>false, "name"=>"高田悦成", "screen_name"=>"essei_takada", "icon"=>"https://img.esa.io/uploads/production/users/119434/icon/thumb_m_75c84655889d80b06b27d9c1a43c631b.png"}, "stargazers_count"=>0, "watchers_count"=>1, "star"=>false, "watch"=>false, "sharing_urls"=>nil}, {"number"=>124, "name"=>"請求データ作成処理", "full_name"=>"システム本部/定例業務/会費請求/請求データ作成処理", "wip"=>false, "body_md"=>"# 売上締め処理\r\n\r\n毎月10日に自動登録される売上を売掛金データとして登録する処理です。\r\n\r\n## 手順\r\n\r\n### 1. <a href=\"http://54.249.6.0/accounting/unpaid/tickets\" target=\"_blank\">Motherの新お金管理-基本画面</a>へアクセス\r\n\r\n<img width=\"825\" alt=\"image.png (32.5 kB)\" src=\"https://img.esa.io/uploads/production/attachments/14521/2022/12/14/128235/d0440a4d-7ee8-43df-8e48-157911ff4924.png\">\r\n\r\n※money-kanri-mother.2nd-community.com のURLであることをご確認ください。\r\n　処理自体は中断されることはなく、「締め（xxxxx件）」ボタンの対象件数から処理の完了を推測する事も可能ですがご注意ください。\r\n\r\n### 2. 売上締め実施\r\n\r\nページ最下部の「売上締め」項目にある「締め（xxxxx件）」のボタンを押下すると締め処理が実行されます。\r\n処理には30分程時間を要します。", "body_html"=>"<h1 data-sourcepos=\"1:1-1:20\" id=\"1-0-0\" name=\"1-0-0\"><a class=\"anchor\" id=\"売上締め処理\" name=\"売上締め処理\" href=\"#売上締め処理\" data-position=\"1-0-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"売上締め処理\"> &gt; 売上締め処理</span></a>売上締め処理</h1>\n<p data-sourcepos=\"3:1-3:98\">毎月10日に自動登録される売上を売掛金データとして登録する処理です。</p>\n<h2 data-sourcepos=\"5:1-5:9\" id=\"1-1-0\" name=\"1-1-0\"><a class=\"anchor\" id=\"手順\" name=\"手順\" href=\"#手順\" data-position=\"1-1-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"手順\"> &gt; 手順</span></a>手順</h2>\n<h3 data-sourcepos=\"7:1-7:133\" id=\"1-1-1\" name=\"1-1-1\"><a class=\"anchor\" id=\"1. Motherの新お金管理-基本画面へアクセス\" name=\"1. Motherの新お金管理-基本画面へアクセス\" href=\"#1. Motherの新お金管理-基本画面へアクセス\" data-position=\"1-1-1\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"1. Motherの新お金管理-基本画面へアクセス\"> &gt; 1. Motherの新お金管理-基本画面へアクセス</span></a>1. <a href=\"http://54.249.6.0/accounting/unpaid/tickets\" target=\"_blank\" rel=\"noopener noreferrer\">Motherの新お金管理-基本画面</a>へアクセス</h3>\n<a href=\"https://img.esa.io/uploads/production/attachments/14521/2022/12/14/128235/d0440a4d-7ee8-43df-8e48-157911ff4924.png\" target=\"_blank\" rel=\"noopener noreferrer\"><img width=\"825\" alt=\"image.png (32.5 kB)\" src=\"https://img.esa.io/uploads/production/attachments/14521/2022/12/14/128235/d0440a4d-7ee8-43df-8e48-157911ff4924.png\"></a>\n<p data-sourcepos=\"11:1-12:182\">※money-kanri-mother.2nd-community.com のURLであることをご確認ください。<br>\n　処理自体は中断されることはなく、「締め（xxxxx件）」ボタンの対象件数から処理の完了を推測する事も可能ですがご注意ください。</p>\n<h3 data-sourcepos=\"14:1-14:25\" id=\"1-1-2\" name=\"1-1-2\"><a class=\"anchor\" id=\"2. 売上締め実施\" name=\"2. 売上締め実施\" href=\"#2. 売上締め実施\" data-position=\"1-1-2\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"2. 売上締め実施\"> &gt; 2. 売上締め実施</span></a>2. 売上締め実施</h3>\n<p data-sourcepos=\"16:1-17:44\">ページ最下部の「売上締め」項目にある「締め（xxxxx件）」のボタンを押下すると締め処理が実行されます。<br>\n処理には30分程時間を要します。</p>\n", "created_at"=>"2020-03-16T07:26:40+09:00", "message"=>"Update post.", "kind"=>"stock", "comments_count"=>0, "tasks_count"=>0, "done_tasks_count"=>0, "url"=>"https://2nd-community.esa.io/posts/124", "updated_at"=>"2023-01-16T10:21:29+09:00", "tags"=>[], "category"=>"システム本部/定例業務/会費請求", "revision_number"=>10, "created_by"=>{"myself"=>false, "name"=>"keisuke nakama", "screen_name"=>"keisuke_nakama", "icon"=>"https://img.esa.io/uploads/production/members/73528/icon/thumb_m_29a349f0f34eae1e491ad27b13529c97.jpeg"}, "updated_by"=>{"myself"=>true, "name"=>"吉田直人", "screen_name"=>"naoto_yoshida", "icon"=>"https://img.esa.io/uploads/production/users/105730/icon/thumb_m_7ed6de39594feb35d005206783298fdb.png"}, "stargazers_count"=>0, "watchers_count"=>4, "star"=>false, "watch"=>true, "sharing_urls"=>nil}, {"number"=>118, "name"=>"請求締め", "full_name"=>"システム本部/定例業務/会費請求/請求締め", "wip"=>false, "body_md"=>"# 請求締め\r\n\r\n当月依頼の振替請求を確定し締め処理を実施します。\r\n\r\n## 手順\r\n\r\n### 1. <a href=\"http://54.249.6.0/accounting/unpaid/tickets\" target=\"_blank\">Motherの新お金管理-基本画面</a>へアクセス\r\n\r\n<img width=\"832\" alt=\"image.png (51.4 kB)\" src=\"https://img.esa.io/uploads/production/attachments/14521/2022/12/13/128235/f0d95444-0a89-402a-8690-b5f3be17c51a.png\">\r\n\r\n\r\n### 2. 請求締めを実行\r\n\r\nページ二段目の「請求締め」項目にある「請求締め実行（xxxxx）」のボタンを押下すると請求締め処理が実行されます。\r\n処理が完了すると同ページの「実行結果ファイル一覧」の項目に以下のようなファイルが追加されます。\r\n\r\nYYYYMMDD_HHMMSS_smbc.csv\r\nYYYYMMDD_HHMMSS_jaccs.csv\r\nYYYYMMDD_HHMMSS_jaccs(確認用).csv\r\nYYYYMMDD_HHMMSS_jaccs_for_smile_payment_collection.csv\r\nYYYYMMDD_HHMMSS_jaccs_for_regular_collection.csv\r\n\r\n※YYYYMMDD_HHMMSSはファイル作成時の「年月日_時分秒」に置き換えられます。\r\n\r\n**ダウンロードしたファイルは文字コードがUTF-8になっているため、SHIFT-JISに変更すること。SMBCはUTF-8のままでもアップロードできるが、JACCSは文字コードを変換しないと無理。\r\nやり方は以下を参照**\r\nhttps://support.freee.co.jp/hc/ja/articles/115002727126-CSV%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%81%8C%E6%96%87%E5%AD%97%E5%8C%96%E3%81%91%E3%81%97%E3%81%9F%E5%A0%B4%E5%90%88%E3%81%AE%E5%AF%BE%E5%87%A6%E6%96%B9%E6%B3%95\r\n\r\n### 3. 確認用ファイルに記載されている情報を帳票に記載\r\n[月会費請求帳票](https://docs.google.com/spreadsheets/d/1zqvdswahxbhO1Wzbjdu252MnLolHYsC3/edit#gid=491889594)\r\n\r\n####  JACCS(Smaile Paymentと通常集金代行の合計)への請求金額を記載\r\nYYYYMMDD_HHMMSS_jaccs(確認用).csv\r\nのファイル末尾に以下のような記載があります。\r\n\r\nデータ区分,請求件数,請求金額,振替済件数,振替済金額,振替不能件数,振替不能金額,ダミー\r\n8, 008057(※1), 000092733394(※2), 000000, 000000000000, 000000, 000000000000,  \r\n(※1)が振替依頼の件数、(※2)が総額になるのでそれぞれ帳票のD列、E列に記載しておいてください。\r\n\r\n#### JACCS(Smaile Payment)への請求金額を記載\r\nYYYYMMDD_HHMMSS_jaccs_for_smile_payment_collection.csv\r\nCSVファイルのH列が請求金額になっています。\r\n金額の合計と件数を帳票のH列、I列に記載してください。\r\n\r\n#### JACCS(通常集金代行)への請求金額を記載\r\nYYYYMMDD_HHMMSS_jaccs_for_regular_collection.csv\r\nCSVファイルのH列が請求金額になっています。\r\n金額の合計と件数を帳票のL列、 M列に記載してください。\r\n\r\n#### SMBCへの請求金額を記載\r\nYYYYMMDD_HHMMSS_smbc.csv\r\nCSVファイルのC列が請求金額になっています。\r\n金額の合計と件数を帳票のP列、 Q列に記載してください。\r\n", "body_html"=>"<h1 data-sourcepos=\"1:1-1:14\" id=\"1-0-0\" name=\"1-0-0\"><a class=\"anchor\" id=\"請求締め\" name=\"請求締め\" href=\"#請求締め\" data-position=\"1-0-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"請求締め\"> &gt; 請求締め</span></a>請求締め</h1>\n<p data-sourcepos=\"3:1-3:72\">当月依頼の振替請求を確定し締め処理を実施します。</p>\n<h2 data-sourcepos=\"5:1-5:9\" id=\"1-1-0\" name=\"1-1-0\"><a class=\"anchor\" id=\"手順\" name=\"手順\" href=\"#手順\" data-position=\"1-1-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"手順\"> &gt; 手順</span></a>手順</h2>\n<h3 data-sourcepos=\"7:1-7:133\" id=\"1-1-1\" name=\"1-1-1\"><a class=\"anchor\" id=\"1. Motherの新お金管理-基本画面へアクセス\" name=\"1. Motherの新お金管理-基本画面へアクセス\" href=\"#1. Motherの新お金管理-基本画面へアクセス\" data-position=\"1-1-1\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"1. Motherの新お金管理-基本画面へアクセス\"> &gt; 1. Motherの新お金管理-基本画面へアクセス</span></a>1. <a href=\"http://54.249.6.0/accounting/unpaid/tickets\" target=\"_blank\" rel=\"noopener noreferrer\">Motherの新お金管理-基本画面</a>へアクセス</h3>\n<a href=\"https://img.esa.io/uploads/production/attachments/14521/2022/12/13/128235/f0d95444-0a89-402a-8690-b5f3be17c51a.png\" target=\"_blank\" rel=\"noopener noreferrer\"><img width=\"832\" alt=\"image.png (51.4 kB)\" src=\"https://img.esa.io/uploads/production/attachments/14521/2022/12/13/128235/f0d95444-0a89-402a-8690-b5f3be17c51a.png\"></a>\n<h3 data-sourcepos=\"12:1-12:28\" id=\"1-1-2\" name=\"1-1-2\"><a class=\"anchor\" id=\"2. 請求締めを実行\" name=\"2. 請求締めを実行\" href=\"#2. 請求締めを実行\" data-position=\"1-1-2\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"2. 請求締めを実行\"> &gt; 2. 請求締めを実行</span></a>2. 請求締めを実行</h3>\n<p data-sourcepos=\"14:1-15:141\">ページ二段目の「請求締め」項目にある「請求締め実行（xxxxx）」のボタンを押下すると請求締め処理が実行されます。<br>\n処理が完了すると同ページの「実行結果ファイル一覧」の項目に以下のようなファイルが追加されます。</p>\n<p data-sourcepos=\"17:1-21:48\">YYYYMMDD_HHMMSS_smbc.csv<br>\nYYYYMMDD_HHMMSS_jaccs.csv<br>\nYYYYMMDD_HHMMSS_jaccs(確認用).csv<br>\nYYYYMMDD_HHMMSS_jaccs_for_smile_payment_collection.csv<br>\nYYYYMMDD_HHMMSS_jaccs_for_regular_collection.csv</p>\n<p data-sourcepos=\"23:1-23:100\">※YYYYMMDD_HHMMSSはファイル作成時の「年月日_時分秒」に置き換えられます。</p>\n<p data-sourcepos=\"25:1-27:221\"><strong>ダウンロードしたファイルは文字コードがUTF-8になっているため、SHIFT-JISに変更すること。SMBCはUTF-8のままでもアップロードできるが、JACCSは文字コードを変換しないと無理。<br>\nやり方は以下を参照</strong><br>\n<a href=\"https://support.freee.co.jp/hc/ja/articles/115002727126-CSV%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%81%8C%E6%96%87%E5%AD%97%E5%8C%96%E3%81%91%E3%81%97%E3%81%9F%E5%A0%B4%E5%90%88%E3%81%AE%E5%AF%BE%E5%87%A6%E6%96%B9%E6%B3%95\" target=\"_blank\" rel=\"noopener noreferrer\">https://support.freee.co.jp/hc/ja/articles/115002727126-CSV%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%81%8C%E6%96%87%E5%AD%97%E5%8C%96%E3%81%91%E3%81%97%E3%81%9F%E5%A0%B4%E5%90%88%E3%81%AE%E5%AF%BE%E5%87%A6%E6%96%B9%E6%B3%95</a></p>\n<h3 data-sourcepos=\"29:1-29:76\" id=\"1-1-3\" name=\"1-1-3\"><a class=\"anchor\" id=\"3. 確認用ファイルに記載されている情報を帳票に記載\" name=\"3. 確認用ファイルに記載されている情報を帳票に記載\" href=\"#3. 確認用ファイルに記載されている情報を帳票に記載\" data-position=\"1-1-3\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"3. 確認用ファイルに記載されている情報を帳票に記載\"> &gt; 3. 確認用ファイルに記載されている情報を帳票に記載</span></a>3. 確認用ファイルに記載されている情報を帳票に記載</h3>\n<p data-sourcepos=\"30:1-30:116\"><a href=\"https://docs.google.com/spreadsheets/d/1zqvdswahxbhO1Wzbjdu252MnLolHYsC3/edit#gid=491889594\" target=\"_blank\" rel=\"noopener noreferrer\">月会費請求帳票</a></p>\n<h4 data-sourcepos=\"32:1-32:84\">JACCS(Smaile Paymentと通常集金代行の合計)への請求金額を記載</h4>\n<p data-sourcepos=\"33:1-34:66\">YYYYMMDD_HHMMSS_jaccs(確認用).csv<br>\nのファイル末尾に以下のような記載があります。</p>\n<p data-sourcepos=\"36:1-38:134\">データ区分,請求件数,請求金額,振替済件数,振替済金額,振替不能件数,振替不能金額,ダミー<br>\n8, 008057(※1), 000092733394(※2), 000000, 000000000000, 000000, 000000000000,<br>\n(※1)が振替依頼の件数、(※2)が総額になるのでそれぞれ帳票のD列、E列に記載しておいてください。</p>\n<h4 data-sourcepos=\"40:1-40:53\">JACCS(Smaile Payment)への請求金額を記載</h4>\n<p data-sourcepos=\"41:1-43:77\">YYYYMMDD_HHMMSS_jaccs_for_smile_payment_collection.csv<br>\nCSVファイルのH列が請求金額になっています。<br>\n金額の合計と件数を帳票のH列、I列に記載してください。</p>\n<h4 data-sourcepos=\"45:1-45:57\">JACCS(通常集金代行)への請求金額を記載</h4>\n<p data-sourcepos=\"46:1-48:78\">YYYYMMDD_HHMMSS_jaccs_for_regular_collection.csv<br>\nCSVファイルのH列が請求金額になっています。<br>\n金額の合計と件数を帳票のL列、 M列に記載してください。</p>\n<h4 data-sourcepos=\"50:1-50:36\">SMBCへの請求金額を記載</h4>\n<p data-sourcepos=\"51:1-53:78\">YYYYMMDD_HHMMSS_smbc.csv<br>\nCSVファイルのC列が請求金額になっています。<br>\n金額の合計と件数を帳票のP列、 Q列に記載してください。</p>\n", "created_at"=>"2020-03-16T07:19:24+09:00", "message"=>"Update post.", "kind"=>"stock", "comments_count"=>0, "tasks_count"=>0, "done_tasks_count"=>0, "url"=>"https://2nd-community.esa.io/posts/118", "updated_at"=>"2023-01-16T10:20:45+09:00", "tags"=>[], "category"=>"システム本部/定例業務/会費請求", "revision_number"=>17, "created_by"=>{"myself"=>false, "name"=>"keisuke nakama", "screen_name"=>"keisuke_nakama", "icon"=>"https://img.esa.io/uploads/production/members/73528/icon/thumb_m_29a349f0f34eae1e491ad27b13529c97.jpeg"}, "updated_by"=>{"myself"=>true, "name"=>"吉田直人", "screen_name"=>"naoto_yoshida", "icon"=>"https://img.esa.io/uploads/production/users/105730/icon/thumb_m_7ed6de39594feb35d005206783298fdb.png"}, "stargazers_count"=>1, "watchers_count"=>3, "star"=>false, "watch"=>true, "sharing_urls"=>nil}, {"number"=>644, "name"=>"JACCS手続きのオンライン化タスクメモ", "full_name"=>"システム本部/開発/Mother/JACCS手続きのオンライン化タスクメモ", "wip"=>true, "body_md"=>"# JACCS手続きのオンライン化タスク\r\n## 概要\r\n中間さん大塚さんが以前テストまでしていたらしいオンライン手続きを\r\n入会自動化に組み込む\r\n\r\n## メモ\r\n### asis\r\nオンライン会員→用紙送ってる\r\n### tobe\r\nオンラインだけで済ましたい→途中まで開発していたが、JACCSの代位弁済（肩代わり）の契約が使えない（ダンス、バレエとか）などの問題があり頓挫\r\n\r\n→手数料が割に合わないし、JACCSの代位弁済（肩代わり）の契約が使えなくても良いのでは？ということで再度オンライン化する計画。\r\n\r\n### web entering既存処理\r\nredirect処理など外して確認。\r\nクレジット画面へ\r\nex. http://localhost:3010/web_entering/credit/1/138748\r\n<img width=\"1050\" alt=\"image.png (111.5 kB)\" src=\"https://img.esa.io/uploads/production/attachments/14521/2022/12/19/119434/69b6b101-a57d-4e8d-9588-23cbd5ac23e7.png\">\r\n\r\nクレジット決済は遷移先の画面が死んでいる\r\nhttps://payment-dev.2nd-community.com/payment/card/CardConfirmAction.php\r\n口座振替\r\nex. http://localhost:3010/web_entering/account_transfer/1/138748\r\n<img width=\"1049\" alt=\"image.png (83.5 kB)\" src=\"https://img.esa.io/uploads/production/attachments/14521/2022/12/19/119434/4b0fbb42-cfdb-49dd-a548-fccc1ef02f9c.png\">\r\n\r\n→本番環境だとhttps://bc-pay.jp/kfgw/F/wf01pc.htmlへ post requestする画面が出てくるぽい。\r\n\r\npayment server\r\nhttps://eysdevpro2.backlog.jp/git/FIRST/yubista_credit_card_payment/blob/master/payment/card/CardConfirmAction.php\r\n\r\n\r\n### その他関連ありそうな設定\r\n```ruby:mother_git_v2/mother/config/environments/production.rb\r\n# web_entring\r\n  config.payment_merchant_id = 'A100000000000001028553'\r\n  config.web_entering_domain = 'admission.2nd-community.com'\r\n  config.payment_server_url  = 'https://payment.2nd-community.com/payment/card/CardConfirmAction.php'\r\n  config.accont_transfer_url  = 'https://bc-pay.jp/kfgw/F/wf01pc.html' \r\n```\r\n\r\n## 参考\r\nhttps://docs.google.com/spreadsheets/d/1XTp8gggWoOR1bpEYiN-K2zhRhxfsURn3sDo93qPSEoM/edit#gid=1987082775\r\n\r\nhttps://docs.google.com/presentation/d/10ybgiWcpxkPJXvZ-UdAGqHsCKpWNSW_pQj--ggqtUE4/edit#slide=id.g8c1b6bff5e_0_62\r\n\r\nhttps://eysdevpro2.backlog.jp/alias/wiki/92152\r\n\r\nhttps://eysdevpro2.backlog.jp/view/FIRST-6677\r\n\r\nhttps://docs.google.com/presentation/d/1cdKfiRw29zFhQ8Rp4R8zrmIjAzo0e7BMFCJIzWFdBgc/edit#slide=id.p\r\n\r\nhttps://2nd-community.esa.io/posts/171\r\n\r\nhttps://2nd-community.esa.io/posts/434\r\n\r\nhttps://app.asana.com/0/0/1165239926404570/1170214353789920/f\r\n\r\nhttps://drive.google.com/drive/folders/1hiMVFmEsPCh9Zt3iY0Zi1m6fJiv6HeSk\r\n\r\n請求まわり業務フロー\r\nhttps://docs.google.com/presentation/d/1D6UjCjmyDTuLAGToxmsv1H8Ea2cky6z-Mb_oapv1ilY/edit#slide=id.p\r\n\r\n口座振替フロー\r\nhttps://docs.google.com/presentation/d/108q-K7Z5V84fzo0b0ugB3UUIyJfnsV-Wz2I7CEpNXfI/edit#slide=id.gb4a23f9fab_0_14", "body_html"=>"<h1 data-sourcepos=\"1:1-1:46\" id=\"1-0-0\" name=\"1-0-0\"><a class=\"anchor\" id=\"JACCS手続きのオンライン化タスク\" name=\"JACCS手続きのオンライン化タスク\" href=\"#JACCS手続きのオンライン化タスク\" data-position=\"1-0-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"JACCS手続きのオンライン化タスク\"> &gt; JACCS手続きのオンライン化タスク</span></a>JACCS手続きのオンライン化タスク</h1>\n<h2 data-sourcepos=\"2:1-2:9\" id=\"1-1-0\" name=\"1-1-0\"><a class=\"anchor\" id=\"概要\" name=\"概要\" href=\"#概要\" data-position=\"1-1-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"概要\"> &gt; 概要</span></a>概要</h2>\n<p data-sourcepos=\"3:1-4:30\">中間さん大塚さんが以前テストまでしていたらしいオンライン手続きを<br>\n入会自動化に組み込む</p>\n<h2 data-sourcepos=\"6:1-6:9\" id=\"1-2-0\" name=\"1-2-0\"><a class=\"anchor\" id=\"メモ\" name=\"メモ\" href=\"#メモ\" data-position=\"1-2-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"メモ\"> &gt; メモ</span></a>メモ</h2>\n<h3 data-sourcepos=\"7:1-7:8\" id=\"1-2-1\" name=\"1-2-1\"><a class=\"anchor\" id=\"asis\" name=\"asis\" href=\"#asis\" data-position=\"1-2-1\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"asis\"> &gt; asis</span></a>asis</h3>\n<p data-sourcepos=\"8:1-8:42\">オンライン会員→用紙送ってる</p>\n<h3 data-sourcepos=\"9:1-9:8\" id=\"1-2-2\" name=\"1-2-2\"><a class=\"anchor\" id=\"tobe\" name=\"tobe\" href=\"#tobe\" data-position=\"1-2-2\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"tobe\"> &gt; tobe</span></a>tobe</h3>\n<p data-sourcepos=\"10:1-10:203\">オンラインだけで済ましたい→途中まで開発していたが、JACCSの代位弁済（肩代わり）の契約が使えない（ダンス、バレエとか）などの問題があり頓挫</p>\n<p data-sourcepos=\"12:1-12:182\">→手数料が割に合わないし、JACCSの代位弁済（肩代わり）の契約が使えなくても良いのでは？ということで再度オンライン化する計画。</p>\n<h3 data-sourcepos=\"14:1-14:28\" id=\"1-2-3\" name=\"1-2-3\"><a class=\"anchor\" id=\"web entering既存処理\" name=\"web entering既存処理\" href=\"#web entering既存処理\" data-position=\"1-2-3\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"web entering既存処理\"> &gt; web entering既存処理</span></a>web entering既存処理</h3>\n<p data-sourcepos=\"15:1-18:166\">redirect処理など外して確認。<br>\nクレジット画面へ<br>\nex. <a href=\"http://localhost:3010/web_entering/credit/1/138748\" target=\"_blank\" rel=\"noopener noreferrer\">http://localhost:3010/web_entering/credit/1/138748</a><br>\n<a href=\"https://img.esa.io/uploads/production/attachments/14521/2022/12/19/119434/69b6b101-a57d-4e8d-9588-23cbd5ac23e7.png\" target=\"_blank\" rel=\"noopener noreferrer\"><img width=\"1050\" alt=\"image.png (111.5 kB)\" src=\"https://img.esa.io/uploads/production/attachments/14521/2022/12/19/119434/69b6b101-a57d-4e8d-9588-23cbd5ac23e7.png\"></a></p>\n<p data-sourcepos=\"20:1-24:165\">クレジット決済は遷移先の画面が死んでいる<br>\n<a href=\"https://payment-dev.2nd-community.com/payment/card/CardConfirmAction.php\" target=\"_blank\" rel=\"noopener noreferrer\">https://payment-dev.2nd-community.com/payment/card/CardConfirmAction.php</a><br>\n口座振替<br>\nex. <a href=\"http://localhost:3010/web_entering/account_transfer/1/138748\" target=\"_blank\" rel=\"noopener noreferrer\">http://localhost:3010/web_entering/account_transfer/1/138748</a><br>\n<a href=\"https://img.esa.io/uploads/production/attachments/14521/2022/12/19/119434/4b0fbb42-cfdb-49dd-a548-fccc1ef02f9c.png\" target=\"_blank\" rel=\"noopener noreferrer\"><img width=\"1049\" alt=\"image.png (83.5 kB)\" src=\"https://img.esa.io/uploads/production/attachments/14521/2022/12/19/119434/4b0fbb42-cfdb-49dd-a548-fccc1ef02f9c.png\"></a></p>\n<p data-sourcepos=\"26:1-26:109\">→本番環境だと<a href=\"https://bc-pay.jp/kfgw/F/wf01pc.html%E3%81%B8\" target=\"_blank\" rel=\"noopener noreferrer\">https://bc-pay.jp/kfgw/F/wf01pc.htmlへ</a> post requestする画面が出てくるぽい。</p>\n<p data-sourcepos=\"28:1-29:114\">payment server<br>\n<a href=\"https://eysdevpro2.backlog.jp/git/FIRST/yubista_credit_card_payment/blob/master/payment/card/CardConfirmAction.php\" target=\"_blank\" rel=\"noopener noreferrer\">https://eysdevpro2.backlog.jp/git/FIRST/yubista_credit_card_payment/blob/master/payment/card/CardConfirmAction.php</a></p>\n<h3 data-sourcepos=\"32:1-32:40\" id=\"1-2-4\" name=\"1-2-4\"><a class=\"anchor\" id=\"その他関連ありそうな設定\" name=\"その他関連ありそうな設定\" href=\"#その他関連ありそうな設定\" data-position=\"1-2-4\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"その他関連ありそうな設定\"> &gt; その他関連ありそうな設定</span></a>その他関連ありそうな設定</h3>\n<div class=\"code-block\" data-sourcepos=\"33:1-39:3\"><div class=\"code-filename\"><i class=\"fa fa-file-code-o\"></i>mother_git_v2/mother/config/environments/production.rb</div><div class=\"highlight\"><pre class=\"highlight ruby\"><code><span class=\"c1\"># web_entring</span>\n  <span class=\"n\">config</span><span class=\"p\">.</span><span class=\"nf\">payment_merchant_id</span> <span class=\"o\">=</span> <span class=\"s1\">'A100000000000001028553'</span>\n  <span class=\"n\">config</span><span class=\"p\">.</span><span class=\"nf\">web_entering_domain</span> <span class=\"o\">=</span> <span class=\"s1\">'admission.2nd-community.com'</span>\n  <span class=\"n\">config</span><span class=\"p\">.</span><span class=\"nf\">payment_server_url</span>  <span class=\"o\">=</span> <span class=\"s1\">'https://payment.2nd-community.com/payment/card/CardConfirmAction.php'</span>\n  <span class=\"n\">config</span><span class=\"p\">.</span><span class=\"nf\">accont_transfer_url</span>  <span class=\"o\">=</span> <span class=\"s1\">'https://bc-pay.jp/kfgw/F/wf01pc.html'</span> \n</code></pre></div></div>\n<h2 data-sourcepos=\"41:1-41:9\" id=\"1-3-0\" name=\"1-3-0\"><a class=\"anchor\" id=\"参考\" name=\"参考\" href=\"#参考\" data-position=\"1-3-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"参考\"> &gt; 参考</span></a>参考</h2>\n<p data-sourcepos=\"42:1-42:103\"><a href=\"https://docs.google.com/spreadsheets/d/1XTp8gggWoOR1bpEYiN-K2zhRhxfsURn3sDo93qPSEoM/edit#gid=1987082775\" target=\"_blank\" rel=\"noopener noreferrer\">https://docs.google.com/spreadsheets/d/1XTp8gggWoOR1bpEYiN-K2zhRhxfsURn3sDo93qPSEoM/edit#gid=1987082775</a></p>\n<p data-sourcepos=\"44:1-44:114\"><a href=\"https://docs.google.com/presentation/d/10ybgiWcpxkPJXvZ-UdAGqHsCKpWNSW_pQj--ggqtUE4/edit#slide=id.g8c1b6bff5e_0_62\" target=\"_blank\" rel=\"noopener noreferrer\">https://docs.google.com/presentation/d/10ybgiWcpxkPJXvZ-UdAGqHsCKpWNSW_pQj--ggqtUE4/edit#slide=id.g8c1b6bff5e_0_62</a></p>\n<p data-sourcepos=\"46:1-46:46\"><a href=\"https://eysdevpro2.backlog.jp/alias/wiki/92152\" target=\"_blank\" rel=\"noopener noreferrer\">https://eysdevpro2.backlog.jp/alias/wiki/92152</a></p>\n<p data-sourcepos=\"48:1-48:45\"><a href=\"https://eysdevpro2.backlog.jp/view/FIRST-6677\" target=\"_blank\" rel=\"noopener noreferrer\">https://eysdevpro2.backlog.jp/view/FIRST-6677</a></p>\n<p data-sourcepos=\"50:1-50:99\"><a href=\"https://docs.google.com/presentation/d/1cdKfiRw29zFhQ8Rp4R8zrmIjAzo0e7BMFCJIzWFdBgc/edit#slide=id.p\" target=\"_blank\" rel=\"noopener noreferrer\">https://docs.google.com/presentation/d/1cdKfiRw29zFhQ8Rp4R8zrmIjAzo0e7BMFCJIzWFdBgc/edit#slide=id.p</a></p>\n<p data-sourcepos=\"52:1-52:38\"><a href=\"https://2nd-community.esa.io/posts/171\">https://2nd-community.esa.io/posts/171</a></p>\n<p data-sourcepos=\"54:1-54:38\"><a href=\"https://2nd-community.esa.io/posts/434\">https://2nd-community.esa.io/posts/434</a></p>\n<p data-sourcepos=\"56:1-56:61\"><a href=\"https://app.asana.com/0/0/1165239926404570/1170214353789920/f\" target=\"_blank\" rel=\"noopener noreferrer\">https://app.asana.com/0/0/1165239926404570/1170214353789920/f</a></p>\n<p data-sourcepos=\"58:1-58:72\"><a href=\"https://drive.google.com/drive/folders/1hiMVFmEsPCh9Zt3iY0Zi1m6fJiv6HeSk\" target=\"_blank\" rel=\"noopener noreferrer\">https://drive.google.com/drive/folders/1hiMVFmEsPCh9Zt3iY0Zi1m6fJiv6HeSk</a></p>\n<p data-sourcepos=\"60:1-61:99\">請求まわり業務フロー<br>\n<a href=\"https://docs.google.com/presentation/d/1D6UjCjmyDTuLAGToxmsv1H8Ea2cky6z-Mb_oapv1ilY/edit#slide=id.p\" target=\"_blank\" rel=\"noopener noreferrer\">https://docs.google.com/presentation/d/1D6UjCjmyDTuLAGToxmsv1H8Ea2cky6z-Mb_oapv1ilY/edit#slide=id.p</a></p>\n<p data-sourcepos=\"63:1-64:114\">口座振替フロー<br>\n<a href=\"https://docs.google.com/presentation/d/108q-K7Z5V84fzo0b0ugB3UUIyJfnsV-Wz2I7CEpNXfI/edit#slide=id.gb4a23f9fab_0_14\" target=\"_blank\" rel=\"noopener noreferrer\">https://docs.google.com/presentation/d/108q-K7Z5V84fzo0b0ugB3UUIyJfnsV-Wz2I7CEpNXfI/edit#slide=id.gb4a23f9fab_0_14</a></p>\n", "created_at"=>"2022-12-06T15:23:14+09:00", "message"=>"Update post.", "kind"=>"stock", "comments_count"=>0, "tasks_count"=>0, "done_tasks_count"=>0, "url"=>"https://2nd-community.esa.io/posts/644", "updated_at"=>"2023-01-16T10:10:48+09:00", "tags"=>[], "category"=>"システム本部/開発/Mother", "revision_number"=>11, "created_by"=>{"myself"=>false, "name"=>"高田悦成", "screen_name"=>"essei_takada", "icon"=>"https://img.esa.io/uploads/production/users/119434/icon/thumb_m_75c84655889d80b06b27d9c1a43c631b.png"}, "updated_by"=>{"myself"=>false, "name"=>"高田悦成", "screen_name"=>"essei_takada", "icon"=>"https://img.esa.io/uploads/production/users/119434/icon/thumb_m_75c84655889d80b06b27d9c1a43c631b.png"}, "stargazers_count"=>0, "watchers_count"=>1, "star"=>false, "watch"=>false, "sharing_urls"=>nil}, {"number"=>552, "name"=>"会員統合の方法", "full_name"=>"システム本部/プロジェクト/会員統合/会員統合の方法", "wip"=>false, "body_md"=>"**方針を検討中なので、以下は暫定のやり方です。\r\n取り扱いに気をつけください。**\r\n\r\n# 概要\r\n\r\nMotherのrakeスクリプトで実施可能です。\r\n\r\n    \r\n    root@b2ea674e4310:/usr/src/app# bundle exec rake 'integrate_member_info:update_tables_have_member_id[181888 180243]'\r\n    実行パターンを入力してください\r\n    Y : データ更新して実行, d : データ更新せずドライランで実行 : d\r\n    executed_id : 134e08f94fec8a0cd94b3a81d32e1102\r\n    [OK]Changed member_simplified_contacts member_id from 181888 to 180243.(2 records)\r\n    [OK]Changed memship_fee_accounts_receivables member_id from 181888 to 180243.(1 records)\r\n    [OK]Changed memship_fee_sale_details member_id from 181888 to 180243.(6 records)\r\n    [OK]Changed memship_initial_fee_sales member_id from 181888 to 180243.(1 records)\r\n    [OK]Changed teacher_reward_registers member_id from 181888 to 180243.(1 records)\r\n    .....\r\n\r\n実施後はレポートをSlackの[#merged_member](https://eys-style.slack.com/archives/C03A45D5C1Y)チャンネルに通知します。\r\n<img width=\"867\" alt=\"image.png (234.6 kB)\" src=\"https://img.esa.io/uploads/production/attachments/14521/2022/04/07/74803/aef36583-a7dd-45e9-b7f2-c754197cf0d6.png\">\r\n\r\n# 手順\r\n\r\n## 接続DBの設定\r\n\r\ndatabase.ymlに接続DBの設定をします。\r\n\r\n- **!!!注意!!!**\r\n    - **本番DBに実施する場合は必ずステージング環境で動作確認を行ってください！**\r\n    - **docker-syncが起動しているか必ず確認してください、動いていないとdatabase.ymlがコンテナ内に反映されないので意図せぬDBに実行してしまう可能性があります！**\r\n    - (参考)macのコンテナ内のdatabase.ymlの内容確認コマンド\r\n    ```\r\n    docker-compose -f docker-compose.mac.yml run app cat config/database.yml \r\n    ```\r\n\r\n```yml:開発DBの例\r\ndevelopment:\r\n  adapter: postgresql\r\n  database: mother\r\n  host: mother-db-dev-4-cluster-cluster.cluster-czltbye18jrb.ap-northeast-1.rds.amazonaws.com # dev\r\n  username: prd_user\r\n  password: XXXXXXXXXXX\r\n  encoding: utf8\r\n\r\n```\r\n\r\n## 統合処理の実行方法\r\n\r\n`lib/tasks/integrate_member_info.rake`に実装している`update_tables_have_member_id`タスクで実行します。\r\n\r\nターミナルで以下コンテナ内に入りのコマンドを実行します。\r\n\r\n```sh\r\n# コンテナ起動\r\ndocker-compose -f docker-compose.mac.yml up -d\r\n\r\n# コンテナ内に入る\r\ndocker exec -it mother_app_1 bash\r\n\r\n# 統合元、統合先のmember_idを置き換えて実行します。\r\n# scr_member_id : 統合元member_id\r\n# desc_member_id : 統合先member_id\r\nbundle exec rake 'integrate_member_info:update_tables_have_member_id[scr_member_id desc_member_id]'\r\n\r\n# 実行例\r\n# 統合元member_id : 187867\r\n# 統合先member_id : 187752\r\nbundle exec rake 'integrate_member_info:update_tables_have_member_id[187867 187752]'\r\n```\r\n\r\n\r\n実行パターンを入力します。\r\n- データの更新を行わず更新するテーブルを把握したい場合は`d`を入力してドライランを実行してください\r\n- データの更新を行う場合は`Y`を入力してください。\r\n\r\n```\r\n実行パターンを入力してください\r\nY : データ更新して実行, d : データ更新せずドライランで実行 : \r\n```\r\n\r\n※補足： 本番は、.envの RAILS_ENVを productionにして実行する\r\n\r\nコードはこの辺の処理です。\r\n\r\n```ruby:lib/tasks/integrate_member_info.rake\r\n    begin\r\n      puts \"実行パターンを入力してください\"\r\n      print 'Y : データ更新して実行, d : データ更新せずドライランで実行 : '\r\n      input = STDIN.gets.chomp\r\n      if input.empty? || ['Y', 'd'].exclude?(input)\r\n        raise\r\n      end\r\n    rescue\r\n      puts 'Y, dを入力してください。'\r\n      retry\r\n    end\r\n\r\n```\r\n\r\n※Yの場合は念の為もう一度確認があります。\r\n\r\n```\r\n本当に更新しますか？\r\nY : データ更新して実行, n : やっぱりやめる : \r\n```\r\n\r\nコマンド実行後、片方のメンバーIDの状態が「無効データ」になっていることを確認する。\r\n<img width=\"469\" alt=\"image.png (31.2 kB)\" src=\"https://img.esa.io/uploads/production/attachments/14521/2023/01/11/128235/9ffeb3f1-aed9-4677-8a7b-76b79d4c5e23.png\">\r\n\r\n\r\n\r\nコードはこの辺の処理です。\r\n\r\n```ruby:lib/tasks/integrate_member_info.rake\r\n    begin\r\n      if input == 'Y'\r\n        puts \"本当に更新しますか？\"\r\n        print 'Y : データ更新して実行, n : やっぱりやめる : '\r\n        input = STDIN.gets.chomp\r\n        if input.empty? || ['Y', 'n'].exclude?(input)\r\n          raise\r\n        end\r\n      end\r\n    rescue\r\n      puts 'Y, nを入力してください。'\r\n      retry\r\n    end\r\n```\r\n\r\n一意のIDが発行されます。（あとでSlackで検索するのに使えます。）\r\n```\r\nexecuted_id : 6df31d63e4cdc2fa8c4b5c3b48533b30\r\n```\r\n\r\n統合対象のテーブルがログとして出力されます。（Slackに通知するため、詳細は後述します。）\r\n\r\n以下ログがでたら処理が終わると無事終了です。\r\n\r\n```\r\nfinished!! executed_id : 6df31d63e4cdc2fa8c4b5c3b48533b30\r\n```\r\n\r\n## Slackで実行結果を確認\r\nSlackの[#merged_member](https://eys-style.slack.com/archives/C03A45D5C1Y)というチャンネルに結果が通知されるようになっています。\r\n\r\n\r\n<img width=\"897\" alt=\"image.png (469.6 kB)\" src=\"https://img.esa.io/uploads/production/attachments/14521/2022/04/12/74803/472ebe23-7d8a-41ed-ba01-8830f21682b6.png\">\r\n\r\n※前述の`executed_id`で検索をかけるとすぐ見つかります。\r\n\r\n<img width=\"725\" alt=\"image.png (99.5 kB)\" src=\"https://img.esa.io/uploads/production/attachments/14521/2022/04/12/74803/9d4d505e-4842-4da2-80c4-31e13b7527eb.png\">\r\n\r\n<img width=\"614\" alt=\"image.png (118.8 kB)\" src=\"https://img.esa.io/uploads/production/attachments/14521/2022/04/12/74803/02344abe-3087-4110-9089-5f497a74fc96.png\">\r\n\r\n", "body_html"=>"<p data-sourcepos=\"1:1-2:44\"><strong>方針を検討中なので、以下は暫定のやり方です。<br>\n取り扱いに気をつけください。</strong></p>\n<h1 data-sourcepos=\"4:1-4:8\" id=\"1-0-0\" name=\"1-0-0\"><a class=\"anchor\" id=\"概要\" name=\"概要\" href=\"#概要\" data-position=\"1-0-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"概要\"> &gt; 概要</span></a>概要</h1>\n<p data-sourcepos=\"6:1-6:52\">Motherのrakeスクリプトで実施可能です。</p>\n<div class=\"code-block\" data-sourcepos=\"9:5-19:0\"><div class=\"highlight\"><pre class=\"highlight plaintext\"><code>root@b2ea674e4310:/usr/src/app# bundle exec rake 'integrate_member_info:update_tables_have_member_id[181888 180243]'\n実行パターンを入力してください\nY : データ更新して実行, d : データ更新せずドライランで実行 : d\nexecuted_id : 134e08f94fec8a0cd94b3a81d32e1102\n[OK]Changed member_simplified_contacts member_id from 181888 to 180243.(2 records)\n[OK]Changed memship_fee_accounts_receivables member_id from 181888 to 180243.(1 records)\n[OK]Changed memship_fee_sale_details member_id from 181888 to 180243.(6 records)\n[OK]Changed memship_initial_fee_sales member_id from 181888 to 180243.(1 records)\n[OK]Changed teacher_reward_registers member_id from 181888 to 180243.(1 records)\n.....\n</code></pre></div></div>\n<p data-sourcepos=\"20:1-21:164\">実施後はレポートをSlackの<a href=\"https://eys-style.slack.com/archives/C03A45D5C1Y\" target=\"_blank\" rel=\"noopener noreferrer\">#merged_member</a>チャンネルに通知します。<br>\n<a href=\"https://img.esa.io/uploads/production/attachments/14521/2022/04/07/74803/aef36583-a7dd-45e9-b7f2-c754197cf0d6.png\" target=\"_blank\" rel=\"noopener noreferrer\"><img width=\"867\" alt=\"image.png (234.6 kB)\" src=\"https://img.esa.io/uploads/production/attachments/14521/2022/04/07/74803/aef36583-a7dd-45e9-b7f2-c754197cf0d6.png\"></a></p>\n<h1 data-sourcepos=\"23:1-23:8\" id=\"2-0-0\" name=\"2-0-0\"><a class=\"anchor\" id=\"手順\" name=\"手順\" href=\"#手順\" data-position=\"2-0-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"手順\"> &gt; 手順</span></a>手順</h1>\n<h2 data-sourcepos=\"25:1-25:20\" id=\"2-1-0\" name=\"2-1-0\"><a class=\"anchor\" id=\"接続DBの設定\" name=\"接続DBの設定\" href=\"#接続DBの設定\" data-position=\"2-1-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"接続DBの設定\"> &gt; 接続DBの設定</span></a>接続DBの設定</h2>\n<p data-sourcepos=\"27:1-27:47\">database.ymlに接続DBの設定をします。</p>\n<ul data-sourcepos=\"29:1-36:0\">\n<li data-sourcepos=\"29:1-36:0\"><strong>!!!注意!!!</strong><ul data-sourcepos=\"30:5-32:77\">\n<li data-sourcepos=\"30:5-30:114\"><strong>本番DBに実施する場合は必ずステージング環境で動作確認を行ってください！</strong></li>\n<li data-sourcepos=\"31:5-31:221\"><strong>docker-syncが起動しているか必ず確認してください、動いていないとdatabase.ymlがコンテナ内に反映されないので意図せぬDBに実行してしまう可能性があります！</strong></li>\n<li data-sourcepos=\"32:5-32:77\">(参考)macのコンテナ内のdatabase.ymlの内容確認コマンド</li>\n</ul><div class=\"code-block\" data-sourcepos=\"33:5-35:7\"><div class=\"highlight\"><pre class=\"highlight plaintext\"><code>docker-compose -f docker-compose.mac.yml run app cat config/database.yml \n</code></pre></div></div></li>\n</ul>\n<div class=\"code-block\" data-sourcepos=\"37:1-46:3\"><div class=\"code-filename\"><i class=\"fa fa-file-code-o\"></i>開発DBの例</div><div class=\"highlight\"><pre class=\"highlight yaml\"><code><span class=\"na\">development</span><span class=\"pi\">:</span>\n  <span class=\"na\">adapter</span><span class=\"pi\">:</span> <span class=\"s\">postgresql</span>\n  <span class=\"na\">database</span><span class=\"pi\">:</span> <span class=\"s\">mother</span>\n  <span class=\"na\">host</span><span class=\"pi\">:</span> <span class=\"s\">mother-db-dev-4-cluster-cluster.cluster-czltbye18jrb.ap-northeast-1.rds.amazonaws.com</span> <span class=\"c1\"># dev</span>\n  <span class=\"na\">username</span><span class=\"pi\">:</span> <span class=\"s\">prd_user</span>\n  <span class=\"na\">password</span><span class=\"pi\">:</span> <span class=\"s\">XXXXXXXXXXX</span>\n  <span class=\"na\">encoding</span><span class=\"pi\">:</span> <span class=\"s\">utf8</span>\n</code></pre></div></div>\n<h2 data-sourcepos=\"48:1-48:30\" id=\"2-2-0\" name=\"2-2-0\"><a class=\"anchor\" id=\"統合処理の実行方法\" name=\"統合処理の実行方法\" href=\"#統合処理の実行方法\" data-position=\"2-2-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"統合処理の実行方法\"> &gt; 統合処理の実行方法</span></a>統合処理の実行方法</h2>\n<p data-sourcepos=\"50:1-50:119\"><code>lib/tasks/integrate_member_info.rake</code>に実装している<code>update_tables_have_member_id</code>タスクで実行します。</p>\n<p data-sourcepos=\"52:1-52:84\">ターミナルで以下コンテナ内に入りのコマンドを実行します。</p>\n<div class=\"code-block\" data-sourcepos=\"54:1-70:3\"><div class=\"code-filename\"><i class=\"fa fa-file-code-o\"></i>sh</div><div class=\"highlight\"><pre class=\"highlight shell\"><code><span class=\"c\"># コンテナ起動</span>\ndocker-compose <span class=\"nt\">-f</span> docker-compose.mac.yml up <span class=\"nt\">-d</span>\n\n<span class=\"c\"># コンテナ内に入る</span>\ndocker <span class=\"nb\">exec</span> <span class=\"nt\">-it</span> mother_app_1 bash\n\n<span class=\"c\"># 統合元、統合先のmember_idを置き換えて実行します。</span>\n<span class=\"c\"># scr_member_id : 統合元member_id</span>\n<span class=\"c\"># desc_member_id : 統合先member_id</span>\nbundle <span class=\"nb\">exec </span>rake <span class=\"s1\">'integrate_member_info:update_tables_have_member_id[scr_member_id desc_member_id]'</span>\n\n<span class=\"c\"># 実行例</span>\n<span class=\"c\"># 統合元member_id : 187867</span>\n<span class=\"c\"># 統合先member_id : 187752</span>\nbundle <span class=\"nb\">exec </span>rake <span class=\"s1\">'integrate_member_info:update_tables_have_member_id[187867 187752]'</span>\n</code></pre></div></div>\n<p data-sourcepos=\"73:1-73:39\">実行パターンを入力します。</p>\n<ul data-sourcepos=\"74:1-76:0\">\n<li data-sourcepos=\"74:1-74:143\">データの更新を行わず更新するテーブルを把握したい場合は<code>d</code>を入力してドライランを実行してください</li>\n<li data-sourcepos=\"75:1-76:0\">データの更新を行う場合は<code>Y</code>を入力してください。</li>\n</ul>\n<div class=\"code-block\" data-sourcepos=\"77:1-80:3\"><div class=\"highlight\"><pre class=\"highlight plaintext\"><code>実行パターンを入力してください\nY : データ更新して実行, d : データ更新せずドライランで実行 : \n</code></pre></div></div>\n<p data-sourcepos=\"82:1-82:77\">※補足： 本番は、.envの RAILS_ENVを productionにして実行する</p>\n<p data-sourcepos=\"84:1-84:39\">コードはこの辺の処理です。</p>\n<div class=\"code-block\" data-sourcepos=\"86:1-99:3\"><div class=\"code-filename\"><i class=\"fa fa-file-code-o\"></i>lib/tasks/integrate_member_info.rake</div><div class=\"highlight\"><pre class=\"highlight ruby\"><code>    <span class=\"k\">begin</span>\n      <span class=\"nb\">puts</span> <span class=\"s2\">\"実行パターンを入力してください\"</span>\n      <span class=\"nb\">print</span> <span class=\"s1\">'Y : データ更新して実行, d : データ更新せずドライランで実行 : '</span>\n      <span class=\"n\">input</span> <span class=\"o\">=</span> <span class=\"no\">STDIN</span><span class=\"p\">.</span><span class=\"nf\">gets</span><span class=\"p\">.</span><span class=\"nf\">chomp</span>\n      <span class=\"k\">if</span> <span class=\"n\">input</span><span class=\"p\">.</span><span class=\"nf\">empty?</span> <span class=\"o\">||</span> <span class=\"p\">[</span><span class=\"s1\">'Y'</span><span class=\"p\">,</span> <span class=\"s1\">'d'</span><span class=\"p\">].</span><span class=\"nf\">exclude?</span><span class=\"p\">(</span><span class=\"n\">input</span><span class=\"p\">)</span>\n        <span class=\"k\">raise</span>\n      <span class=\"k\">end</span>\n    <span class=\"k\">rescue</span>\n      <span class=\"nb\">puts</span> <span class=\"s1\">'Y, dを入力してください。'</span>\n      <span class=\"k\">retry</span>\n    <span class=\"k\">end</span>\n</code></pre></div></div>\n<p data-sourcepos=\"101:1-101:61\">※Yの場合は念の為もう一度確認があります。</p>\n<div class=\"code-block\" data-sourcepos=\"103:1-106:3\"><div class=\"highlight\"><pre class=\"highlight plaintext\"><code>本当に更新しますか？\nY : データ更新して実行, n : やっぱりやめる : \n</code></pre></div></div>\n<p data-sourcepos=\"108:1-109:164\">コマンド実行後、片方のメンバーIDの状態が「無効データ」になっていることを確認する。<br>\n<a href=\"https://img.esa.io/uploads/production/attachments/14521/2023/01/11/128235/9ffeb3f1-aed9-4677-8a7b-76b79d4c5e23.png\" target=\"_blank\" rel=\"noopener noreferrer\"><img width=\"469\" alt=\"image.png (31.2 kB)\" src=\"https://img.esa.io/uploads/production/attachments/14521/2023/01/11/128235/9ffeb3f1-aed9-4677-8a7b-76b79d4c5e23.png\"></a></p>\n<p data-sourcepos=\"113:1-113:39\">コードはこの辺の処理です。</p>\n<div class=\"code-block\" data-sourcepos=\"115:1-129:3\"><div class=\"code-filename\"><i class=\"fa fa-file-code-o\"></i>lib/tasks/integrate_member_info.rake</div><div class=\"highlight\"><pre class=\"highlight ruby\"><code>    <span class=\"k\">begin</span>\n      <span class=\"k\">if</span> <span class=\"n\">input</span> <span class=\"o\">==</span> <span class=\"s1\">'Y'</span>\n        <span class=\"nb\">puts</span> <span class=\"s2\">\"本当に更新しますか？\"</span>\n        <span class=\"nb\">print</span> <span class=\"s1\">'Y : データ更新して実行, n : やっぱりやめる : '</span>\n        <span class=\"n\">input</span> <span class=\"o\">=</span> <span class=\"no\">STDIN</span><span class=\"p\">.</span><span class=\"nf\">gets</span><span class=\"p\">.</span><span class=\"nf\">chomp</span>\n        <span class=\"k\">if</span> <span class=\"n\">input</span><span class=\"p\">.</span><span class=\"nf\">empty?</span> <span class=\"o\">||</span> <span class=\"p\">[</span><span class=\"s1\">'Y'</span><span class=\"p\">,</span> <span class=\"s1\">'n'</span><span class=\"p\">].</span><span class=\"nf\">exclude?</span><span class=\"p\">(</span><span class=\"n\">input</span><span class=\"p\">)</span>\n          <span class=\"k\">raise</span>\n        <span class=\"k\">end</span>\n      <span class=\"k\">end</span>\n    <span class=\"k\">rescue</span>\n      <span class=\"nb\">puts</span> <span class=\"s1\">'Y, nを入力してください。'</span>\n      <span class=\"k\">retry</span>\n    <span class=\"k\">end</span>\n</code></pre></div></div>\n<p data-sourcepos=\"131:1-131:91\">一意のIDが発行されます。（あとでSlackで検索するのに使えます。）</p>\n<div class=\"code-block\" data-sourcepos=\"132:1-134:3\"><div class=\"highlight\"><pre class=\"highlight plaintext\"><code>executed_id : 6df31d63e4cdc2fa8c4b5c3b48533b30\n</code></pre></div></div>\n<p data-sourcepos=\"136:1-136:128\">統合対象のテーブルがログとして出力されます。（Slackに通知するため、詳細は後述します。）</p>\n<p data-sourcepos=\"138:1-138:66\">以下ログがでたら処理が終わると無事終了です。</p>\n<div class=\"code-block\" data-sourcepos=\"140:1-142:3\"><div class=\"highlight\"><pre class=\"highlight plaintext\"><code>finished!! executed_id : 6df31d63e4cdc2fa8c4b5c3b48533b30\n</code></pre></div></div>\n<h2 data-sourcepos=\"144:1-144:32\" id=\"2-3-0\" name=\"2-3-0\"><a class=\"anchor\" id=\"Slackで実行結果を確認\" name=\"Slackで実行結果を確認\" href=\"#Slackで実行結果を確認\" data-position=\"2-3-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"Slackで実行結果を確認\"> &gt; Slackで実行結果を確認</span></a>Slackで実行結果を確認</h2>\n<p data-sourcepos=\"145:1-145:155\">Slackの<a href=\"https://eys-style.slack.com/archives/C03A45D5C1Y\" target=\"_blank\" rel=\"noopener noreferrer\">#merged_member</a>というチャンネルに結果が通知されるようになっています。</p>\n<a href=\"https://img.esa.io/uploads/production/attachments/14521/2022/04/12/74803/472ebe23-7d8a-41ed-ba01-8830f21682b6.png\" target=\"_blank\" rel=\"noopener noreferrer\"><img width=\"897\" alt=\"image.png (469.6 kB)\" src=\"https://img.esa.io/uploads/production/attachments/14521/2022/04/12/74803/472ebe23-7d8a-41ed-ba01-8830f21682b6.png\"></a>\n<p data-sourcepos=\"150:1-150:76\">※前述の<code>executed_id</code>で検索をかけるとすぐ見つかります。</p>\n<a href=\"https://img.esa.io/uploads/production/attachments/14521/2022/04/12/74803/9d4d505e-4842-4da2-80c4-31e13b7527eb.png\" target=\"_blank\" rel=\"noopener noreferrer\"><img width=\"725\" alt=\"image.png (99.5 kB)\" src=\"https://img.esa.io/uploads/production/attachments/14521/2022/04/12/74803/9d4d505e-4842-4da2-80c4-31e13b7527eb.png\"></a>\n<a href=\"https://img.esa.io/uploads/production/attachments/14521/2022/04/12/74803/02344abe-3087-4110-9089-5f497a74fc96.png\" target=\"_blank\" rel=\"noopener noreferrer\"><img width=\"614\" alt=\"image.png (118.8 kB)\" src=\"https://img.esa.io/uploads/production/attachments/14521/2022/04/12/74803/02344abe-3087-4110-9089-5f497a74fc96.png\"></a>\n", "created_at"=>"2022-04-07T13:33:37+09:00", "message"=>"Update post.", "kind"=>"stock", "comments_count"=>0, "tasks_count"=>0, "done_tasks_count"=>0, "url"=>"https://2nd-community.esa.io/posts/552", "updated_at"=>"2023-01-11T14:38:22+09:00", "tags"=>[], "category"=>"システム本部/プロジェクト/会員統合", "revision_number"=>22, "created_by"=>{"myself"=>false, "name"=>"keisuke nakama", "screen_name"=>"keisuke_nakama", "icon"=>"https://img.esa.io/uploads/production/members/73528/icon/thumb_m_29a349f0f34eae1e491ad27b13529c97.jpeg"}, "updated_by"=>{"myself"=>false, "name"=>"石田裕三", "screen_name"=>"yuzo_ishida", "icon"=>"https://img.esa.io/uploads/production/users/128235/icon/thumb_m_666eede25b43a9ff04d9783c9ada7b11.png"}, "stargazers_count"=>1, "watchers_count"=>2, "star"=>false, "watch"=>false, "sharing_urls"=>nil}, {"number"=>650, "name"=>"週次反省会 12月27日", "full_name"=>"システム本部/チーム/スクラム/週次反省会 12月27日", "wip"=>false, "body_md"=>"## Keep (スプリントでうまくいったので、今後も続けたいことは何か？)\r\n- (下垣)\r\n- (吉田)\r\n- (石田)\r\n- (高田)\r\n\r\n## Problem (スプリントでうまくいかなかったので、今後は中止したいことは何か？)\r\n- レビューに時間が取られすぎている。もう少し短縮したい(下垣)\r\n- (吉田)\r\n- EC2停止を掛けていったが、本番に影響がある点の洗い出しができていなかった。(石田)\r\n- 動作確認もれが多かった(高田)\r\n\r\n## Try ( これからやったほうがよいこと、改善したほうがよいことは何か？)\r\n- (下垣)\r\n- redashの乱用は避けた方がいい。要件が変わらないようなものならシステムに実装。(吉田)\r\n- (石田)\r\n- (高田)\r\n\r\n## その他(何かあれば)\r\n年40回クラスの入会機能をリリースした。（下垣）\r\n\r\nチケットの使用履歴をSCで確認出来た方がいい、という大澤さんの要望。\r\nmotherの不具合を減らせという大澤さんからの命令がありました。\r\n\r\n＜決定事項＞\r\n・チケット不具合の確立した確認方法 → from 高田さん to 石田に 手順連携\r\n・「リリース完了」ステータスのタスク →  集計省く事にする\r\n", "body_html"=>"<h2 data-sourcepos=\"1:1-1:94\" id=\"0-1-0\" name=\"0-1-0\"><a class=\"anchor\" id=\"Keep (スプリントでうまくいったので、今後も続けたいことは何か？)\" name=\"Keep (スプリントでうまくいったので、今後も続けたいことは何か？)\" href=\"#Keep (スプリントでうまくいったので、今後も続けたいことは何か？)\" data-position=\"0-1-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"Keep (スプリントでうまくいったので、今後も続けたいことは何か？)\"> &gt; Keep (スプリントでうまくいったので、今後も続けたいことは何か？)</span></a>Keep (スプリントでうまくいったので、今後も続けたいことは何か？)</h2>\n<ul data-sourcepos=\"2:1-6:0\">\n<li data-sourcepos=\"2:1-2:10\">(下垣)</li>\n<li data-sourcepos=\"3:1-3:10\">(吉田)</li>\n<li data-sourcepos=\"4:1-4:10\">(石田)</li>\n<li data-sourcepos=\"5:1-6:0\">(高田)</li>\n</ul>\n<h2 data-sourcepos=\"7:1-7:109\" id=\"0-2-0\" name=\"0-2-0\"><a class=\"anchor\" id=\"Problem (スプリントでうまくいかなかったので、今後は中止したいことは何か？)\" name=\"Problem (スプリントでうまくいかなかったので、今後は中止したいことは何か？)\" href=\"#Problem (スプリントでうまくいかなかったので、今後は中止したいことは何か？)\" data-position=\"0-2-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"Problem (スプリントでうまくいかなかったので、今後は中止したいことは何か？)\"> &gt; Problem (スプリントでうまくいかなかったので、今後は中止したいことは何か？)</span></a>Problem (スプリントでうまくいかなかったので、今後は中止したいことは何か？)</h2>\n<ul data-sourcepos=\"8:1-12:0\">\n<li data-sourcepos=\"8:1-8:88\">レビューに時間が取られすぎている。もう少し短縮したい(下垣)</li>\n<li data-sourcepos=\"9:1-9:10\">(吉田)</li>\n<li data-sourcepos=\"10:1-10:118\">EC2停止を掛けていったが、本番に影響がある点の洗い出しができていなかった。(石田)</li>\n<li data-sourcepos=\"11:1-12:0\">動作確認もれが多かった(高田)</li>\n</ul>\n<h2 data-sourcepos=\"13:1-13:100\" id=\"0-3-0\" name=\"0-3-0\"><a class=\"anchor\" id=\"Try ( これからやったほうがよいこと、改善したほうがよいことは何か？)\" name=\"Try ( これからやったほうがよいこと、改善したほうがよいことは何か？)\" href=\"#Try ( これからやったほうがよいこと、改善したほうがよいことは何か？)\" data-position=\"0-3-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"Try ( これからやったほうがよいこと、改善したほうがよいことは何か？)\"> &gt; Try ( これからやったほうがよいこと、改善したほうがよいことは何か？)</span></a>Try ( これからやったほうがよいこと、改善したほうがよいことは何か？)</h2>\n<ul data-sourcepos=\"14:1-18:0\">\n<li data-sourcepos=\"14:1-14:10\">(下垣)</li>\n<li data-sourcepos=\"15:1-15:121\">redashの乱用は避けた方がいい。要件が変わらないようなものならシステムに実装。(吉田)</li>\n<li data-sourcepos=\"16:1-16:10\">(石田)</li>\n<li data-sourcepos=\"17:1-18:0\">(高田)</li>\n</ul>\n<h2 data-sourcepos=\"19:1-19:29\" id=\"0-4-0\" name=\"0-4-0\"><a class=\"anchor\" id=\"その他(何かあれば)\" name=\"その他(何かあれば)\" href=\"#その他(何かあれば)\" data-position=\"0-4-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"その他(何かあれば)\"> &gt; その他(何かあれば)</span></a>その他(何かあれば)</h2>\n<p data-sourcepos=\"20:1-20:68\">年40回クラスの入会機能をリリースした。（下垣）</p>\n<p data-sourcepos=\"22:1-23:87\">チケットの使用履歴をSCで確認出来た方がいい、という大澤さんの要望。<br>\nmotherの不具合を減らせという大澤さんからの命令がありました。</p>\n<p data-sourcepos=\"25:1-27:84\">＜決定事項＞<br>\n・チケット不具合の確立した確認方法 → from 高田さん to 石田に 手順連携<br>\n・「リリース完了」ステータスのタスク →  集計省く事にする</p>\n", "created_at"=>"2022-12-27T12:39:39+09:00", "message"=>"Update post.", "kind"=>"stock", "comments_count"=>0, "tasks_count"=>0, "done_tasks_count"=>0, "url"=>"https://2nd-community.esa.io/posts/650", "updated_at"=>"2022-12-27T19:56:16+09:00", "tags"=>[], "category"=>"システム本部/チーム/スクラム", "revision_number"=>11, "created_by"=>{"myself"=>true, "name"=>"吉田直人", "screen_name"=>"naoto_yoshida", "icon"=>"https://img.esa.io/uploads/production/users/105730/icon/thumb_m_7ed6de39594feb35d005206783298fdb.png"}, "updated_by"=>{"myself"=>false, "name"=>"石田裕三", "screen_name"=>"yuzo_ishida", "icon"=>"https://img.esa.io/uploads/production/users/128235/icon/thumb_m_666eede25b43a9ff04d9783c9ada7b11.png"}, "stargazers_count"=>0, "watchers_count"=>3, "star"=>false, "watch"=>true, "sharing_urls"=>nil}, {"number"=>649, "name"=>"週次反省会 12月20日", "full_name"=>"システム本部/チーム/スクラム/週次反省会 12月20日", "wip"=>false, "body_md"=>"## Keep (スプリントでうまくいったので、今後も続けたいことは何か？)\r\n- (下垣)\r\n- (吉田)\r\n- カジュアル面談同席させてもらい大変参考になった。(石田)\r\n- (高田)\r\n\r\n## Problem (スプリントでうまくいかなかったので、今後は中止したいことは何か？)\r\n- (下垣)\r\n- 北川さんから電話がめちゃくちゃかかってくるので何とかしたい。(吉田)\r\n電話だと記録に残らないのでタスクを立てるように言う。\r\n- HTTPS通信化で請求締めバッチのTimeout発生(石田)\r\n- Asanaが重すぎる(高田)\r\n\r\n## Try ( これからやったほうがよいこと、改善したほうがよいことは何か？)\r\n- (下垣)\r\n- インストラクター基本情報画面が想定以上に難解なシステムだった。今後も適宜要件の確認が必要。(吉田)\r\n- motherネットワーク構成見直しが必要 (石田)\r\n- チケット関連の不具合対応(高田)\r\n\r\n## その他(何かあれば)\r\n\r\n\r\nAsanaタスクの確認\r\nhttps://docs.google.com/spreadsheets/d/18BDn7TDMMcGvycONoDzDLdciEa4tJ0l4IWdzlTWkEK8/edit#gid=81654243\r\n", "body_html"=>"<h2 data-sourcepos=\"1:1-1:94\" id=\"0-1-0\" name=\"0-1-0\"><a class=\"anchor\" id=\"Keep (スプリントでうまくいったので、今後も続けたいことは何か？)\" name=\"Keep (スプリントでうまくいったので、今後も続けたいことは何か？)\" href=\"#Keep (スプリントでうまくいったので、今後も続けたいことは何か？)\" data-position=\"0-1-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"Keep (スプリントでうまくいったので、今後も続けたいことは何か？)\"> &gt; Keep (スプリントでうまくいったので、今後も続けたいことは何か？)</span></a>Keep (スプリントでうまくいったので、今後も続けたいことは何か？)</h2>\n<ul data-sourcepos=\"2:1-6:0\">\n<li data-sourcepos=\"2:1-2:10\">(下垣)</li>\n<li data-sourcepos=\"3:1-3:10\">(吉田)</li>\n<li data-sourcepos=\"4:1-4:82\">カジュアル面談同席させてもらい大変参考になった。(石田)</li>\n<li data-sourcepos=\"5:1-6:0\">(高田)</li>\n</ul>\n<h2 data-sourcepos=\"7:1-7:109\" id=\"0-2-0\" name=\"0-2-0\"><a class=\"anchor\" id=\"Problem (スプリントでうまくいかなかったので、今後は中止したいことは何か？)\" name=\"Problem (スプリントでうまくいかなかったので、今後は中止したいことは何か？)\" href=\"#Problem (スプリントでうまくいかなかったので、今後は中止したいことは何か？)\" data-position=\"0-2-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"Problem (スプリントでうまくいかなかったので、今後は中止したいことは何か？)\"> &gt; Problem (スプリントでうまくいかなかったので、今後は中止したいことは何か？)</span></a>Problem (スプリントでうまくいかなかったので、今後は中止したいことは何か？)</h2>\n<ul data-sourcepos=\"8:1-13:0\">\n<li data-sourcepos=\"8:1-8:10\">(下垣)</li>\n<li data-sourcepos=\"9:1-10:78\">北川さんから電話がめちゃくちゃかかってくるので何とかしたい。(吉田)<br>\n電話だと記録に残らないのでタスクを立てるように言う。</li>\n<li data-sourcepos=\"11:1-11:64\">HTTPS通信化で請求締めバッチのTimeout発生(石田)</li>\n<li data-sourcepos=\"12:1-13:0\">Asanaが重すぎる(高田)</li>\n</ul>\n<h2 data-sourcepos=\"14:1-14:100\" id=\"0-3-0\" name=\"0-3-0\"><a class=\"anchor\" id=\"Try ( これからやったほうがよいこと、改善したほうがよいことは何か？)\" name=\"Try ( これからやったほうがよいこと、改善したほうがよいことは何か？)\" href=\"#Try ( これからやったほうがよいこと、改善したほうがよいことは何か？)\" data-position=\"0-3-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"Try ( これからやったほうがよいこと、改善したほうがよいことは何か？)\"> &gt; Try ( これからやったほうがよいこと、改善したほうがよいことは何か？)</span></a>Try ( これからやったほうがよいこと、改善したほうがよいことは何か？)</h2>\n<ul data-sourcepos=\"15:1-19:0\">\n<li data-sourcepos=\"15:1-15:10\">(下垣)</li>\n<li data-sourcepos=\"16:1-16:145\">インストラクター基本情報画面が想定以上に難解なシステムだった。今後も適宜要件の確認が必要。(吉田)</li>\n<li data-sourcepos=\"17:1-17:59\">motherネットワーク構成見直しが必要 (石田)</li>\n<li data-sourcepos=\"18:1-19:0\">チケット関連の不具合対応(高田)</li>\n</ul>\n<h2 data-sourcepos=\"20:1-20:29\" id=\"0-4-0\" name=\"0-4-0\"><a class=\"anchor\" id=\"その他(何かあれば)\" name=\"その他(何かあれば)\" href=\"#その他(何かあれば)\" data-position=\"0-4-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"その他(何かあれば)\"> &gt; その他(何かあれば)</span></a>その他(何かあれば)</h2>\n<p data-sourcepos=\"23:1-24:101\">Asanaタスクの確認<br>\n<a href=\"https://docs.google.com/spreadsheets/d/18BDn7TDMMcGvycONoDzDLdciEa4tJ0l4IWdzlTWkEK8/edit#gid=81654243\" target=\"_blank\" rel=\"noopener noreferrer\">https://docs.google.com/spreadsheets/d/18BDn7TDMMcGvycONoDzDLdciEa4tJ0l4IWdzlTWkEK8/edit#gid=81654243</a></p>\n", "created_at"=>"2022-12-20T11:15:44+09:00", "message"=>"Update post.", "kind"=>"stock", "comments_count"=>0, "tasks_count"=>0, "done_tasks_count"=>0, "url"=>"https://2nd-community.esa.io/posts/649", "updated_at"=>"2022-12-20T16:49:45+09:00", "tags"=>[], "category"=>"システム本部/チーム/スクラム", "revision_number"=>8, "created_by"=>{"myself"=>true, "name"=>"吉田直人", "screen_name"=>"naoto_yoshida", "icon"=>"https://img.esa.io/uploads/production/users/105730/icon/thumb_m_7ed6de39594feb35d005206783298fdb.png"}, "updated_by"=>{"myself"=>true, "name"=>"吉田直人", "screen_name"=>"naoto_yoshida", "icon"=>"https://img.esa.io/uploads/production/users/105730/icon/thumb_m_7ed6de39594feb35d005206783298fdb.png"}, "stargazers_count"=>0, "watchers_count"=>3, "star"=>false, "watch"=>true, "sharing_urls"=>nil}, {"number"=>648, "name"=>"メンテナンス画面表示", "full_name"=>"システム本部/インフラ/手順書/メンテナンス画面表示", "wip"=>true, "body_md"=>"# mother\r\nmother-lb\r\n\r\nリスナールールの先頭に以下を追加。(443)\r\nホストがmother.2nd-community.com → メンテナンスページ表示\r\n\r\n# art-lesson(SC, SQSQ)\r\nmother-dev\r\n\r\nホストが art-lesson.2nd-community.com\r\nかつ\r\nパスが\r\napi/*追加　→申込やcronで叩かれる\r\npre_entry*追加　→申込フォーム\r\n_nuxt*追加　→inspiartの一部でエラー出てたので追加したけどいらないかも", "body_html"=>"<h1 data-sourcepos=\"1:1-1:8\" id=\"1-0-0\" name=\"1-0-0\"><a class=\"anchor\" id=\"mother\" name=\"mother\" href=\"#mother\" data-position=\"1-0-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"mother\"> &gt; mother</span></a>mother</h1>\n<p data-sourcepos=\"2:1-2:9\">mother-lb</p>\n<p data-sourcepos=\"4:1-5:74\">リスナールールの先頭に以下を追加。(443)<br>\nホストがmother.2nd-community.com → メンテナンスページ表示</p>\n<h1 data-sourcepos=\"7:1-7:22\" id=\"2-0-0\" name=\"2-0-0\"><a class=\"anchor\" id=\"art-lesson(SC, SQSQ)\" name=\"art-lesson(SC, SQSQ)\" href=\"#art-lesson(SC, SQSQ)\" data-position=\"2-0-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"art-lesson(SC, SQSQ)\"> &gt; art-lesson(SC, SQSQ)</span></a>art-lesson(SC, SQSQ)</h1>\n<p data-sourcepos=\"8:1-8:10\">mother-dev</p>\n<p data-sourcepos=\"10:1-15:98\">ホストが art-lesson.2nd-community.com<br>\nかつ<br>\nパスが<br>\napi/<em>追加　→申込やcronで叩かれる<br>\npre_entry</em>追加　→申込フォーム<br>\n_nuxt*追加　→inspiartの一部でエラー出てたので追加したけどいらないかも</p>\n", "created_at"=>"2022-12-14T18:45:10+09:00", "message"=>"Create post.", "kind"=>"stock", "comments_count"=>0, "tasks_count"=>0, "done_tasks_count"=>0, "url"=>"https://2nd-community.esa.io/posts/648", "updated_at"=>"2022-12-14T18:45:10+09:00", "tags"=>[], "category"=>"システム本部/インフラ/手順書", "revision_number"=>1, "created_by"=>{"myself"=>false, "name"=>"高田悦成", "screen_name"=>"essei_takada", "icon"=>"https://img.esa.io/uploads/production/users/119434/icon/thumb_m_75c84655889d80b06b27d9c1a43c631b.png"}, "updated_by"=>{"myself"=>false, "name"=>"高田悦成", "screen_name"=>"essei_takada", "icon"=>"https://img.esa.io/uploads/production/users/119434/icon/thumb_m_75c84655889d80b06b27d9c1a43c631b.png"}, "stargazers_count"=>0, "watchers_count"=>1, "star"=>false, "watch"=>false, "sharing_urls"=>nil}, {"number"=>627, "name"=>"SIP_registerer.sh利用方法", "full_name"=>"システム本部/インフラ/SIP_registerer.sh利用方法", "wip"=>false, "body_md"=>"# 前提\r\n\r\n# アカウント作成手順（インフラ担当）\r\n本項はインフラ担当にて必要な作業です。\r\n\r\n### AWS Cognitoユーザーの作成\r\nマネジメントコンソール「AWS Cognito 」の画面で、「developers」を選択\r\n<img width=\"954\" alt=\"image.png (57.1 kB)\" src=\"https://img.esa.io/uploads/production/attachments/14521/2022/11/07/128235/ff44bfab-9763-4dd9-86e4-b269db4149ce.png\">\r\n\r\n\r\n<img width=\"613\" alt=\"image.png (27.7 kB)\" src=\"https://img.esa.io/uploads/production/attachments/14521/2022/11/07/128235/57844dcf-45bc-40c9-90fb-4a33fe738fea.png\">\r\n\r\n「Create user」クリック\r\n\r\n<img width=\"733\" alt=\"image.png (93.5 kB)\" src=\"https://img.esa.io/uploads/production/attachments/14521/2022/11/07/128235/46e55b54-8007-495b-9254-4b217aa1f2bc.png\">\r\n\r\n\r\n<img width=\"801\" alt=\"image.png (100.6 kB)\" src=\"https://img.esa.io/uploads/production/attachments/14521/2022/11/10/128235/f40fc80e-24e1-442f-aad4-ca5ce9bb2067.png\">\r\n\r\n上記操作をCLIでやる場合\r\n※1行目の変数email_addr に設定したいメールアドレスを指定する\r\n```\r\nexport email_addr=test003@testmail.com\r\n\r\naws cognito-idp admin-create-user \\\r\n  --user-pool-id \"ap-northeast-1_GkxLTZSXe\" \\\r\n  --username \"$email_addr\" \\\r\n  --user-attributes Name=email,Value=\"$email_addr\" Name=email_verified,Value=true \\\r\n  --temporary-password Passw0rd\r\n\r\n```\r\n\r\n\r\n\r\n利用者（ユーザー）にパスワード初期化をしてもらう\r\n\r\nステータスが「Confirmed」に変化する\r\n<img width=\"832\" alt=\"image.png (11.2 kB)\" src=\"https://img.esa.io/uploads/production/attachments/14521/2022/11/10/128235/824e72e2-0a86-4692-ab97-dbe84ad912fa.png\">\r\n\r\n<BR>\r\n\r\n### 利用者（ユーザー）にSource IPの登録を行ってもらう\r\n\r\n\r\n\r\n### DevelopersのセキュリティグループにソースIPアドレスがエントリーされる\r\nセキュリティグループの画面にて、「Developers」と入力してフィルタリングすると確認しやすい\r\n<img width=\"809\" alt=\"image.png (86.8 kB)\" src=\"https://img.esa.io/uploads/production/attachments/14521/2022/11/07/128235/6c456229-bdd3-4b3d-b76a-a6cff5473959.png\">\r\n\r\nInbound rulesタブを開き、ソースIPアドレスが登録されていることを確認\r\n<img width=\"1121\" alt=\"image.png (58.0 kB)\" src=\"https://img.esa.io/uploads/production/attachments/14521/2022/11/07/128235/f3993b84-af6c-44ac-9919-ab6d97209b30.png\">\r\n<BR>\r\n\r\n### 設定したパスワードがわからなくなったと問い合わせが入った場合\r\n該当のユーザーを削除した後、再度新規作成して対応してください。\r\n（※パスワードリセットの機能を利用すると認証コードのやり取りが発生してスクリプトの使用ができなくなるため）\r\n\r\n##### ユーザー削除\r\n対象のユーザーを選択して「ユーザーを削除」\r\n<img width=\"419\" alt=\"image.png (8.3 kB)\" src=\"https://img.esa.io/uploads/production/attachments/14521/2022/11/15/128235/339ef625-2ec1-4829-89ae-01075a6cc0f2.png\">\r\n\r\n「ユーザーの無効化」を押して、指定された文字をフィールドに入力して削除\r\n<img width=\"592\" alt=\"image.png (66.7 kB)\" src=\"https://img.esa.io/uploads/production/attachments/14521/2022/11/15/128235/9d4e7687-91b5-4a83-94a0-f318b8d56c4b.png\">\r\n\r\n##### ユーザーの再作成\r\n「AWS Cognitoユーザーの作成」の手順で再度ユーザーを登録します。\r\n\r\n---\r\n---\r\n\r\n\r\n# アカウント作成手順（ユーザー対応）\r\n## 1. 利用者宛てにメールが届く\r\n<img width=\"405\" alt=\"image.png (29.3 kB)\" src=\"https://img.esa.io/uploads/production/attachments/14521/2022/11/10/128235/44d8df37-50c8-4ea2-beb2-6f8b74c7928c.png\">\r\n\r\n<img width=\"736\" alt=\"image.png (128.5 kB)\" src=\"https://img.esa.io/uploads/production/attachments/14521/2022/11/10/128235/6bbfc15c-399d-43b9-be6a-22262e5b3804.png\">\r\n\r\n\r\n\r\n\r\n## 2. ユーザースクリプトの入手\r\n下記より媒体を入手する\r\nhttps://eysdevpro2.backlog.jp/git/INFRASTRUCTURE/Infrastructure_scripts/tree/master/SIP_registerer/user_script\r\n「Infrastructure」のプロジェクトにアクセスできない方には、媒体を送付する。\r\n\r\n## 3. ツール使用方法 Usage\r\n### password_initializer.sh\r\nCognitoの初期Passwordから変更するためのScript\r\n\r\n`# ./password_initializer.sh [E-mail] [Password]`\r\n- E-mailはCognitoで招待されたE-mailアドレス\r\n- Passwordは新たに設定したいPassword\r\n\r\n#### パスワード初期化実行例\r\n```\r\n% cd SIP_registerer/user_script\r\n% ./password_initializer.sh test003@testmail.com pIO7XzzA\r\n\r\nPassword has been successfully changed.\r\n```\r\n<BR>\r\n\r\n### SIP_registerer.sh\r\nSource IPを開発者用SGに登録するScript. 一度登録すると、3日間アクセスが許可される。IPが失効した場合、再度このScriptを実行して登録する必要がある。\r\n`# ./SIP_registerer.sh [E-mail] [Password]`\r\n- E-mailは上記で設定したE-mail\r\n- Passwordは上記で設定したPassword\r\n\r\nパスワード要件は下記となっています。\r\n・８文字以上\r\n・少なくとも 1 つの数字を含む\r\n・少なくとも 1 つの大文字を含む\r\n・少なくとも 1 つの小文字を含む\r\n\r\n\r\n##### Source IPアドレス登録実行例\r\n```\r\n% ./SIP_registerer.sh test003@testmail.com pIO7XzzA\r\n\r\n\"123.223.323.233/32\"% \r\nYour Source IP address successfully added.\r\n```\r\n\r\n\r\n# 注意点\r\n## 前提条件：\r\n端末にAWS CLIのインストールが必要となる。（※V1系、V2系どちらでも問題ない）\r\n\r\nAWSのCLIv2をパッケージとしてダウンロード・インストール\r\nhttps://docs.aws.amazon.com/ja_jp/cli/latest/userguide/install-cliv2-mac.html\r\nまたは、pipでもインストール可能\r\npip install -U awscli", "body_html"=>"<h1 data-sourcepos=\"1:1-1:8\" id=\"1-0-0\" name=\"1-0-0\"><a class=\"anchor\" id=\"前提\" name=\"前提\" href=\"#前提\" data-position=\"1-0-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"前提\"> &gt; 前提</span></a>前提</h1>\n<h1 data-sourcepos=\"3:1-3:53\" id=\"2-0-0\" name=\"2-0-0\"><a class=\"anchor\" id=\"アカウント作成手順（インフラ担当）\" name=\"アカウント作成手順（インフラ担当）\" href=\"#アカウント作成手順（インフラ担当）\" data-position=\"2-0-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"アカウント作成手順（インフラ担当）\"> &gt; アカウント作成手順（インフラ担当）</span></a>アカウント作成手順（インフラ担当）</h1>\n<p data-sourcepos=\"4:1-4:57\">本項はインフラ担当にて必要な作業です。</p>\n<h3 data-sourcepos=\"6:1-6:36\" id=\"2-0-1\" name=\"2-0-1\"><a class=\"anchor\" id=\"AWS Cognitoユーザーの作成\" name=\"AWS Cognitoユーザーの作成\" href=\"#AWS Cognitoユーザーの作成\" data-position=\"2-0-1\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"AWS Cognitoユーザーの作成\"> &gt; AWS Cognitoユーザーの作成</span></a>AWS Cognitoユーザーの作成</h3>\n<p data-sourcepos=\"7:1-8:164\">マネジメントコンソール「AWS Cognito 」の画面で、「developers」を選択<br>\n<a href=\"https://img.esa.io/uploads/production/attachments/14521/2022/11/07/128235/ff44bfab-9763-4dd9-86e4-b269db4149ce.png\" target=\"_blank\" rel=\"noopener noreferrer\"><img width=\"954\" alt=\"image.png (57.1 kB)\" src=\"https://img.esa.io/uploads/production/attachments/14521/2022/11/07/128235/ff44bfab-9763-4dd9-86e4-b269db4149ce.png\"></a></p>\n<a href=\"https://img.esa.io/uploads/production/attachments/14521/2022/11/07/128235/57844dcf-45bc-40c9-90fb-4a33fe738fea.png\" target=\"_blank\" rel=\"noopener noreferrer\"><img width=\"613\" alt=\"image.png (27.7 kB)\" src=\"https://img.esa.io/uploads/production/attachments/14521/2022/11/07/128235/57844dcf-45bc-40c9-90fb-4a33fe738fea.png\"></a>\n<p data-sourcepos=\"13:1-13:29\">「Create user」クリック</p>\n<a href=\"https://img.esa.io/uploads/production/attachments/14521/2022/11/07/128235/46e55b54-8007-495b-9254-4b217aa1f2bc.png\" target=\"_blank\" rel=\"noopener noreferrer\"><img width=\"733\" alt=\"image.png (93.5 kB)\" src=\"https://img.esa.io/uploads/production/attachments/14521/2022/11/07/128235/46e55b54-8007-495b-9254-4b217aa1f2bc.png\"></a>\n<a href=\"https://img.esa.io/uploads/production/attachments/14521/2022/11/10/128235/f40fc80e-24e1-442f-aad4-ca5ce9bb2067.png\" target=\"_blank\" rel=\"noopener noreferrer\"><img width=\"801\" alt=\"image.png (100.6 kB)\" src=\"https://img.esa.io/uploads/production/attachments/14521/2022/11/10/128235/f40fc80e-24e1-442f-aad4-ca5ce9bb2067.png\"></a>\n<p data-sourcepos=\"20:1-21:84\">上記操作をCLIでやる場合<br>\n※1行目の変数email_addr に設定したいメールアドレスを指定する</p>\n<div class=\"code-block\" data-sourcepos=\"22:1-31:3\"><div class=\"highlight\"><pre class=\"highlight plaintext\"><code>export email_addr=test003@testmail.com\n\naws cognito-idp admin-create-user \\\n  --user-pool-id \"ap-northeast-1_GkxLTZSXe\" \\\n  --username \"$email_addr\" \\\n  --user-attributes Name=email,Value=\"$email_addr\" Name=email_verified,Value=true \\\n  --temporary-password Passw0rd\n</code></pre></div></div>\n<p data-sourcepos=\"35:1-35:72\">利用者（ユーザー）にパスワード初期化をしてもらう</p>\n<p data-sourcepos=\"37:1-38:164\">ステータスが「Confirmed」に変化する<br>\n<a href=\"https://img.esa.io/uploads/production/attachments/14521/2022/11/10/128235/824e72e2-0a86-4692-ab97-dbe84ad912fa.png\" target=\"_blank\" rel=\"noopener noreferrer\"><img width=\"832\" alt=\"image.png (11.2 kB)\" src=\"https://img.esa.io/uploads/production/attachments/14521/2022/11/10/128235/824e72e2-0a86-4692-ab97-dbe84ad912fa.png\"></a></p>\n<br>\n<h3 data-sourcepos=\"42:1-42:73\" id=\"2-0-2\" name=\"2-0-2\"><a class=\"anchor\" id=\"利用者（ユーザー）にSource IPの登録を行ってもらう\" name=\"利用者（ユーザー）にSource IPの登録を行ってもらう\" href=\"#利用者（ユーザー）にSource IPの登録を行ってもらう\" data-position=\"2-0-2\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"利用者（ユーザー）にSource IPの登録を行ってもらう\"> &gt; 利用者（ユーザー）にSource IPの登録を行ってもらう</span></a>利用者（ユーザー）にSource IPの登録を行ってもらう</h3>\n<h3 data-sourcepos=\"46:1-46:100\" id=\"2-0-3\" name=\"2-0-3\"><a class=\"anchor\" id=\"DevelopersのセキュリティグループにソースIPアドレスがエントリーされる\" name=\"DevelopersのセキュリティグループにソースIPアドレスがエントリーされる\" href=\"#DevelopersのセキュリティグループにソースIPアドレスがエントリーされる\" data-position=\"2-0-3\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"DevelopersのセキュリティグループにソースIPアドレスがエントリーされる\"> &gt; DevelopersのセキュリティグループにソースIPアドレスがエントリーされる</span></a>DevelopersのセキュリティグループにソースIPアドレスがエントリーされる</h3>\n<p data-sourcepos=\"47:1-48:164\">セキュリティグループの画面にて、「Developers」と入力してフィルタリングすると確認しやすい<br>\n<a href=\"https://img.esa.io/uploads/production/attachments/14521/2022/11/07/128235/6c456229-bdd3-4b3d-b76a-a6cff5473959.png\" target=\"_blank\" rel=\"noopener noreferrer\"><img width=\"809\" alt=\"image.png (86.8 kB)\" src=\"https://img.esa.io/uploads/production/attachments/14521/2022/11/07/128235/6c456229-bdd3-4b3d-b76a-a6cff5473959.png\"></a></p>\n<p data-sourcepos=\"50:1-52:4\">Inbound rulesタブを開き、ソースIPアドレスが登録されていることを確認<br>\n<a href=\"https://img.esa.io/uploads/production/attachments/14521/2022/11/07/128235/f3993b84-af6c-44ac-9919-ab6d97209b30.png\" target=\"_blank\" rel=\"noopener noreferrer\"><img width=\"1121\" alt=\"image.png (58.0 kB)\" src=\"https://img.esa.io/uploads/production/attachments/14521/2022/11/07/128235/f3993b84-af6c-44ac-9919-ab6d97209b30.png\"></a><br>\n<br></p>\n<h3 data-sourcepos=\"54:1-54:94\" id=\"2-0-4\" name=\"2-0-4\"><a class=\"anchor\" id=\"設定したパスワードがわからなくなったと問い合わせが入った場合\" name=\"設定したパスワードがわからなくなったと問い合わせが入った場合\" href=\"#設定したパスワードがわからなくなったと問い合わせが入った場合\" data-position=\"2-0-4\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"設定したパスワードがわからなくなったと問い合わせが入った場合\"> &gt; 設定したパスワードがわからなくなったと問い合わせが入った場合</span></a>設定したパスワードがわからなくなったと問い合わせが入った場合</h3>\n<p data-sourcepos=\"55:1-56:159\">該当のユーザーを削除した後、再度新規作成して対応してください。<br>\n（※パスワードリセットの機能を利用すると認証コードのやり取りが発生してスクリプトの使用ができなくなるため）</p>\n<h5 data-sourcepos=\"58:1-58:24\">ユーザー削除</h5>\n<p data-sourcepos=\"59:1-60:163\">対象のユーザーを選択して「ユーザーを削除」<br>\n<a href=\"https://img.esa.io/uploads/production/attachments/14521/2022/11/15/128235/339ef625-2ec1-4829-89ae-01075a6cc0f2.png\" target=\"_blank\" rel=\"noopener noreferrer\"><img width=\"419\" alt=\"image.png (8.3 kB)\" src=\"https://img.esa.io/uploads/production/attachments/14521/2022/11/15/128235/339ef625-2ec1-4829-89ae-01075a6cc0f2.png\"></a></p>\n<p data-sourcepos=\"62:1-63:164\">「ユーザーの無効化」を押して、指定された文字をフィールドに入力して削除<br>\n<a href=\"https://img.esa.io/uploads/production/attachments/14521/2022/11/15/128235/9d4e7687-91b5-4a83-94a0-f318b8d56c4b.png\" target=\"_blank\" rel=\"noopener noreferrer\"><img width=\"592\" alt=\"image.png (66.7 kB)\" src=\"https://img.esa.io/uploads/production/attachments/14521/2022/11/15/128235/9d4e7687-91b5-4a83-94a0-f318b8d56c4b.png\"></a></p>\n<h5 data-sourcepos=\"65:1-65:30\">ユーザーの再作成</h5>\n<p data-sourcepos=\"66:1-66:89\">「AWS Cognitoユーザーの作成」の手順で再度ユーザーを登録します。</p>\n<hr data-sourcepos=\"68:1-68:3\">\n<hr data-sourcepos=\"69:1-71:0\">\n<h1 data-sourcepos=\"72:1-72:53\" id=\"3-0-0\" name=\"3-0-0\"><a class=\"anchor\" id=\"アカウント作成手順（ユーザー対応）\" name=\"アカウント作成手順（ユーザー対応）\" href=\"#アカウント作成手順（ユーザー対応）\" data-position=\"3-0-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"アカウント作成手順（ユーザー対応）\"> &gt; アカウント作成手順（ユーザー対応）</span></a>アカウント作成手順（ユーザー対応）</h1>\n<h2 data-sourcepos=\"73:1-73:42\" id=\"3-1-0\" name=\"3-1-0\"><a class=\"anchor\" id=\"1. 利用者宛てにメールが届く\" name=\"1. 利用者宛てにメールが届く\" href=\"#1. 利用者宛てにメールが届く\" data-position=\"3-1-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"1. 利用者宛てにメールが届く\"> &gt; 1. 利用者宛てにメールが届く</span></a>1. 利用者宛てにメールが届く</h2>\n<a href=\"https://img.esa.io/uploads/production/attachments/14521/2022/11/10/128235/44d8df37-50c8-4ea2-beb2-6f8b74c7928c.png\" target=\"_blank\" rel=\"noopener noreferrer\"><img width=\"405\" alt=\"image.png (29.3 kB)\" src=\"https://img.esa.io/uploads/production/attachments/14521/2022/11/10/128235/44d8df37-50c8-4ea2-beb2-6f8b74c7928c.png\"></a>\n<a href=\"https://img.esa.io/uploads/production/attachments/14521/2022/11/10/128235/6bbfc15c-399d-43b9-be6a-22262e5b3804.png\" target=\"_blank\" rel=\"noopener noreferrer\"><img width=\"736\" alt=\"image.png (128.5 kB)\" src=\"https://img.esa.io/uploads/production/attachments/14521/2022/11/10/128235/6bbfc15c-399d-43b9-be6a-22262e5b3804.png\"></a>\n<h2 data-sourcepos=\"81:1-81:42\" id=\"3-2-0\" name=\"3-2-0\"><a class=\"anchor\" id=\"2. ユーザースクリプトの入手\" name=\"2. ユーザースクリプトの入手\" href=\"#2. ユーザースクリプトの入手\" data-position=\"3-2-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"2. ユーザースクリプトの入手\"> &gt; 2. ユーザースクリプトの入手</span></a>2. ユーザースクリプトの入手</h2>\n<p data-sourcepos=\"82:1-84:104\">下記より媒体を入手する<br>\n<a href=\"https://eysdevpro2.backlog.jp/git/INFRASTRUCTURE/Infrastructure_scripts/tree/master/SIP_registerer/user_script\" target=\"_blank\" rel=\"noopener noreferrer\">https://eysdevpro2.backlog.jp/git/INFRASTRUCTURE/Infrastructure_scripts/tree/master/SIP_registerer/user_script</a><br>\n「Infrastructure」のプロジェクトにアクセスできない方には、媒体を送付する。</p>\n<h2 data-sourcepos=\"86:1-86:33\" id=\"3-3-0\" name=\"3-3-0\"><a class=\"anchor\" id=\"3. ツール使用方法 Usage\" name=\"3. ツール使用方法 Usage\" href=\"#3. ツール使用方法 Usage\" data-position=\"3-3-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"3. ツール使用方法 Usage\"> &gt; 3. ツール使用方法 Usage</span></a>3. ツール使用方法 Usage</h2>\n<h3 data-sourcepos=\"87:1-87:27\" id=\"3-3-1\" name=\"3-3-1\"><a class=\"anchor\" id=\"password_initializer.sh\" name=\"password_initializer.sh\" href=\"#password_initializer.sh\" data-position=\"3-3-1\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"password_initializer.sh\"> &gt; password_initializer.sh</span></a>password_initializer.sh</h3>\n<p data-sourcepos=\"88:1-88:57\">Cognitoの初期Passwordから変更するためのScript</p>\n<p data-sourcepos=\"90:1-90:49\"><code># ./password_initializer.sh [E-mail] [Password]</code></p>\n<ul data-sourcepos=\"91:1-93:0\">\n<li data-sourcepos=\"91:1-91:54\">E-mailはCognitoで招待されたE-mailアドレス</li>\n<li data-sourcepos=\"92:1-93:0\">Passwordは新たに設定したいPassword</li>\n</ul>\n<h4 data-sourcepos=\"94:1-94:38\">パスワード初期化実行例</h4>\n<div class=\"code-block\" data-sourcepos=\"95:1-100:3\"><div class=\"highlight\"><pre class=\"highlight plaintext\"><code>% cd SIP_registerer/user_script\n% ./password_initializer.sh test003@testmail.com pIO7XzzA\n\nPassword has been successfully changed.\n</code></pre></div></div>\n<br>\n<h3 data-sourcepos=\"103:1-103:21\" id=\"3-3-2\" name=\"3-3-2\"><a class=\"anchor\" id=\"SIP_registerer.sh\" name=\"SIP_registerer.sh\" href=\"#SIP_registerer.sh\" data-position=\"3-3-2\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"SIP_registerer.sh\"> &gt; SIP_registerer.sh</span></a>SIP_registerer.sh</h3>\n<p data-sourcepos=\"104:1-105:43\">Source IPを開発者用SGに登録するScript. 一度登録すると、3日間アクセスが許可される。IPが失効した場合、再度このScriptを実行して登録する必要がある。<br>\n<code># ./SIP_registerer.sh [E-mail] [Password]</code></p>\n<ul data-sourcepos=\"106:1-108:0\">\n<li data-sourcepos=\"106:1-106:38\">E-mailは上記で設定したE-mail</li>\n<li data-sourcepos=\"107:1-108:0\">Passwordは上記で設定したPassword</li>\n</ul>\n<p data-sourcepos=\"109:1-113:45\">パスワード要件は下記となっています。<br>\n・８文字以上<br>\n・少なくとも 1 つの数字を含む<br>\n・少なくとも 1 つの大文字を含む<br>\n・少なくとも 1 つの小文字を含む</p>\n<h5 data-sourcepos=\"116:1-116:42\">Source IPアドレス登録実行例</h5>\n<div class=\"code-block\" data-sourcepos=\"117:1-122:3\"><div class=\"highlight\"><pre class=\"highlight plaintext\"><code>% ./SIP_registerer.sh test003@testmail.com pIO7XzzA\n\n\"123.223.323.233/32\"% \nYour Source IP address successfully added.\n</code></pre></div></div>\n<h1 data-sourcepos=\"125:1-125:11\" id=\"4-0-0\" name=\"4-0-0\"><a class=\"anchor\" id=\"注意点\" name=\"注意点\" href=\"#注意点\" data-position=\"4-0-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"注意点\"> &gt; 注意点</span></a>注意点</h1>\n<h2 data-sourcepos=\"126:1-126:18\" id=\"4-1-0\" name=\"4-1-0\"><a class=\"anchor\" id=\"前提条件：\" name=\"前提条件：\" href=\"#前提条件：\" data-position=\"4-1-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"前提条件：\"> &gt; 前提条件：</span></a>前提条件：</h2>\n<p data-sourcepos=\"127:1-127:107\">端末にAWS CLIのインストールが必要となる。（※V1系、V2系どちらでも問題ない）</p>\n<p data-sourcepos=\"129:1-132:21\">AWSのCLIv2をパッケージとしてダウンロード・インストール<br>\n<a href=\"https://docs.aws.amazon.com/ja_jp/cli/latest/userguide/install-cliv2-mac.html\" target=\"_blank\" rel=\"noopener noreferrer\">https://docs.aws.amazon.com/ja_jp/cli/latest/userguide/install-cliv2-mac.html</a><br>\nまたは、pipでもインストール可能<br>\npip install -U awscli</p>\n", "created_at"=>"2022-11-07T20:45:22+09:00", "message"=>"Update post.", "kind"=>"stock", "comments_count"=>0, "tasks_count"=>0, "done_tasks_count"=>0, "url"=>"https://2nd-community.esa.io/posts/627", "updated_at"=>"2022-12-13T19:05:53+09:00", "tags"=>[], "category"=>"システム本部/インフラ", "revision_number"=>26, "created_by"=>{"myself"=>false, "name"=>"石田裕三", "screen_name"=>"yuzo_ishida", "icon"=>"https://img.esa.io/uploads/production/users/128235/icon/thumb_m_666eede25b43a9ff04d9783c9ada7b11.png"}, "updated_by"=>{"myself"=>false, "name"=>"石田裕三", "screen_name"=>"yuzo_ishida", "icon"=>"https://img.esa.io/uploads/production/users/128235/icon/thumb_m_666eede25b43a9ff04d9783c9ada7b11.png"}, "stargazers_count"=>0, "watchers_count"=>1, "star"=>false, "watch"=>false, "sharing_urls"=>nil}, {"number"=>646, "name"=>"週次反省会 12月13日", "full_name"=>"システム本部/チーム/スクラム/週次反省会 12月13日", "wip"=>false, "body_md"=>"## Keep (スプリントでうまくいったので、今後も続けたいことは何か？)\r\n- (下垣)\r\n- (吉田)\r\n- (石田)\r\nSAA\r\nECS AutoScalling チューニング → 安定 → 費用注視\r\n- (高田)\r\n\r\n## Problem (スプリントでうまくいかなかったので、今後は中止したいことは何か？)\r\n- (下垣)\r\n- 要件定義が雑だったため、無駄に工数が掛かっている。(吉田)\r\n- (石田)\r\n- elbのリスナールールに漏れがあった。(高田)\r\n\r\n## Try ( これからやったほうがよいこと、改善したほうがよいことは何か？)\r\n- 採用時の課題作成をesaに残していないので残す(下垣)\r\n- motherのマニュアルがあった方がいいけど、作る手間と保守がきつそう。(吉田)\r\n- (石田)\r\n・メンテナンス作業時のメンテナンス画面表示の手順化\r\n・SC紐付け対応（自動化含め）もらいます。\r\n- ドキュメント作成(高田)\r\n\r\n## その他(何かあれば)\r\n- チケット\r\n→高田さんがドキュメント作成中（https://2nd-community.esa.io/posts/647）\r\n- 「:」でログイン\r\n→基本的にビジネスサイドには教えない。チャットに既読をつけたりしちゃう。\r\n- 不具合対応\r\n「最優先：順番待ち」 で優先度が高いもの [一覧](https://docs.google.com/spreadsheets/d/1ijDdHg9yhstaOPh4nsPrOYrqtMmqVbpjHrZf8QAhkrI/edit#gid=1249267874&range=A1) から\r\nみんなで内容確認して、担当を仮ぎめする。\r\n- 休講レッスンがあるクラス登録https://app.asana.com/0/1196247230098161/1203488111359049/f\r\n", "body_html"=>"<h2 data-sourcepos=\"1:1-1:94\" id=\"0-1-0\" name=\"0-1-0\"><a class=\"anchor\" id=\"Keep (スプリントでうまくいったので、今後も続けたいことは何か？)\" name=\"Keep (スプリントでうまくいったので、今後も続けたいことは何か？)\" href=\"#Keep (スプリントでうまくいったので、今後も続けたいことは何か？)\" data-position=\"0-1-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"Keep (スプリントでうまくいったので、今後も続けたいことは何か？)\"> &gt; Keep (スプリントでうまくいったので、今後も続けたいことは何か？)</span></a>Keep (スプリントでうまくいったので、今後も続けたいことは何か？)</h2>\n<ul data-sourcepos=\"2:1-8:0\">\n<li data-sourcepos=\"2:1-2:10\">(下垣)</li>\n<li data-sourcepos=\"3:1-3:10\">(吉田)</li>\n<li data-sourcepos=\"4:1-6:63\">(石田)<br>\nSAA<br>\nECS AutoScalling チューニング → 安定 → 費用注視</li>\n<li data-sourcepos=\"7:1-8:0\">(高田)</li>\n</ul>\n<h2 data-sourcepos=\"9:1-9:109\" id=\"0-2-0\" name=\"0-2-0\"><a class=\"anchor\" id=\"Problem (スプリントでうまくいかなかったので、今後は中止したいことは何か？)\" name=\"Problem (スプリントでうまくいかなかったので、今後は中止したいことは何か？)\" href=\"#Problem (スプリントでうまくいかなかったので、今後は中止したいことは何か？)\" data-position=\"0-2-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"Problem (スプリントでうまくいかなかったので、今後は中止したいことは何か？)\"> &gt; Problem (スプリントでうまくいかなかったので、今後は中止したいことは何か？)</span></a>Problem (スプリントでうまくいかなかったので、今後は中止したいことは何か？)</h2>\n<ul data-sourcepos=\"10:1-14:0\">\n<li data-sourcepos=\"10:1-10:10\">(下垣)</li>\n<li data-sourcepos=\"11:1-11:85\">要件定義が雑だったため、無駄に工数が掛かっている。(吉田)</li>\n<li data-sourcepos=\"12:1-12:10\">(石田)</li>\n<li data-sourcepos=\"13:1-14:0\">elbのリスナールールに漏れがあった。(高田)</li>\n</ul>\n<h2 data-sourcepos=\"15:1-15:100\" id=\"0-3-0\" name=\"0-3-0\"><a class=\"anchor\" id=\"Try ( これからやったほうがよいこと、改善したほうがよいことは何か？)\" name=\"Try ( これからやったほうがよいこと、改善したほうがよいことは何か？)\" href=\"#Try ( これからやったほうがよいこと、改善したほうがよいことは何か？)\" data-position=\"0-3-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"Try ( これからやったほうがよいこと、改善したほうがよいことは何か？)\"> &gt; Try ( これからやったほうがよいこと、改善したほうがよいことは何か？)</span></a>Try ( これからやったほうがよいこと、改善したほうがよいことは何か？)</h2>\n<ul data-sourcepos=\"16:1-22:0\">\n<li data-sourcepos=\"16:1-16:73\">採用時の課題作成をesaに残していないので残す(下垣)</li>\n<li data-sourcepos=\"17:1-17:106\">motherのマニュアルがあった方がいいけど、作る手間と保守がきつそう。(吉田)</li>\n<li data-sourcepos=\"18:1-20:59\">(石田)<br>\n・メンテナンス作業時のメンテナンス画面表示の手順化<br>\n・SC紐付け対応（自動化含め）もらいます。</li>\n<li data-sourcepos=\"21:1-22:0\">ドキュメント作成(高田)</li>\n</ul>\n<h2 data-sourcepos=\"23:1-23:29\" id=\"0-4-0\" name=\"0-4-0\"><a class=\"anchor\" id=\"その他(何かあれば)\" name=\"その他(何かあれば)\" href=\"#その他(何かあれば)\" data-position=\"0-4-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"その他(何かあれば)\"> &gt; その他(何かあれば)</span></a>その他(何かあれば)</h2>\n<ul data-sourcepos=\"24:1-31:103\">\n<li data-sourcepos=\"24:1-25:89\">チケット<br>\n→高田さんがドキュメント作成中（<a href=\"https://2nd-community.esa.io/posts/647%EF%BC%89\">https://2nd-community.esa.io/posts/647）</a></li>\n<li data-sourcepos=\"26:1-27:108\">「:」でログイン<br>\n→基本的にビジネスサイドには教えない。チャットに既読をつけたりしちゃう。</li>\n<li data-sourcepos=\"28:1-30:60\">不具合対応<br>\n「最優先：順番待ち」 で優先度が高いもの <a href=\"https://docs.google.com/spreadsheets/d/1ijDdHg9yhstaOPh4nsPrOYrqtMmqVbpjHrZf8QAhkrI/edit#gid=1249267874&amp;range=A1\" target=\"_blank\" rel=\"noopener noreferrer\">一覧</a> から<br>\nみんなで内容確認して、担当を仮ぎめする。</li>\n<li data-sourcepos=\"31:1-31:103\">休講レッスンがあるクラス登録<a href=\"https://app.asana.com/0/1196247230098161/1203488111359049/f\" target=\"_blank\" rel=\"noopener noreferrer\">https://app.asana.com/0/1196247230098161/1203488111359049/f</a></li>\n</ul>\n", "created_at"=>"2022-12-13T13:19:06+09:00", "message"=>"Update post.", "kind"=>"stock", "comments_count"=>0, "tasks_count"=>0, "done_tasks_count"=>0, "url"=>"https://2nd-community.esa.io/posts/646", "updated_at"=>"2022-12-13T16:54:31+09:00", "tags"=>[], "category"=>"システム本部/チーム/スクラム", "revision_number"=>12, "created_by"=>{"myself"=>true, "name"=>"吉田直人", "screen_name"=>"naoto_yoshida", "icon"=>"https://img.esa.io/uploads/production/users/105730/icon/thumb_m_7ed6de39594feb35d005206783298fdb.png"}, "updated_by"=>{"myself"=>true, "name"=>"吉田直人", "screen_name"=>"naoto_yoshida", "icon"=>"https://img.esa.io/uploads/production/users/105730/icon/thumb_m_7ed6de39594feb35d005206783298fdb.png"}, "stargazers_count"=>0, "watchers_count"=>4, "star"=>false, "watch"=>true, "sharing_urls"=>nil}, {"number"=>647, "name"=>"チケットについて", "full_name"=>"システム本部/運用保守/チケットについて", "wip"=>true, "body_md"=>"# 旧ロジック\r\nhttps://2nd-community.esa.io/posts/569\r\n\r\n# 新ロジック(2022/12/12~)\r\n## 概要\r\nチケットの枚数はticket_history（チケットに対するイベントの履歴）から求めるようになっている。\r\nticket_historyに期限切れ関連のレコードを追加することで、以前のロジックよりも簡単にチケットの残り枚数を出せるようになった。\r\n\r\n## 参考\r\nbacklog課題\r\nhttps://eysdevpro2.backlog.jp/view/FIRST-11034\r\n\r\n仕様\r\nhttps://docs.google.com/spreadsheets/d/1b90OEkbZOJjULua03n-ucnBUrUJnCcVKOAMgFvjpsnI/edit#gid=1005934798\r\n\r\n移行資料\r\nhttps://docs.google.com/spreadsheets/d/1KPMzXszwH6Qifz4Wv-V8zQ-HNS-PaNiMxywtnYAVaik/edit#gid=0\r\n\r\n## 変更箇所\r\n### 発生要因（cause_id）\r\n```ruby\r\n  CAUSES = Master.new(\r\n    [\r\n      [0, '初期登録', true],\r\n      [1, '初月権利購入', true],\r\n      [2, '月次権利購入', true],\r\n      [3, '初回レッスン登録', true],\r\n      [4, 'レッスン予約', true],\r\n      [5, 'レッスンキャンセル', true],\r\n      [6, 'クラス登録', true],\r\n      [7, 'クラス変更', true], # レコードを削除するため不要\r\n      [8, '消滅', true],\r\n      [9, '誤差補正', true],\r\n      [10, '権利数プレゼント', true],\r\n      [11, '期限切', true],\r\n      [12, '期限切回避', true],\r\n      [13, '期限切回避キャンセル', true]\r\n    ],\r\n```\r\n新たに、期限切、期限切回避、期限切回避キャンセルを追加。\r\n\r\n#### 期限切\r\nチケット付与時に、従来は付与レコードのみが作成されるだけだったが、\r\n期限切れ時に枚数が減るよう、期限切レコードも作成しておく。\r\n\r\n例. 2022/11/30が期限日の月次権利チケット2枚付与する場合\r\n期限日が2022/11/30でdeltaが2の月次権利レコードと\r\n効果日が2022/12/01でdeltaが-2の期限切レコードを作成する。\r\n\r\n#### 期限切回避\r\nチケット使用時に、従来は消化レコードのみが作成されるだけだったが、\r\n使ったチケットが期限切に換算されないよう期限切回避レコードも作成する。\r\n\r\n#### 期限切回避キャンセル\r\nレッスンキャンセル時に、従来はキャンセルレコードのみが作成されるだけだったが、\r\nキャンセルしたチケットが期限切れとなるよう、期限切回避を打ち消す期限切回避キャンセルレコードを作成する。\r\n\r\n", "body_html"=>"<h1 data-sourcepos=\"1:1-1:17\" id=\"1-0-0\" name=\"1-0-0\"><a class=\"anchor\" id=\"旧ロジック\" name=\"旧ロジック\" href=\"#旧ロジック\" data-position=\"1-0-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"旧ロジック\"> &gt; 旧ロジック</span></a>旧ロジック</h1>\n<p data-sourcepos=\"2:1-2:38\"><a href=\"https://2nd-community.esa.io/posts/569\">https://2nd-community.esa.io/posts/569</a></p>\n<h1 data-sourcepos=\"4:1-4:30\" id=\"2-0-0\" name=\"2-0-0\"><a class=\"anchor\" id=\"新ロジック(2022/12/12~)\" name=\"新ロジック(2022/12/12~)\" href=\"#新ロジック(2022/12/12~)\" data-position=\"2-0-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"新ロジック(2022/12/12~)\"> &gt; 新ロジック(2022/12/12~)</span></a>新ロジック(2022/12/12~)</h1>\n<h2 data-sourcepos=\"5:1-5:9\" id=\"2-1-0\" name=\"2-1-0\"><a class=\"anchor\" id=\"概要\" name=\"概要\" href=\"#概要\" data-position=\"2-1-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"概要\"> &gt; 概要</span></a>概要</h2>\n<p data-sourcepos=\"6:1-7:176\">チケットの枚数はticket_history（チケットに対するイベントの履歴）から求めるようになっている。<br>\nticket_historyに期限切れ関連のレコードを追加することで、以前のロジックよりも簡単にチケットの残り枚数を出せるようになった。</p>\n<h2 data-sourcepos=\"9:1-9:9\" id=\"2-2-0\" name=\"2-2-0\"><a class=\"anchor\" id=\"参考\" name=\"参考\" href=\"#参考\" data-position=\"2-2-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"参考\"> &gt; 参考</span></a>参考</h2>\n<p data-sourcepos=\"10:1-11:46\">backlog課題<br>\n<a href=\"https://eysdevpro2.backlog.jp/view/FIRST-11034\" target=\"_blank\" rel=\"noopener noreferrer\">https://eysdevpro2.backlog.jp/view/FIRST-11034</a></p>\n<p data-sourcepos=\"13:1-14:103\">仕様<br>\n<a href=\"https://docs.google.com/spreadsheets/d/1b90OEkbZOJjULua03n-ucnBUrUJnCcVKOAMgFvjpsnI/edit#gid=1005934798\" target=\"_blank\" rel=\"noopener noreferrer\">https://docs.google.com/spreadsheets/d/1b90OEkbZOJjULua03n-ucnBUrUJnCcVKOAMgFvjpsnI/edit#gid=1005934798</a></p>\n<p data-sourcepos=\"16:1-17:94\">移行資料<br>\n<a href=\"https://docs.google.com/spreadsheets/d/1KPMzXszwH6Qifz4Wv-V8zQ-HNS-PaNiMxywtnYAVaik/edit#gid=0\" target=\"_blank\" rel=\"noopener noreferrer\">https://docs.google.com/spreadsheets/d/1KPMzXszwH6Qifz4Wv-V8zQ-HNS-PaNiMxywtnYAVaik/edit#gid=0</a></p>\n<h2 data-sourcepos=\"19:1-19:15\" id=\"2-3-0\" name=\"2-3-0\"><a class=\"anchor\" id=\"変更箇所\" name=\"変更箇所\" href=\"#変更箇所\" data-position=\"2-3-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"変更箇所\"> &gt; 変更箇所</span></a>変更箇所</h2>\n<h3 data-sourcepos=\"20:1-20:30\" id=\"2-3-1\" name=\"2-3-1\"><a class=\"anchor\" id=\"発生要因（cause_id）\" name=\"発生要因（cause_id）\" href=\"#発生要因（cause_id）\" data-position=\"2-3-1\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"発生要因（cause_id）\"> &gt; 発生要因（cause_id）</span></a>発生要因（cause_id）</h3>\n<div class=\"code-block\" data-sourcepos=\"21:1-39:3\"><div class=\"code-filename\"><i class=\"fa fa-file-code-o\"></i>ruby</div><div class=\"highlight\"><pre class=\"highlight ruby\"><code>  <span class=\"no\">CAUSES</span> <span class=\"o\">=</span> <span class=\"no\">Master</span><span class=\"p\">.</span><span class=\"nf\">new</span><span class=\"p\">(</span>\n    <span class=\"p\">[</span>\n      <span class=\"p\">[</span><span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"s1\">'初期登録'</span><span class=\"p\">,</span> <span class=\"kp\">true</span><span class=\"p\">],</span>\n      <span class=\"p\">[</span><span class=\"mi\">1</span><span class=\"p\">,</span> <span class=\"s1\">'初月権利購入'</span><span class=\"p\">,</span> <span class=\"kp\">true</span><span class=\"p\">],</span>\n      <span class=\"p\">[</span><span class=\"mi\">2</span><span class=\"p\">,</span> <span class=\"s1\">'月次権利購入'</span><span class=\"p\">,</span> <span class=\"kp\">true</span><span class=\"p\">],</span>\n      <span class=\"p\">[</span><span class=\"mi\">3</span><span class=\"p\">,</span> <span class=\"s1\">'初回レッスン登録'</span><span class=\"p\">,</span> <span class=\"kp\">true</span><span class=\"p\">],</span>\n      <span class=\"p\">[</span><span class=\"mi\">4</span><span class=\"p\">,</span> <span class=\"s1\">'レッスン予約'</span><span class=\"p\">,</span> <span class=\"kp\">true</span><span class=\"p\">],</span>\n      <span class=\"p\">[</span><span class=\"mi\">5</span><span class=\"p\">,</span> <span class=\"s1\">'レッスンキャンセル'</span><span class=\"p\">,</span> <span class=\"kp\">true</span><span class=\"p\">],</span>\n      <span class=\"p\">[</span><span class=\"mi\">6</span><span class=\"p\">,</span> <span class=\"s1\">'クラス登録'</span><span class=\"p\">,</span> <span class=\"kp\">true</span><span class=\"p\">],</span>\n      <span class=\"p\">[</span><span class=\"mi\">7</span><span class=\"p\">,</span> <span class=\"s1\">'クラス変更'</span><span class=\"p\">,</span> <span class=\"kp\">true</span><span class=\"p\">],</span> <span class=\"c1\"># レコードを削除するため不要</span>\n      <span class=\"p\">[</span><span class=\"mi\">8</span><span class=\"p\">,</span> <span class=\"s1\">'消滅'</span><span class=\"p\">,</span> <span class=\"kp\">true</span><span class=\"p\">],</span>\n      <span class=\"p\">[</span><span class=\"mi\">9</span><span class=\"p\">,</span> <span class=\"s1\">'誤差補正'</span><span class=\"p\">,</span> <span class=\"kp\">true</span><span class=\"p\">],</span>\n      <span class=\"p\">[</span><span class=\"mi\">10</span><span class=\"p\">,</span> <span class=\"s1\">'権利数プレゼント'</span><span class=\"p\">,</span> <span class=\"kp\">true</span><span class=\"p\">],</span>\n      <span class=\"p\">[</span><span class=\"mi\">11</span><span class=\"p\">,</span> <span class=\"s1\">'期限切'</span><span class=\"p\">,</span> <span class=\"kp\">true</span><span class=\"p\">],</span>\n      <span class=\"p\">[</span><span class=\"mi\">12</span><span class=\"p\">,</span> <span class=\"s1\">'期限切回避'</span><span class=\"p\">,</span> <span class=\"kp\">true</span><span class=\"p\">],</span>\n      <span class=\"p\">[</span><span class=\"mi\">13</span><span class=\"p\">,</span> <span class=\"s1\">'期限切回避キャンセル'</span><span class=\"p\">,</span> <span class=\"kp\">true</span><span class=\"p\">]</span>\n    <span class=\"p\">],</span>\n</code></pre></div></div>\n<p data-sourcepos=\"40:1-40:84\">新たに、期限切、期限切回避、期限切回避キャンセルを追加。</p>\n<h4 data-sourcepos=\"42:1-42:14\">期限切</h4>\n<p data-sourcepos=\"43:1-44:87\">チケット付与時に、従来は付与レコードのみが作成されるだけだったが、<br>\n期限切れ時に枚数が減るよう、期限切レコードも作成しておく。</p>\n<p data-sourcepos=\"46:1-48:77\">例. 2022/11/30が期限日の月次権利チケット2枚付与する場合<br>\n期限日が2022/11/30でdeltaが2の月次権利レコードと<br>\n効果日が2022/12/01でdeltaが-2の期限切レコードを作成する。</p>\n<h4 data-sourcepos=\"50:1-50:20\">期限切回避</h4>\n<p data-sourcepos=\"51:1-52:105\">チケット使用時に、従来は消化レコードのみが作成されるだけだったが、<br>\n使ったチケットが期限切に換算されないよう期限切回避レコードも作成する。</p>\n<h4 data-sourcepos=\"54:1-54:35\">期限切回避キャンセル</h4>\n<p data-sourcepos=\"55:1-56:156\">レッスンキャンセル時に、従来はキャンセルレコードのみが作成されるだけだったが、<br>\nキャンセルしたチケットが期限切れとなるよう、期限切回避を打ち消す期限切回避キャンセルレコードを作成する。</p>\n", "created_at"=>"2022-12-13T16:20:38+09:00", "message"=>"Update post.", "kind"=>"stock", "comments_count"=>0, "tasks_count"=>0, "done_tasks_count"=>0, "url"=>"https://2nd-community.esa.io/posts/647", "updated_at"=>"2022-12-13T16:24:59+09:00", "tags"=>[], "category"=>"システム本部/運用保守", "revision_number"=>2, "created_by"=>{"myself"=>false, "name"=>"高田悦成", "screen_name"=>"essei_takada", "icon"=>"https://img.esa.io/uploads/production/users/119434/icon/thumb_m_75c84655889d80b06b27d9c1a43c631b.png"}, "updated_by"=>{"myself"=>false, "name"=>"高田悦成", "screen_name"=>"essei_takada", "icon"=>"https://img.esa.io/uploads/production/users/119434/icon/thumb_m_75c84655889d80b06b27d9c1a43c631b.png"}, "stargazers_count"=>0, "watchers_count"=>1, "star"=>false, "watch"=>false, "sharing_urls"=>nil}, {"number"=>569, "name"=>"【旧ロジック　〜20221211】チケット残数と失効予定チケットについて", "full_name"=>"システム本部/開発/設計書・仕様/【旧ロジック　〜20221211】チケット残数と失効予定チケットについて", "wip"=>false, "body_md"=>"# 前提\r\n- チケット数表示については現行の仕様を踏襲し、\r\nMotherではチケット数、SCではレッスン可能回数を表示している。\r\n\r\n- ticket1枚に対応するticketモデルはない。\r\n\r\n# Mother\r\nロジックはart-lesson側に記述。(api/v1/tickets/info_for_eys_class/info_for_eys_class)\r\n\r\n## チケット残数\r\nチケット残数はチケット数履歴の以下テーブルで確認可能。\r\n\r\n<img width=\"449\" alt=\"image.png (86.0 kB)\" src=\"https://img.esa.io/uploads/production/attachments/14521/2022/05/25/119434/747adc0e-a00c-4d6a-92e5-1b8c4fd84a37.png\">\r\n\r\n改修前と同様に、レッスン予定、誤差補正などによるチケットの増減は効果発生月のチケット残数からマイナスされる。\r\n(失効予定チケットを調べるロジックとは切り離してある。)\r\n\r\n## 失効予定チケット\r\nチケット失効予定はチケット数履歴の以下テーブルで確認可能。\r\n\r\n<img width=\"499\" alt=\"image.png (140.3 kB)\" src=\"https://img.esa.io/uploads/production/attachments/14521/2022/05/25/119434/e4fb472d-fb4e-42c2-bcd5-2b421855dcde.png\">\r\n\r\n期限が迫っているものが上にくるように出力している。(上のレコードから失効していく)\r\n\r\n# SC\r\nチケット情報については、api/v1/tickets/indexから取得している。\r\n以下のようなチケットに関する情報を返している。\r\n\r\n<img width=\"896\" alt=\"image.png (123.7 kB)\" src=\"https://img.esa.io/uploads/production/attachments/14521/2022/05/25/119434/5269cbb2-2ed6-4a79-b29f-893004970206.png\">\r\n\r\n## チケット残数\r\n\r\n<img width=\"904\" alt=\"image.png (93.6 kB)\" src=\"https://img.esa.io/uploads/production/attachments/14521/2022/05/25/119434/ff602573-5921-464d-aff3-117a83be93d0.png\">\r\n\r\n## 失効予定チケット\r\n失効予定チケットは今月と来月に失効予定のものを表示している。\r\n全ての失効予定チケットはmotherで確認可能。\r\n\r\n<img width=\"739\" alt=\"image.png (40.7 kB)\" src=\"https://img.esa.io/uploads/production/attachments/14521/2022/05/25/119434/0c0c7a52-8361-4223-bccd-75babb0a753d.png\">\r\n\r\n# 内部ロジック\r\nMother::TicketHistoryのクラスメソッドとして定義してある。\r\n\r\n## チケット残数\r\n### self.get_remaining_tickets\r\n現在(今月)のチケット数取得に利用。\r\nロジックがわかりにくすぎたのでとりあえずactive_recordで実装。\r\n\r\n※失効期限を考慮しないチケット残数(改修前)\r\nticket_historyのdeltaまたはonline_deltaをsumするだけ。\r\n\r\n#### 失効期限を考慮したチケット残数(改修後)\r\nticket_historyのdeltaまたはonline_deltaをsumしたもの(改修前の残数)から、\r\n使用されず期限切れしたチケットをマイナスする必要がある。\r\n\r\n以下、使用されず期限切れしたチケットを求めるロジックである。\r\n (使用有無不明期限切れチケット) - (消化、消滅、マイナス誤差補正分)\r\n \r\n使用有無不明期限切れチケット\r\n(使用して期限切れしたのか、使用せず期限切れしたのかはわからないもの)\r\n```ruby\r\nexpired_tickets = target_th.effective(date).expired(date).sum(type)\r\n```\r\n\r\n上記、使用有無が不明の期限切れしたチケットから、\r\n\r\nレッスン予約チケット数(レッスン予約分-レッスンキャンセル分)\r\nマイナスの誤差補正\r\n消滅チケット数\r\n\r\nを差し引いた結果、残数があればそれが使用されずに失効したチケット枚数となる。\r\n(マイナスの場合は、期限切れのもの以外も使用していることを意味しており、\r\n使用されずに失効したチケット枚数としては0枚となる。)\r\n\r\n### self.get_monthly_available_tickets\r\n来月、再来月のチケット数取得に利用。\r\n指定月内で効果発生しているチケットを取得している。\r\n\r\n## 失効予定チケット\r\n### self.get_remaining_tickets_info\r\nチケットを古い順から使用した場合に残るチケット情報を取得している。\r\n\r\n流れとしては、以下になる。\r\n\r\n1. 誤差補正対応レコード(仮)削除し、残っている可能性のある付与チケットを求める\r\n 2. 残っている可能性のある付与チケットを期限日、効果発生日、登録日について降順でソートし、自レコード、一つ前のレコードについてチケット数の累計を求める\r\n 3. 2で求めたチケット数累計とチケット残数を比較し、チケット残数分のチケットの情報を取得する。\r\n\r\n※誤差補正対応レコード(仮)削除\r\n誤差補正はどのレコードに対して行ったかという情報が必要であるが、現状そのような仕組みはないため、同じ効果発生日で誤差補正登録以前の最新レコードを打ち消すようにしている。\r\n\r\n```sql\r\nselect *,\r\nsum(adjusted_delta) over (order by expiration_date desc, effectuation_date desc, created_at desc) as total\r\nfrom (\r\n    select *,\r\n    --誤差補正、消滅によるチケットを先に削除しておく。\r\n    --同じ効果発生日の最新レコードを誤差補正している前提。\r\n    case when sum(\#{type}) over (partition by effectuation_date order by created_at rows between 1 following and 1 following ) < 0 then\r\n        \#{type} + sum(\#{type}) over (partition by effectuation_date order by created_at rows between 1 following and 1 following )\r\n    else \#{type}\r\n    end as adjusted_delta\r\n```\r\n\r\n\r\n\r\n", "body_html"=>"<h1 data-sourcepos=\"1:1-1:8\" id=\"1-0-0\" name=\"1-0-0\"><a class=\"anchor\" id=\"前提\" name=\"前提\" href=\"#前提\" data-position=\"1-0-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"前提\"> &gt; 前提</span></a>前提</h1>\n<ul data-sourcepos=\"2:1-6:0\">\n<li data-sourcepos=\"2:1-4:0\"><p data-sourcepos=\"2:3-3:86\">チケット数表示については現行の仕様を踏襲し、<br>\nMotherではチケット数、SCではレッスン可能回数を表示している。</p></li>\n<li data-sourcepos=\"5:1-6:0\"><p data-sourcepos=\"5:3-5:54\">ticket1枚に対応するticketモデルはない。</p></li>\n</ul>\n<h1 data-sourcepos=\"7:1-7:8\" id=\"2-0-0\" name=\"2-0-0\"><a class=\"anchor\" id=\"Mother\" name=\"Mother\" href=\"#Mother\" data-position=\"2-0-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"Mother\"> &gt; Mother</span></a>Mother</h1>\n<p data-sourcepos=\"8:1-8:94\">ロジックはart-lesson側に記述。(api/v1/tickets/info_for_eys_class/info_for_eys_class)</p>\n<h2 data-sourcepos=\"10:1-10:21\" id=\"2-1-0\" name=\"2-1-0\"><a class=\"anchor\" id=\"チケット残数\" name=\"チケット残数\" href=\"#チケット残数\" data-position=\"2-1-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"チケット残数\"> &gt; チケット残数</span></a>チケット残数</h2>\n<p data-sourcepos=\"11:1-11:81\">チケット残数はチケット数履歴の以下テーブルで確認可能。</p>\n<a href=\"https://img.esa.io/uploads/production/attachments/14521/2022/05/25/119434/747adc0e-a00c-4d6a-92e5-1b8c4fd84a37.png\" target=\"_blank\" rel=\"noopener noreferrer\"><img width=\"449\" alt=\"image.png (86.0 kB)\" src=\"https://img.esa.io/uploads/production/attachments/14521/2022/05/25/119434/747adc0e-a00c-4d6a-92e5-1b8c4fd84a37.png\"></a>\n<p data-sourcepos=\"15:1-16:80\">改修前と同様に、レッスン予定、誤差補正などによるチケットの増減は効果発生月のチケット残数からマイナスされる。<br>\n(失効予定チケットを調べるロジックとは切り離してある。)</p>\n<h2 data-sourcepos=\"18:1-18:27\" id=\"2-2-0\" name=\"2-2-0\"><a class=\"anchor\" id=\"失効予定チケット\" name=\"失効予定チケット\" href=\"#失効予定チケット\" data-position=\"2-2-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"失効予定チケット\"> &gt; 失効予定チケット</span></a>失効予定チケット</h2>\n<p data-sourcepos=\"19:1-19:87\">チケット失効予定はチケット数履歴の以下テーブルで確認可能。</p>\n<a href=\"https://img.esa.io/uploads/production/attachments/14521/2022/05/25/119434/e4fb472d-fb4e-42c2-bcd5-2b421855dcde.png\" target=\"_blank\" rel=\"noopener noreferrer\"><img width=\"499\" alt=\"image.png (140.3 kB)\" src=\"https://img.esa.io/uploads/production/attachments/14521/2022/05/25/119434/e4fb472d-fb4e-42c2-bcd5-2b421855dcde.png\"></a>\n<p data-sourcepos=\"23:1-23:119\">期限が迫っているものが上にくるように出力している。(上のレコードから失効していく)</p>\n<h1 data-sourcepos=\"25:1-25:4\" id=\"3-0-0\" name=\"3-0-0\"><a class=\"anchor\" id=\"SC\" name=\"SC\" href=\"#SC\" data-position=\"3-0-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"SC\"> &gt; SC</span></a>SC</h1>\n<p data-sourcepos=\"26:1-27:69\">チケット情報については、api/v1/tickets/indexから取得している。<br>\n以下のようなチケットに関する情報を返している。</p>\n<a href=\"https://img.esa.io/uploads/production/attachments/14521/2022/05/25/119434/5269cbb2-2ed6-4a79-b29f-893004970206.png\" target=\"_blank\" rel=\"noopener noreferrer\"><img width=\"896\" alt=\"image.png (123.7 kB)\" src=\"https://img.esa.io/uploads/production/attachments/14521/2022/05/25/119434/5269cbb2-2ed6-4a79-b29f-893004970206.png\"></a>\n<h2 data-sourcepos=\"31:1-31:21\" id=\"3-1-0\" name=\"3-1-0\"><a class=\"anchor\" id=\"チケット残数-1\" name=\"チケット残数-1\" href=\"#チケット残数-1\" data-position=\"3-1-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"チケット残数\"> &gt; チケット残数</span></a>チケット残数</h2>\n<a href=\"https://img.esa.io/uploads/production/attachments/14521/2022/05/25/119434/ff602573-5921-464d-aff3-117a83be93d0.png\" target=\"_blank\" rel=\"noopener noreferrer\"><img width=\"904\" alt=\"image.png (93.6 kB)\" src=\"https://img.esa.io/uploads/production/attachments/14521/2022/05/25/119434/ff602573-5921-464d-aff3-117a83be93d0.png\"></a>\n<h2 data-sourcepos=\"35:1-35:27\" id=\"3-2-0\" name=\"3-2-0\"><a class=\"anchor\" id=\"失効予定チケット-1\" name=\"失効予定チケット-1\" href=\"#失効予定チケット-1\" data-position=\"3-2-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"失効予定チケット\"> &gt; 失効予定チケット</span></a>失効予定チケット</h2>\n<p data-sourcepos=\"36:1-37:60\">失効予定チケットは今月と来月に失効予定のものを表示している。<br>\n全ての失効予定チケットはmotherで確認可能。</p>\n<a href=\"https://img.esa.io/uploads/production/attachments/14521/2022/05/25/119434/0c0c7a52-8361-4223-bccd-75babb0a753d.png\" target=\"_blank\" rel=\"noopener noreferrer\"><img width=\"739\" alt=\"image.png (40.7 kB)\" src=\"https://img.esa.io/uploads/production/attachments/14521/2022/05/25/119434/0c0c7a52-8361-4223-bccd-75babb0a753d.png\"></a>\n<h1 data-sourcepos=\"41:1-41:20\" id=\"4-0-0\" name=\"4-0-0\"><a class=\"anchor\" id=\"内部ロジック\" name=\"内部ロジック\" href=\"#内部ロジック\" data-position=\"4-0-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"内部ロジック\"> &gt; 内部ロジック</span></a>内部ロジック</h1>\n<p data-sourcepos=\"42:1-42:75\">Mother::TicketHistoryのクラスメソッドとして定義してある。</p>\n<h2 data-sourcepos=\"44:1-44:21\" id=\"4-1-0\" name=\"4-1-0\"><a class=\"anchor\" id=\"チケット残数-2\" name=\"チケット残数-2\" href=\"#チケット残数-2\" data-position=\"4-1-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"チケット残数\"> &gt; チケット残数</span></a>チケット残数</h2>\n<h3 data-sourcepos=\"45:1-45:30\" id=\"4-1-1\" name=\"4-1-1\"><a class=\"anchor\" id=\"self.get_remaining_tickets\" name=\"self.get_remaining_tickets\" href=\"#self.get_remaining_tickets\" data-position=\"4-1-1\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"self.get_remaining_tickets\"> &gt; self.get_remaining_tickets</span></a>self.get_remaining_tickets</h3>\n<p data-sourcepos=\"46:1-47:85\">現在(今月)のチケット数取得に利用。<br>\nロジックがわかりにくすぎたのでとりあえずactive_recordで実装。</p>\n<p data-sourcepos=\"49:1-50:64\">※失効期限を考慮しないチケット残数(改修前)<br>\nticket_historyのdeltaまたはonline_deltaをsumするだけ。</p>\n<h4 data-sourcepos=\"52:1-52:61\">失効期限を考慮したチケット残数(改修後)</h4>\n<p data-sourcepos=\"53:1-54:84\">ticket_historyのdeltaまたはonline_deltaをsumしたもの(改修前の残数)から、<br>\n使用されず期限切れしたチケットをマイナスする必要がある。</p>\n<p data-sourcepos=\"56:1-57:95\">以下、使用されず期限切れしたチケットを求めるロジックである。<br>\n(使用有無不明期限切れチケット) - (消化、消滅、マイナス誤差補正分)</p>\n<p data-sourcepos=\"59:1-60:101\">使用有無不明期限切れチケット<br>\n(使用して期限切れしたのか、使用せず期限切れしたのかはわからないもの)</p>\n<div class=\"code-block\" data-sourcepos=\"61:1-63:3\"><div class=\"code-filename\"><i class=\"fa fa-file-code-o\"></i>ruby</div><div class=\"highlight\"><pre class=\"highlight ruby\"><code><span class=\"n\">expired_tickets</span> <span class=\"o\">=</span> <span class=\"n\">target_th</span><span class=\"p\">.</span><span class=\"nf\">effective</span><span class=\"p\">(</span><span class=\"n\">date</span><span class=\"p\">).</span><span class=\"nf\">expired</span><span class=\"p\">(</span><span class=\"n\">date</span><span class=\"p\">).</span><span class=\"nf\">sum</span><span class=\"p\">(</span><span class=\"n\">type</span><span class=\"p\">)</span>\n</code></pre></div></div>\n<p data-sourcepos=\"65:1-65:72\">上記、使用有無が不明の期限切れしたチケットから、</p>\n<p data-sourcepos=\"67:1-69:21\">レッスン予約チケット数(レッスン予約分-レッスンキャンセル分)<br>\nマイナスの誤差補正<br>\n消滅チケット数</p>\n<p data-sourcepos=\"71:1-73:77\">を差し引いた結果、残数があればそれが使用されずに失効したチケット枚数となる。<br>\n(マイナスの場合は、期限切れのもの以外も使用していることを意味しており、<br>\n使用されずに失効したチケット枚数としては0枚となる。)</p>\n<h3 data-sourcepos=\"75:1-75:38\" id=\"4-1-2\" name=\"4-1-2\"><a class=\"anchor\" id=\"self.get_monthly_available_tickets\" name=\"self.get_monthly_available_tickets\" href=\"#self.get_monthly_available_tickets\" data-position=\"4-1-2\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"self.get_monthly_available_tickets\"> &gt; self.get_monthly_available_tickets</span></a>self.get_monthly_available_tickets</h3>\n<p data-sourcepos=\"76:1-77:75\">来月、再来月のチケット数取得に利用。<br>\n指定月内で効果発生しているチケットを取得している。</p>\n<h2 data-sourcepos=\"79:1-79:27\" id=\"4-2-0\" name=\"4-2-0\"><a class=\"anchor\" id=\"失効予定チケット-2\" name=\"失効予定チケット-2\" href=\"#失効予定チケット-2\" data-position=\"4-2-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"失効予定チケット\"> &gt; 失効予定チケット</span></a>失効予定チケット</h2>\n<h3 data-sourcepos=\"80:1-80:35\" id=\"4-2-1\" name=\"4-2-1\"><a class=\"anchor\" id=\"self.get_remaining_tickets_info\" name=\"self.get_remaining_tickets_info\" href=\"#self.get_remaining_tickets_info\" data-position=\"4-2-1\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"self.get_remaining_tickets_info\"> &gt; self.get_remaining_tickets_info</span></a>self.get_remaining_tickets_info</h3>\n<p data-sourcepos=\"81:1-81:99\">チケットを古い順から使用した場合に残るチケット情報を取得している。</p>\n<p data-sourcepos=\"83:1-83:39\">流れとしては、以下になる。</p>\n<ol data-sourcepos=\"85:1-88:0\">\n<li data-sourcepos=\"85:1-85:113\">誤差補正対応レコード(仮)削除し、残っている可能性のある付与チケットを求める</li>\n<li data-sourcepos=\"86:2-86:223\">残っている可能性のある付与チケットを期限日、効果発生日、登録日について降順でソートし、自レコード、一つ前のレコードについてチケット数の累計を求める</li>\n<li data-sourcepos=\"87:2-88:0\">2で求めたチケット数累計とチケット残数を比較し、チケット残数分のチケットの情報を取得する。</li>\n</ol>\n<p data-sourcepos=\"89:1-90:252\">※誤差補正対応レコード(仮)削除<br>\n誤差補正はどのレコードに対して行ったかという情報が必要であるが、現状そのような仕組みはないため、同じ効果発生日で誤差補正登録以前の最新レコードを打ち消すようにしている。</p>\n<div class=\"code-block\" data-sourcepos=\"92:1-103:3\"><div class=\"code-filename\"><i class=\"fa fa-file-code-o\"></i>sql</div><div class=\"highlight\"><pre class=\"highlight sql\"><code><span class=\"k\">select</span> <span class=\"o\">*</span><span class=\"p\">,</span>\n<span class=\"k\">sum</span><span class=\"p\">(</span><span class=\"n\">adjusted_delta</span><span class=\"p\">)</span> <span class=\"n\">over</span> <span class=\"p\">(</span><span class=\"k\">order</span> <span class=\"k\">by</span> <span class=\"n\">expiration_date</span> <span class=\"k\">desc</span><span class=\"p\">,</span> <span class=\"n\">effectuation_date</span> <span class=\"k\">desc</span><span class=\"p\">,</span> <span class=\"n\">created_at</span> <span class=\"k\">desc</span><span class=\"p\">)</span> <span class=\"k\">as</span> <span class=\"n\">total</span>\n<span class=\"k\">from</span> <span class=\"p\">(</span>\n    <span class=\"k\">select</span> <span class=\"o\">*</span><span class=\"p\">,</span>\n    <span class=\"c1\">--誤差補正、消滅によるチケットを先に削除しておく。</span>\n    <span class=\"c1\">--同じ効果発生日の最新レコードを誤差補正している前提。</span>\n    <span class=\"k\">case</span> <span class=\"k\">when</span> <span class=\"k\">sum</span><span class=\"p\">(</span><span class=\"o\">#</span><span class=\"p\">{</span><span class=\"k\">type</span><span class=\"p\">})</span> <span class=\"n\">over</span> <span class=\"p\">(</span><span class=\"k\">partition</span> <span class=\"k\">by</span> <span class=\"n\">effectuation_date</span> <span class=\"k\">order</span> <span class=\"k\">by</span> <span class=\"n\">created_at</span> <span class=\"k\">rows</span> <span class=\"k\">between</span> <span class=\"mi\">1</span> <span class=\"k\">following</span> <span class=\"k\">and</span> <span class=\"mi\">1</span> <span class=\"k\">following</span> <span class=\"p\">)</span> <span class=\"o\">&lt;</span> <span class=\"mi\">0</span> <span class=\"k\">then</span>\n        <span class=\"o\">#</span><span class=\"p\">{</span><span class=\"k\">type</span><span class=\"p\">}</span> <span class=\"o\">+</span> <span class=\"k\">sum</span><span class=\"p\">(</span><span class=\"o\">#</span><span class=\"p\">{</span><span class=\"k\">type</span><span class=\"p\">})</span> <span class=\"n\">over</span> <span class=\"p\">(</span><span class=\"k\">partition</span> <span class=\"k\">by</span> <span class=\"n\">effectuation_date</span> <span class=\"k\">order</span> <span class=\"k\">by</span> <span class=\"n\">created_at</span> <span class=\"k\">rows</span> <span class=\"k\">between</span> <span class=\"mi\">1</span> <span class=\"k\">following</span> <span class=\"k\">and</span> <span class=\"mi\">1</span> <span class=\"k\">following</span> <span class=\"p\">)</span>\n    <span class=\"k\">else</span> <span class=\"o\">#</span><span class=\"p\">{</span><span class=\"k\">type</span><span class=\"p\">}</span>\n    <span class=\"k\">end</span> <span class=\"k\">as</span> <span class=\"n\">adjusted_delta</span>\n</code></pre></div></div>\n", "created_at"=>"2022-05-25T11:19:31+09:00", "message"=>"Update post.", "kind"=>"flow", "comments_count"=>0, "tasks_count"=>0, "done_tasks_count"=>0, "url"=>"https://2nd-community.esa.io/posts/569", "updated_at"=>"2022-12-13T15:19:26+09:00", "tags"=>[], "category"=>"システム本部/開発/設計書・仕様", "revision_number"=>26, "created_by"=>{"myself"=>false, "name"=>"高田悦成", "screen_name"=>"essei_takada", "icon"=>"https://img.esa.io/uploads/production/users/119434/icon/thumb_m_75c84655889d80b06b27d9c1a43c631b.png"}, "updated_by"=>{"myself"=>false, "name"=>"高田悦成", "screen_name"=>"essei_takada", "icon"=>"https://img.esa.io/uploads/production/users/119434/icon/thumb_m_75c84655889d80b06b27d9c1a43c631b.png"}, "stargazers_count"=>0, "watchers_count"=>1, "star"=>false, "watch"=>false, "sharing_urls"=>nil}, {"number"=>23, "name"=>"README", "full_name"=>"システム本部/README", "wip"=>false, "body_md"=>"# 勤務場所\r\n\r\nリモートワーク\r\n\r\n# Mother\r\n[Mother](https://mother.enjoy-your-sound.com)\r\n[Mother(開発環境)](https://mother-dev.enjoy-your-sound.com)\r\n\r\n# SecondCommunity\r\n[SecondCommunity](https://sc.eys-musicschool.com/mypage/users/sign_in)\r\n[SecondCommunity(開発環境)](https://sc-dev.enjoy-your-sound.com/mypage/users/sign_in)\r\n\r\n# 組織図\r\n<iframe src=\"https://docs.google.com/spreadsheets/d/1NTwrLOzFr7NSpcMzld6kznFg8IJ5g9L3gbO32IBsIG0/preview\" width=\"1200\" height=\"450\"></iframe>\r\n\r\n\r\n# メンバ\r\n| 名前 | 備考 |\r\n| --- | --- |\r\n|中澤健一 | CTO | \r\n|  大澤聡 |CTO  |\r\n| 康育哲 |  |\r\n|下垣祐貴 |  |\r\n| 吉田直人 |  |\r\n| 高田悦成 |  |\r\n| NaranbyambGanbold |  |\r\n| 石田裕三\t |  |\r\n| 酒井貴史 |  |\r\n| 冨田純一\t |  |\r\n\r\n\r\n# ASANA\r\n\r\n## チーム\r\n\r\n| チーム名 | 説明 | 備考 |\r\n| -------- | -------- | -------- |\r\n|@system_all     | システムチーム全員     |      |\r\n| @system_support | 運用保守対応担当者  | |\r\n| @sc_link | SC紐付け担当者 | |\r\n|@mother_unlocking | motherのロック解除|  |\r\n\r\n# 関連資料\r\n\r\n## Google Drive\r\n\r\n[development](https://drive.google.com/drive/folders/0AL-XgL78NTtUUk9PVA)\r\n\r\n| チーム名 | 説明 | Google Drice |\r\n| -------- | -------- | -------- |\r\n|Motherバージョンアップ     |   ruby1.8.7 -> 2.0.0/rails 3.0.1 -> 3.1.12へのバージョンアップ対応   |  [GoogleDrive](https://drive.google.com/drive/folders/11xn81HB4NzcMe7Qc375OR6773EV1ZqZ0)    |\r\n\r\n## 不具合\r\n\r\n[レポート](https://docs.google.com/spreadsheets/d/1go2R79RUsCAn31mWKFeUJ8DDV5Lr0JNR_XG_mnkdCpo/edit?usp=sharing)", "body_html"=>"<h1 data-sourcepos=\"1:1-1:14\" id=\"1-0-0\" name=\"1-0-0\"><a class=\"anchor\" id=\"勤務場所\" name=\"勤務場所\" href=\"#勤務場所\" data-position=\"1-0-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"勤務場所\"> &gt; 勤務場所</span></a>勤務場所</h1>\n<p data-sourcepos=\"3:1-3:21\">リモートワーク</p>\n<h1 data-sourcepos=\"5:1-5:8\" id=\"2-0-0\" name=\"2-0-0\"><a class=\"anchor\" id=\"Mother\" name=\"Mother\" href=\"#Mother\" data-position=\"2-0-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"Mother\"> &gt; Mother</span></a>Mother</h1>\n<p data-sourcepos=\"6:1-7:63\"><a href=\"https://mother.enjoy-your-sound.com\" target=\"_blank\" rel=\"noopener noreferrer\">Mother</a><br>\n<a href=\"https://mother-dev.enjoy-your-sound.com\" target=\"_blank\" rel=\"noopener noreferrer\">Mother(開発環境)</a></p>\n<h1 data-sourcepos=\"9:1-9:17\" id=\"3-0-0\" name=\"3-0-0\"><a class=\"anchor\" id=\"SecondCommunity\" name=\"SecondCommunity\" href=\"#SecondCommunity\" data-position=\"3-0-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"SecondCommunity\"> &gt; SecondCommunity</span></a>SecondCommunity</h1>\n<p data-sourcepos=\"10:1-11:89\"><a href=\"https://sc.eys-musicschool.com/mypage/users/sign_in\" target=\"_blank\" rel=\"noopener noreferrer\">SecondCommunity</a><br>\n<a href=\"https://sc-dev.enjoy-your-sound.com/mypage/users/sign_in\" target=\"_blank\" rel=\"noopener noreferrer\">SecondCommunity(開発環境)</a></p>\n<h1 data-sourcepos=\"13:1-13:11\" id=\"4-0-0\" name=\"4-0-0\"><a class=\"anchor\" id=\"組織図\" name=\"組織図\" href=\"#組織図\" data-position=\"4-0-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"組織図\"> &gt; 組織図</span></a>組織図</h1>\n<iframe src=\"https://docs.google.com/spreadsheets/d/1NTwrLOzFr7NSpcMzld6kznFg8IJ5g9L3gbO32IBsIG0/preview\" width=\"1200\" height=\"450\"></iframe>\n<h1 data-sourcepos=\"17:1-17:11\" id=\"5-0-0\" name=\"5-0-0\"><a class=\"anchor\" id=\"メンバ\" name=\"メンバ\" href=\"#メンバ\" data-position=\"5-0-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"メンバ\"> &gt; メンバ</span></a>メンバ</h1>\n<table data-sourcepos=\"18:1-29:20\">\n<thead>\n<tr data-sourcepos=\"18:1-18:19\">\n<th data-sourcepos=\"18:2-18:9\">名前</th>\n<th data-sourcepos=\"18:11-18:18\">備考</th>\n</tr>\n</thead>\n<tbody>\n<tr data-sourcepos=\"20:1-20:22\">\n<td data-sourcepos=\"20:2-20:14\">中澤健一</td>\n<td data-sourcepos=\"20:16-20:20\">CTO</td>\n</tr>\n<tr data-sourcepos=\"21:1-21:20\">\n<td data-sourcepos=\"21:2-21:13\">大澤聡</td>\n<td data-sourcepos=\"21:15-21:19\">CTO</td>\n</tr>\n<tr data-sourcepos=\"22:1-22:16\">\n<td data-sourcepos=\"22:2-22:12\">康育哲</td>\n<td data-sourcepos=\"22:14-22:15\"></td>\n</tr>\n<tr data-sourcepos=\"23:1-23:18\">\n<td data-sourcepos=\"23:2-23:14\">下垣祐貴</td>\n<td data-sourcepos=\"23:16-23:17\"></td>\n</tr>\n<tr data-sourcepos=\"24:1-24:19\">\n<td data-sourcepos=\"24:2-24:15\">吉田直人</td>\n<td data-sourcepos=\"24:17-24:18\"></td>\n</tr>\n<tr data-sourcepos=\"25:1-25:19\">\n<td data-sourcepos=\"25:2-25:15\">高田悦成</td>\n<td data-sourcepos=\"25:17-25:18\"></td>\n</tr>\n<tr data-sourcepos=\"26:1-26:24\">\n<td data-sourcepos=\"26:2-26:20\">NaranbyambGanbold</td>\n<td data-sourcepos=\"26:22-26:23\"></td>\n</tr>\n<tr data-sourcepos=\"27:1-27:20\">\n<td data-sourcepos=\"27:2-27:16\">石田裕三</td>\n<td data-sourcepos=\"27:18-27:19\"></td>\n</tr>\n<tr data-sourcepos=\"28:1-28:19\">\n<td data-sourcepos=\"28:2-28:15\">酒井貴史</td>\n<td data-sourcepos=\"28:17-28:18\"></td>\n</tr>\n<tr data-sourcepos=\"29:1-29:20\">\n<td data-sourcepos=\"29:2-29:16\">冨田純一</td>\n<td data-sourcepos=\"29:18-29:19\"></td>\n</tr>\n</tbody>\n</table>\n<h1 data-sourcepos=\"32:1-32:7\" id=\"6-0-0\" name=\"6-0-0\"><a class=\"anchor\" id=\"ASANA\" name=\"ASANA\" href=\"#ASANA\" data-position=\"6-0-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"ASANA\"> &gt; ASANA</span></a>ASANA</h1>\n<h2 data-sourcepos=\"34:1-34:12\" id=\"6-1-0\" name=\"6-1-0\"><a class=\"anchor\" id=\"チーム\" name=\"チーム\" href=\"#チーム\" data-position=\"6-1-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"チーム\"> &gt; チーム</span></a>チーム</h2>\n<table data-sourcepos=\"36:1-41:49\">\n<thead>\n<tr data-sourcepos=\"36:1-36:34\">\n<th data-sourcepos=\"36:2-36:15\">チーム名</th>\n<th data-sourcepos=\"36:17-36:24\">説明</th>\n<th data-sourcepos=\"36:26-36:33\">備考</th>\n</tr>\n</thead>\n<tbody>\n<tr data-sourcepos=\"38:1-38:59\">\n<td data-sourcepos=\"38:2-38:17\">@system_all</td>\n<td data-sourcepos=\"38:19-38:51\">システムチーム全員</td>\n<td data-sourcepos=\"38:53-38:58\"></td>\n</tr>\n<tr data-sourcepos=\"39:1-39:52\">\n<td data-sourcepos=\"39:2-39:18\">@system_support</td>\n<td data-sourcepos=\"39:20-39:49\">運用保守対応担当者</td>\n<td data-sourcepos=\"39:51-39:51\"></td>\n</tr>\n<tr data-sourcepos=\"40:1-40:37\">\n<td data-sourcepos=\"40:2-40:11\">@sc_link</td>\n<td data-sourcepos=\"40:13-40:34\">SC紐付け担当者</td>\n<td data-sourcepos=\"40:36-40:36\"></td>\n</tr>\n<tr data-sourcepos=\"41:1-41:49\">\n<td data-sourcepos=\"41:2-41:19\">@mother_unlocking</td>\n<td data-sourcepos=\"41:21-41:45\">motherのロック解除</td>\n<td data-sourcepos=\"41:47-41:48\"></td>\n</tr>\n</tbody>\n</table>\n<h1 data-sourcepos=\"43:1-43:14\" id=\"7-0-0\" name=\"7-0-0\"><a class=\"anchor\" id=\"関連資料\" name=\"関連資料\" href=\"#関連資料\" data-position=\"7-0-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"関連資料\"> &gt; 関連資料</span></a>関連資料</h1>\n<h2 data-sourcepos=\"45:1-45:15\" id=\"7-1-0\" name=\"7-1-0\"><a class=\"anchor\" id=\"Google Drive\" name=\"Google Drive\" href=\"#Google Drive\" data-position=\"7-1-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"Google Drive\"> &gt; Google Drive</span></a>Google Drive</h2>\n<p data-sourcepos=\"47:1-47:73\"><a href=\"https://drive.google.com/drive/folders/0AL-XgL78NTtUUk9PVA\" target=\"_blank\" rel=\"noopener noreferrer\">development</a></p>\n<table data-sourcepos=\"49:1-51:214\">\n<thead>\n<tr data-sourcepos=\"49:1-49:40\">\n<th data-sourcepos=\"49:2-49:15\">チーム名</th>\n<th data-sourcepos=\"49:17-49:24\">説明</th>\n<th data-sourcepos=\"49:26-49:39\">Google Drice</th>\n</tr>\n</thead>\n<tbody>\n<tr data-sourcepos=\"51:1-51:214\">\n<td data-sourcepos=\"51:2-51:36\">Motherバージョンアップ</td>\n<td data-sourcepos=\"51:38-51:119\">ruby1.8.7 -&gt; 2.0.0/rails 3.0.1 -&gt; 3.1.12へのバージョンアップ対応</td>\n<td data-sourcepos=\"51:121-51:213\"><a href=\"https://drive.google.com/drive/folders/11xn81HB4NzcMe7Qc375OR6773EV1ZqZ0\" target=\"_blank\" rel=\"noopener noreferrer\">GoogleDrive</a></td>\n</tr>\n</tbody>\n</table>\n<h2 data-sourcepos=\"53:1-53:12\" id=\"7-2-0\" name=\"7-2-0\"><a class=\"anchor\" id=\"不具合\" name=\"不具合\" href=\"#不具合\" data-position=\"7-2-0\"><i class=\"fa fa-link\"></i><span class=\"hidden\" data-text=\"不具合\"> &gt; 不具合</span></a>不具合</h2>\n<p data-sourcepos=\"55:1-55:116\"><a href=\"https://docs.google.com/spreadsheets/d/1go2R79RUsCAn31mWKFeUJ8DDV5Lr0JNR_XG_mnkdCpo/edit?usp=sharing\" target=\"_blank\" rel=\"noopener noreferrer\">レポート</a></p>\n", "created_at"=>"2020-02-12T17:21:25+09:00", "message"=>"Update post.", "kind"=>"stock", "comments_count"=>0, "tasks_count"=>0, "done_tasks_count"=>0, "url"=>"https://2nd-community.esa.io/posts/23", "updated_at"=>"2022-12-13T10:24:10+09:00", "tags"=>[], "category"=>"システム本部", "revision_number"=>32, "created_by"=>{"myself"=>false, "name"=>"keisuke nakama", "screen_name"=>"keisuke_nakama", "icon"=>"https://img.esa.io/uploads/production/members/73528/icon/thumb_m_29a349f0f34eae1e491ad27b13529c97.jpeg"}, "updated_by"=>{"myself"=>true, "name"=>"吉田直人", "screen_name"=>"naoto_yoshida", "icon"=>"https://img.esa.io/uploads/production/users/105730/icon/thumb_m_7ed6de39594feb35d005206783298fdb.png"}, "stargazers_count"=>1, "watchers_count"=>2, "star"=>true, "watch"=>true, "sharing_urls"=>nil}], "prev_page"=>nil, "next_page"=>2, "total_count"=>587, "page"=>1, "per_page"=>20, "max_per_page"=>100}